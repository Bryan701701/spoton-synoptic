<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SPOT:ON â€“ Mobile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="color-scheme" content="light dark">
<style>
  :root { color-scheme: dark; }
    :root{
    --ink:#e7eaee;
    --muted:#a7b0ba;
    --ring:#3a404a;
    --swell:#2a66ff;   
    --wind:#f4a640;
    --wave-fun:   #00bcd4;
    --wave-solid: #002f6c;
    --wave-big:   #4b0082;
    --dial: 112px;    
    }


/* Prevent horizontal scroll without changing element sizing elsewhere */
html, body { overflow-x: hidden; }



/* Map & SVG: fill their containers but never exceed them */
#mob-map, #tide-svg {
  display:block;
  width:100%;
  max-width:100%;
}

/* Grid safety so the tide column can shrink */
.tt-mid > * { min-width:0; }

/* --- Header & chips (compact, one-line-first) --------------------------- */



/* Page base */
body { margin:0; font: 15px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0d0f12; color:#e7eaee; }
.muted { color:#a7b0ba; }

/* Sticky header */
.mbar { position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(6px); background:rgba(14,16,20,.7); border-bottom:1px solid #1f2329; }
.mrow {
  display:flex;
  align-items:center;       /* center vertically */
  gap:.5rem;
  padding:.5rem .7rem;
  /* no wrap by default so we try to keep one row on most phones */
  flex-wrap:nowrap;
}

/* Labels around selects (kept for structure, but no top label text) */
label { flex:1 1 auto; min-width:0; }

label span { display:none; } /* hide "Country" / "Area" text */

    #mob-filter { min-width:4.5rem; }
    #mob-filter-menu{
    position:absolute; z-index:2000;
    inset:auto .7rem auto auto; top:3.2rem;
    background:#0f1216; border:1px solid #2a2f36; border-radius:.6rem;
    padding:.35rem; box-shadow:0 8px 28px rgba(0,0,0,.35);
    display:none;
    }
    #mob-filter-menu[aria-hidden="false"]{ display:block; }
    #mob-filter-menu button{
    display:block; width:100%; text-align:left;
    background:transparent; border:0; padding:.45rem .6rem; border-radius:.45rem;
    }
    #mob-filter-menu button:hover{ background:#141920; }
    #mob-filter-menu hr{ border:0; border-top:1px solid #232831; margin:.3rem .2rem; }
    #mob-filter-menu .menu-check{
    display:flex; align-items:center; gap:.5rem; padding:.35rem .6rem; color:#e7eaee;
    }



</style>


<style>


/* Respect users who prefer less motion */
@media (prefers-reduced-motion: reduce){
  #hoverCard{
    transition: opacity .15s linear;
    transform: none !important;
  }
  #hoverCard.is-open{ opacity: 1; }
}


/* Card = three rows (header chips optional) | mid | footer chips optional */
#hoverCard .tt-bar{
  display: grid;
  grid-template-rows: auto auto auto;
  gap: 8px;
}

/* MID ROW: [dial] [tide-flex] [chips-fit] */
.tt-mid{
  display: grid;
  grid-template-columns: var(--dial) minmax(0,1fr) max-content;
  gap: 10px;
  align-items: center;
}

/* Right-hand chip stack (two chips, stacked) */
.tt-chips.column{
  display: grid;
  grid-auto-rows: min-content;
  gap: 6px;
  justify-self: end;         /* snug to right edge */
  max-width: 52vw;           /* donâ€™t eat the graph */
}
.tt-chips.column .chip{
  width: auto;
  max-width: 100%;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: clamp(10px, 2.6vw, 12px); /* soft auto-shrink */
}

/* If you ever use a 2-wide chip row elsewhere */
.tt-chips.full{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
}
.tt-chips.full .chip{
  width: 100%;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}



.chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chip-icon {
  width: 12px;
  height: 12px;
  flex-shrink: 0;
  opacity: 0.95;
}
.chip-icon{
  transform-box: fill-box;
  transform-origin: 50% 50%;
}

/* Make the inner <g> rotate around its own box (works in Safari/iOS too) */
.chip-rotor { transform-box: fill-box; transform-origin: 50% 50%; }
/* (keep your existing .chip-icon color rules as-is) */

.chip--wind  { color: var(--wind);  border-color: rgba(244,166,64,.35); background: rgba(244,166,64,.12); }
.chip--swell { color: var(--swell); border-color: rgba(42,102,255,.35); background: rgba(42,102,255,.12); }
.chip-icon--wind  path { stroke: var(--wind); }
.chip-icon--swell path { stroke: var(--ink); }

#hcPeriod { color: var(--swell); border-color: rgba(42,102,255,.35); background: rgba(42,102,255,.12); }
#hcPeriod .chip-icon path { stroke: var(--swell); }

/* Tide column must be allowed to shrink inside Grid */
#tide-card{ min-width: 0; }
#tide-svg{
  display: block;
  width: 100%;
  height: calc(var(--dial) + 12px);   /* match/beat dial height */
  max-width: none;
}

/* Dial + chevrons */
#hoverCard .tt-dial{ width: var(--dial); height: var(--dial); display:block; background:#0f1216; border:none; }
.chev path{ fill:none; stroke-width:4; stroke-linecap:square; stroke-linejoin:miter; }
.chev--wind  path{ stroke: var(--wind); }
.chev--swell path{ stroke: var(--swell); }

/* Dial face text */
#hcFaceNum{ font: 800 60px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial; fill: var(--swell); text-anchor: middle; dominant-baseline: central; }
#hcFaceUnit{ font: 700 18px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial; fill: var(--swell); text-anchor: start; dominant-baseline: central; }
.cardinal{ font: 700 11px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial; fill: var(--muted); text-anchor:middle; dominant-baseline:central; }

/* Generic chip look */
.chip{ display:inline-block; border:1px solid #2a2f36; border-radius:9999px; padding:2px 8px; line-height:1.4; color:var(--ink); }
.chip--wind{ border-color: rgba(244,166,64,.35); background: rgba(244,166,64,.12); color: var(--wind); }

/* Tide SVG cosmetics */
.tide--water{ fill: rgba(42,102,255,.18); stroke: #2a66ff; }
.tide--axis, .tide--tick{ stroke:#3a404a; }
.tide--label{ fill:#cfd6df; font: 600 11px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial; }
.tide--tick{ stroke:#2a2f36; stroke-width:1; }
.tide--tickLabel{ fill:#a7b0ba; font: 11px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial; }
.tide--markH{ fill:#2a66ff; }
.tide--markL{ fill:#f4a640; }
.tide--night{ fill: rgba(0,0,0,.25); }
.tide--past { fill: rgba(255,255,255,.06); }
.tide--window{ fill: rgba(58,164,84,.20); }
.tide--window.amber{ fill: rgba(244,166,64,.18); }
.tide--windowEdge{ stroke: rgba(58,164,84,.45); stroke-width:1; }
.tide--windowEdge.amber{ stroke: rgba(244,166,64,.45); }

/* Hide header/info rows that used to cause the â€œâ€”  â€”â€ */
.tide-header, .tide-info-row, .tide-meta-row{ display:none !important; }

/* Tiny phones: tighten dial + let svg follow */
@media (max-width:380px){
  .tt-mid{ grid-template-columns: 96px minmax(0,1fr) max-content; }
  #hoverCard .tt-dial{ width:96px; height:96px; }
  #tide-svg{ height: calc(96px + 12px); }
}

/* Page-level safety (once only) */
*, *::before, *::after { box-sizing: border-box; }
html, body { max-width: 100%; overflow-x: hidden; }

/* Map/header tidy */
.maphead{ display:none !important; }
#tips{ display:none !important; }

/* Ensure map & svg never push width */
#mob-map, #tide-svg{ width:100%; max-width:100%; display:block; }

/* === MOBILE HEADER (single source of truth) ============================== */
:root { --btn-h: 2.1rem; }

/* Header prefers a single row on typical phones */
.mbar .mrow{
  display:flex;
  align-items:center;
  gap:.5rem;
  padding:.45rem .6rem;
  flex-wrap:nowrap;
}

/* Selects get most of the width; long names fit */
#mob-country,
#mob-area{
  flex:1 1 40%;
  min-width:9.5rem;        /* fits â€œUnited Kingdomâ€ */
  max-width:100%;
  height:var(--btn-h);
  font-size:13px;
  padding:.35rem .55rem;
  border-radius:.5rem;
}

/* Chips in the header only (donâ€™t touch hover-card chips) */
.mbar .chip{
  display:inline-flex;
  align-items:center;
  gap:.35rem;
  white-space:normal;       /* allow 2-line wrap inside the chip */
  overflow:hidden;
  text-overflow:ellipsis;
  line-height:1.15;
  height:auto;
  padding:.35rem .6rem;
  border-radius:.55rem;
  padding-inline: clamp(6px, 2vw, 8px);
}

/* Date & Filter: shrink first, wrap if needed */
#mob-date,
#mob-filter{
  flex:0 1 9.75rem;
  max-width:11rem;
  font-size:12px;
  text-align:center;
}

/* Very narrow phones: allow chips to drop to a second line */
@media (max-width:420px){
  .mbar .mrow{ flex-wrap:wrap; }
  #mob-date, #mob-filter{ flex:1 1 48%; max-width:none; }
}

/* === MAP HEIGHT SAFETY =================================================== */
#mapwrap { display:block; }

/* add: a default header height as a fallback */
:root{ --mbar-h: 56px; }

/* replace the existing #mob-map rule(s) with this */
#mob-map{
  width:100%;
  height: calc(100dvh - var(--mbar-h));
  min-height: 380px;            /* keep your safety for very short viewports */
  border:0;
  border-radius:.6rem;
  background:#0b0d10;
}

@media (min-width:520px){
  #mob-map{ height:78vh !important; }
}

/* Wave Selector */
.ws-grid{
  display:grid;
  grid-template-columns: 1fr auto;
  gap:.5rem .75rem;
  align-items:center;
}
.ws-ctrl{
  display:grid;
  grid-template-columns: 1fr auto;
  gap:.5rem;
  align-items:center;
}
#wave-selector input[type="range"]{
  width:100%;
}
#wave-selector output{
  display:inline-block;
  min-width:3.5rem;
  text-align:right;
  font-variant-numeric: tabular-nums;
}

/* === HOVERCARD â€” SINGLE SOURCE OF TRUTH (Android/iOS/desktop) =========== */
#hoverCard {
  position: fixed;
  /* anchor */
  left: 0;
  right: 0;
  bottom: 0;

  /* size + centering */
  width: auto;
  max-width: 520px;
  margin: 0 auto;

  /* look */
  background: rgba(15,18,22,.82);
  backdrop-filter: saturate(140%) blur(8px);
  color: #e7eaee;
  border: 1px solid #2a2f36;
  border-bottom: none;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  box-shadow: 0 -10px 24px rgba(0,0,0,.35);

  /* behavior */
  z-index: 2147483647; /* win any stacking battle, incl. iframes */
  display: none;
  pointer-events: auto;
  max-height: 85dvh;
  overflow-y: auto;
  padding: 8px 10px max(10px, env(safe-area-inset-bottom));

  /* animation: slide up from below the bottom */
  transform: translateY(100%);
  opacity: 0;
  transition: transform .22s ease-out, opacity .22s ease-out;
}

#hoverCard.is-open {
  display: block;           /* participate in layout */
  transform: translateY(0); /* fully visible */
  opacity: 1;
}

@media (prefers-reduced-motion: reduce){
  #hoverCard {
    transition: opacity .15s linear;
    transform: none;
  }
  #hoverCard.is-open { opacity: 1; }
}

/* Motion-reduction still works, but wonâ€™t break positioning */
@media (prefers-reduced-motion: reduce){
  #hc-root > #hoverCard{
    transition: opacity .15s linear !important;
    transform: none !important;
    left: 50% !important;                      /* keep centering */
    bottom: max(0px, env(safe-area-inset-bottom)) !important;
  }
  #hc-root > #hoverCard.is-open{ opacity: 1; display:block; }
}

/* When weâ€™re showing the Wave Selector, guarantee it lays out fully */
#hoverCard.mode-ws {
  height: auto !important;
  max-height: 85dvh !important;
  overflow-y: auto !important;
  display: block !important;
}

#hoverCard.mode-ws > #wave-selector {
  display: block !important;   /* beat any stray display:none */
  visibility: visible !important;
  opacity: 1 !important;
  position: static !important;
  max-height: none !important;
  height: auto !important;
}

/* Optional: while in wave-selector mode, we donâ€™t want the spot UI */
#hoverCard.mode-ws > .tt-bar { display: none !important; }


/* Wave Selector bottom sheet (independent of #hoverCard) */
#wsCard{
  position: fixed;
  left: 0; right: 0; bottom: 0;
  width: auto; max-width: 520px; margin: 0 auto;
  background: rgba(15,18,22,.92);
  backdrop-filter: saturate(140%) blur(8px);
  color:#e7eaee;
  border:1px solid #2a2f36; border-bottom:none;
  border-top-left-radius:12px; border-top-right-radius:12px;
  box-shadow: 0 -10px 24px rgba(0,0,0,.35);
  z-index: 2147483647;
  max-height: 85dvh; overflow-y:auto;
  padding: 8px 10px max(10px, env(safe-area-inset-bottom));
  transform: translateY(100%); opacity:0; transition: transform .22s ease-out, opacity .22s ease-out;
}
#wsCard.is-open{ transform: translateY(0); opacity:1; display:block; }
@media (prefers-reduced-motion: reduce){
  #wsCard{ transform:none; transition: opacity .15s linear; }
  #wsCard.is-open{ opacity:1; }
}

/* Keep the inner content normal-flow; guarantee itâ€™s visible */
#wsCard #wave-selector{
  visibility:visible !important; position:static !important;
  max-height:none !important; height:auto !important;
}
#wsCard.is-open {
  transform: translateY(0);
  opacity: 1;
}
/* --- Restore wave selector drawer visibility and interactivity --- */
#wsCard {
  pointer-events: auto !important;
  position: fixed !important;
  z-index: 2147483647 !important;
  bottom: 0 !important;
}

/* Hide the selector by default */
#wave-selector { display: none; }

/* Only show it when the sheet is actually open */
#wsCard.is-open #wave-selector { display: block !important; }









#wsCard.is-open #sunburst-mount > svg{
  display:block;
  width:100%;
  height:auto;
}

/* Narrow phones: smaller label font, no transform overrides */
#sunburst-mount.narrow svg text,
#sunburst-mount.narrow .arc-label,
#sunburst-mount.narrow text {
  font-size: 10px !important;
  letter-spacing: .1px;
  /* Keep labels readable on dark bg */
  paint-order: stroke;
  stroke: rgba(0,0,0,.4);
  stroke-width: 1px;
}
  /* keep the map invisible until navApplied */
  #mapwrap iframe { visibility: hidden; }
  #mapwrap.ready iframe { visibility: visible; }
  #mapwrap iframe {
    opacity: 0;
    transition: opacity .2s ease-in;
  }
  #mapwrap.ready iframe {
    opacity: 1;
  }

  /* === Wave Selector colour lock â€“ match donut ========================= */

  /* stacked bands */
  #wsCard .band.flat {
    background: #d8b56a !important;      /* sand */
  }

  #wsCard .band.fun {
    background: #00bcd4 !important;      /* FUN â€“ cyan (matches donut) */
  }

  #wsCard .band.solid {
    background: #002f6c !important;      /* SOLID â€“ navy (matches donut) */
  }

  #wsCard .band.big {
    background-image: repeating-linear-gradient(
      45deg,
      #4b0082 0 7px,                     /* BIG â€“ imperial purple stripes */
      #12061b 7px 14px
    ) !important;
  }

  /* thumbs (slider knobs) */
  #wsCard .thumb.fun {
    border-color: #00bcd4 !important;
  }

  #wsCard .thumb.solid {
    border-color: #002f6c !important;
  }


  /* === Final override: BIG band solid colour (no stripes) =============== */

  #wsCard .band.big {
    background: #4b0082 !important;      /* solid imperial purple */
    background-image: none !important;   /* kill the stripe pattern */
  }


/* === FINAL OVERRIDE: Make both slider thumbs always visible (white) === */

#wsCard .thumb {
  background: #ffffff !important;        /* white fill */
  border: 2px solid #2a2f36 !important;  /* dark grey border */
  box-shadow: 0 2px 6px rgba(0,0,0,.35) !important;
}

#wsCard .thumb.fun,
#wsCard .thumb.solid {
  border-color: #2a2f36 !important;      /* ensure identical */
}



/* === Wave filter chip â€“ base === */

/* Wave filter chip â€“ base (match other chips) */
#mob-filter {
  border-radius: 999px;
  padding: 4px 14px;
  background: #202226;          /* same as .chip */
  border: 1px solid #202226;    /* same as .chip */
  color: #f9fafb;
  font-weight: 500;
}
/* Final: unify filter chip background with other top-bar chips */
#mob-filter{
  background: #202226 !important;
  border-color: #202226 !important;
}
/* Variants â€“ only text colour + a bit of emphasis */
#mob-filter.chip--wave-all {
  color: #f9fafb;
  font-weight: 500;
}


#mob-reset-region {
  color: #0a84ff; /* iOS blue */
}
#mob-reset-region:active {
  background: rgba(10, 132, 255, 0.25);
}

/* === FINAL OVERRIDE: Drawer transparency (single control point) === */
:root {
  --drawer-opacity: 0.35;   /* tweak THIS one number */
}

/* Hover Card â€“ darker, to improve legibility */
#hoverCard {
  background: rgba(15, 18, 22, 0.92) !important;
  backdrop-filter: saturate(140%) blur(8px) !important;
}

/* WS Card â€“ preserve shared frosted look using variable */
#wsCard {
  background: rgba(15, 18, 22, var(--drawer-opacity)) !important;
  backdrop-filter: saturate(140%) blur(8px) !important;
}

/* === Tight slider groove override ===================================== */
#ws-left.ws-left {
  border: none !important;                 /* remove dotted line */
  border-radius: 22px !important;

  /* shrink box around sliders */
  padding: 16px 6px !important;
  width: fit-content !important;
  margin-left: 12px !important;

  /* subtle recessed groove */
  background: transparent !important;
  box-shadow:
    inset 0 2px 6px rgba(0,0,0,0.25),       /* top shadow */
    inset 0 -2px 4px rgba(255,255,255,0.15) !important;  /* soft bottom highlight */
}
/* === CLEAN WAVE-SELECTOR LAYOUT (single source of truth) ============== */

/* Two columns: left = fixed 150px (bands + sliders), right = flexible (donut) */
#wsCard #wave-selector.ws-two-col{
  display: grid !important;
  grid-template-columns: 150px minmax(0, 1fr) !important;
  gap: 12px !important;
  align-items: center !important;
}

/* Left column width â€“ keep in sync with LEFT_W in openWaveSelector() */
#ws-left{
  width: 150px !important;
  min-width: 150px !important;
  max-width: 150px !important;
}

/* Right column: donut + legend stacked vertically */
#donut-col{
  grid-column: 2 !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  gap: 8px !important;
}

/* Donut mount: size comes ONLY from sizeDonut() in JS */
#sunburst-mount{
  grid-column: 2 !important;
  aspect-ratio: 1 / 1 !important;
  position: relative !important;
  justify-self: center !important;
  align-self: start !important;
}

/* Keep the SVG neatly inside the box */
#sunburst-mount > svg{
  display: block !important;
  width: 100% !important;
  height: auto !important;
  overflow: hidden !important;
}

/* Legend under the donut, no absolute positioning */
#sunburst-legend{
  position: static !important;
  max-width: 100% !important;
  pointer-events: none !important;
}

/* === NUKE THE OLD SET BUTTON COMPLETELY ============================== */

/* Hide the button itself wherever it lives */
#ws-close {
  display: none !important;
}

/* Hide the old slot so it doesn't reserve a row */
#ws-set-slot {
  display: none !important;
}

/* ðŸ”š REALLY-FINAL WAVE DRAWER POLISH  ============================== */

/* 1. Hide "Find Your Edge" + subtitle, whatever theyâ€™re wrapped in */
#wsCard .ws-title,
#wsCard .ws-sub,
#wsCard .ws-head {
  display: none !important;
}

/* 3. Kill any bevel/panel around the whole left column */
#ws-left,
#wsCard .ws-left {
  background: transparent !important;
  box-shadow: none !important;
  border-radius: 0 !important;
}

/* 4. Tight vertical groove just around the sliders */
#wsCard .rail {
  width: 26px !important;              /* thinner slice */
  margin-inline: auto !important;      /* centred under knobs */
  border: none !important;
  border-radius: 999px !important;
  background: rgba(255,255,255,0.07) !important;
  box-shadow:
    inset 0 2px 4px rgba(0,0,0,0.45),
    inset 0 -2px 3px rgba(255,255,255,0.16) !important;
}

/* 5. Light padding so the groove hugs the thumbs */
#ws-left.ws-left {
  padding: 12px 2px !important;
}

/* Centre the legend chips in column 2, under the donut */
#wsCard #wave-selector.ws-two-col .ws-footer {
  grid-column: 2 !important;          /* stay in the donut column */
  justify-self: center !important;    /* centre the whole footer box */
  width: 100% !important;             /* so flex centering uses full column */
  display: flex !important;
  justify-content: center !important; /* centre the chips within the footer */
  gap: 4px;
}


/* donut-col: stack donut + legend, both centred */
#donut-col {
  grid-column: 2 !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;   /* <-- centres legend under donut */
  gap: 8px !important;
}

#sunburst-legend {
  position: static !important;
  max-width: 100% !important;
  pointer-events: none !important;
  text-align: center !important;    /* centre labels within the row */
}

/* ============================================================
   1. UNIFY TOP-BAR CHIP VISUALS
   ============================================================ */

/* Base chip â€” all buttons AND selects share this, but only in the mobile bar */
.mbar .chip,
.mbar select.chip-select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  padding: 0.35rem 0.85rem;
  border-radius: 999px;

  background: #202226;
  border: 1px solid #202226;

  color: #fff;
  font-size: 14px;
  line-height: 1.1;

  min-height: 36px;
  height: 36px;
}


/* small chevron for < and menus */
#mob-reset-region {
  padding-left: 0.6rem;
  padding-right: 0.6rem;
  color: #0a84ff;  /* iOS blue */
  font-weight: 600;
}

/* date chip looks the same as others */
#mob-date {
  color: #fff;
  font-weight: 500;
}

/* === FINAL HEADER ROW LAYOUT (v2 â€“ more space for selects) ========= */

/* Always prefer a single row in the top bar */
.mbar .mrow{
  display: flex;
  align-items: center;
  gap: .35rem;
  flex-wrap: nowrap;           /* force single row on normal phones */
}

/* Allow children to actually shrink */
.mbar .mrow > * {
  min-width: 0;
}

/* Country / Area selects now get ~70% total (â‰ˆ35% each) */
#mob-country,
#mob-area{
  flex: 1 1 0;
  max-width: 35%;              /* was 28% */
  min-width: 0 !important;
}

/* Back chevron chip is small and fixed */
#mob-reset-region{
  flex: 0 0 auto;
  min-width: 2.2rem;           /* just big enough for "<" */
}

/* Date + SpotsOn chips can shrink a bit more */
#mob-date,
#mob-filter{
  flex: 0 1 6.5rem;            /* was 7.5rem */
  min-width: 0;
  white-space: nowrap;
  text-align: center;
}

/* Only *tiny* phones are allowed to wrap */
@media (max-width: 340px){
  .mbar .mrow{ flex-wrap: wrap; }
}


/* === FINAL HEADER SPACE BALANCE ======================================= */

/* Prefer one row */
.mbar .mrow {
  display: flex;
  align-items: center;
  gap: .45rem;
  flex-wrap: nowrap;
}

/* Allow shrink */
.mbar .mrow > * {
  min-width: 0;
}

/* --- Left selects: take MOST of the row (â‰ˆ38â€“40% each) --- */
#mob-country,
#mob-area {
  flex: 1 1 38%;
  max-width: 38%;
  min-width: 5.2rem !important;  /* safety for smallest names */
}

/* --- Chevron: fixed --- */
#mob-reset-region {
  flex: 0 0 auto;
  min-width: 2.2rem;
}

/* --- Date + SpotsOn: small, do NOT grow beyond needed --- */
#mob-date,
#mob-filter {
  flex: 0 0 auto;          /* do NOT grow */
  max-width: 7rem;         /* hard cap so selects keep space */
  white-space: nowrap;
}

#mob-filter.chip--wave-fun {
  background-color: var(--wave-fun) !important;
  color: #ffffff !important;
  text-shadow: 0 0 0.5px #ffffff, 0 0 1.2px #ffffff !important;
}

#mob-filter.chip--wave-solid {
  background-color: var(--wave-solid) !important;
  color: #ffffff !important;
  text-shadow: 0 0 0.5px #ffffff, 0 0 1.2px #ffffff !important;
}

#mob-filter.chip--wave-big {
  background-color: var(--wave-big) !important;
  color: #ffffff !important;
  text-shadow: 0 0 0.5px #ffffff, 0 0 1.2px #ffffff !important;
}


/* Force white text for dropdown items */
#mob-filter-menu button {
  color: #ffffff !important;
}

/* Specific override for SpotsOn */
#mob-filter-menu button[data-mode="ALL"] {
  color: #ffffff !important;
}

/* Blue chevron for Edge */
#mob-filter-menu .blue-arrow {
  color: #0a84ff;  /* iOS blue */
  font-weight: 600;
  padding-right: 0.35rem;
}

/* Hide Working Only checkbox row if still in markup */
#mob-filter-menu .menu-check {
  display: none !important;
}




#mob-filter-label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  border-radius: 999px;
  text-align: center;
  text-shadow: inherit !important;
}


/* Make sure no earlier rule forces a big min-width on selects */
#mob-country,
#mob-area{
  min-width: 0 !important;
}

</style>

<script>
  // Safety shim: ensures window.bus exists before any inline scripts run.
  if (!window.bus) {
    (function () {
      var et = new EventTarget();
      function emit(type, detail){
        try { et.dispatchEvent(new CustomEvent(type, { detail: detail })); }
        catch (e) { var ev = document.createEvent('CustomEvent'); ev.initCustomEvent(type, false, false, detail); et.dispatchEvent(ev); }
      }
      function on(type, fn, opts){ et.addEventListener(type, fn, opts); }
      function off(type, fn, opts){ et.removeEventListener(type, fn, opts); }
      function postToMap(type, payload){
        try { document.getElementById('mob-map')?.contentWindow?.postMessage({ type: type, payload: payload }, '*'); } catch(_) {}
      }
      window.bus = { emit: emit, on: on, off: off, postToMap: postToMap };


      // --- Dev-only bus event logging (place near boot) ---
      bus.on('regionChange', e => console.log('ðŸ”¥ regionChange', e.detail));
      bus.on('dayChange',    e => console.log('ðŸ“… dayChange', e.detail));
      bus.on('filterChange', e => console.log('ðŸ§ª filterChange', e.detail));
      bus.on('filterScaleChange', e => console.log('ðŸ“ filterScaleChange', e.detail));
      // --- End dev bus logging ---
      // NEW: replace the old listener with this
      bus.on('regionChange', () => {
        requestAnimationFrame(() => {
          try {
            const reg = window.REGION || { country: 'ALL', area: 'ALL' };
            const isTop =
              String(reg.country || 'ALL').toUpperCase() === 'ALL' &&
              (!reg.area || reg.area === 'ALL');

            if (!isTop) return; // deeper level, do nothing

            const root = document.getElementById('sunburst-mount');
            if (!root) return;

            let node =
              root.querySelector('.donut-subtitle, .sb-center-subtitle, text.sb-subtitle') ||
              Array.from(root.querySelectorAll('text')).find(t => /Spots/i.test(t.textContent || ''));

            if (node) node.textContent = 'Spots Working';
          } catch {}
        });
      });


    })();
  }
</script>
<link rel="stylesheet" href="css/wave_selector.css?v=1766898113">
<script defer src="js/bus.js?v=1766898113"></script>

<script>
// --- Bootstrap shared state & lookups early ---
if (!window.REGION) {
  window.REGION = { country: 'ALL', area: 'ALL' };
}

if (!window.CC_TO_NAME) {
  const bc = (window.BOUNDARIES && window.BOUNDARIES.by_country) || {};
  const map = {};
  Object.values(bc).forEach(r => {
    const cc   = String(r.country_code || '').toUpperCase();
    const name = String(r.country_name || '').trim();
    if (cc && name) map[cc] = name;
  });
  window.CC_TO_NAME = map;
}

if (!window.NAME_TO_CC) {
  const m = {};
  for (const [cc, nm] of Object.entries(window.CC_TO_NAME || {})) {
    if (nm) m[nm.trim().toLowerCase()] = cc; // "united kingdom" -> "GB"
  }
  m.uk = 'GB';
  m.gb = 'GB';
  window.NAME_TO_CC = m;
}
</script>


<script>
// Ensure sunburst-origin regionChange ALWAYS flows through setRegion
(function hardenSunburstRegionIntercept(){
  let applyingFromSunburst = false;

  function wrap(){
    if (!window.bus || typeof bus.emit !== 'function') return;
    const _emit = bus.emit;

    bus.emit = (type, detail) => {
      // Debug (optional)
      // console.debug('[bus.emit]', type, detail);

      try {
        if (
          type === 'regionChange' &&
          detail && detail.from === 'sunburst' &&
          typeof window.setRegion === 'function'
        ) {
          if (applyingFromSunburst) return; // guard against re-entry
          applyingFromSunburst = true;

          const country = detail.country ?? 'ALL';
          const area    = detail.area    ?? 'ALL';

          // 1) Update canonical filter (REGION) + fetch (your setRegion already does this)
          window.setRegion({ country, area, from: 'sunburst-applied' });

          // 2) Force the dropdown visuals to match (no events fired)

          window.syncSelects?.(country, area);

          applyingFromSunburst = false;
          return; // swallow the original regionChange to avoid a loop
        }
      } catch (_) {
        applyingFromSunburst = false;
      }

      _emit(type, detail);
    };
  }

  if (document.readyState === 'complete') wrap();
  else window.addEventListener('load', wrap, { once:true });
})();
</script>
<script defer src="js/wave_selector.js?v=1766898113"></script>

<!-- Tides + Moon data -->
<script>window.TIDES = {"2025-12-27": {"by_port": {"aberystwyth": [{"t": "2025-12-27T00:07", "h": 3.96, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-27T06:47", "h": 1.56, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-27T12:34", "h": 4.36, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-27T19:41", "h": 1.46, "k": "L", "port": "Aberystwyth"}], "cape wrath": [{"t": "2025-12-27T00:17", "h": 3.68, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-27T06:08", "h": 1.76, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-27T12:20", "h": 3.99, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-27T18:55", "h": 1.41, "k": "L", "port": "Cape Wrath"}], "thurso": [{"t": "2025-12-27T01:19", "h": 3.89, "k": "H", "port": "Thurso"}, {"t": "2025-12-27T07:10", "h": 2.01, "k": "L", "port": "Thurso"}, {"t": "2025-12-27T13:18", "h": 4.28, "k": "H", "port": "Thurso"}, {"t": "2025-12-27T20:00", "h": 1.56, "k": "L", "port": "Thurso"}], "north shields": [{"t": "2025-12-27T01:53", "h": 1.31, "k": "L", "port": "North Shields"}, {"t": "2025-12-27T08:11", "h": 4.31, "k": "H", "port": "North Shields"}, {"t": "2025-12-27T14:03", "h": 1.8, "k": "L", "port": "North Shields"}, {"t": "2025-12-27T20:12", "h": 4.62, "k": "H", "port": "North Shields"}], "skirza": [{"t": "2025-12-27T02:14", "h": 3.57, "k": "H", "port": "Skirza"}, {"t": "2025-12-27T07:43", "h": 2.01, "k": "L", "port": "Skirza"}, {"t": "2025-12-27T14:11", "h": 3.93, "k": "H", "port": "Skirza"}, {"t": "2025-12-27T20:33", "h": 1.58, "k": "L", "port": "Skirza"}], "whitby": [{"t": "2025-12-27T02:25", "h": 1.6, "k": "L", "port": "Whitby"}, {"t": "2025-12-27T08:46", "h": 4.72, "k": "H", "port": "Whitby"}, {"t": "2025-12-27T14:38", "h": 2.14, "k": "L", "port": "Whitby"}, {"t": "2025-12-27T20:44", "h": 5.04, "k": "H", "port": "Whitby"}], "scarborough": [{"t": "2025-12-27T02:49", "h": 1.67, "k": "L", "port": "Scarborough"}, {"t": "2025-12-27T08:59", "h": 4.85, "k": "H", "port": "Scarborough"}, {"t": "2025-12-27T14:59", "h": 2.34, "k": "L", "port": "Scarborough"}, {"t": "2025-12-27T21:03", "h": 5.29, "k": "H", "port": "Scarborough"}], "coomeenole": [{"t": "2025-12-27T03:00", "h": 1.4, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-27T09:18", "h": 3.53, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-27T15:38", "h": 1.17, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-27T22:02", "h": 3.36, "k": "H", "port": "Coomeenole"}], "doonbeg": [{"t": "2025-12-27T03:22", "h": 1.62, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-27T09:40", "h": 3.97, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-27T16:00", "h": 1.33, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-27T22:26", "h": 3.79, "k": "H", "port": "Doonbeg"}], "newlyn": [{"t": "2025-12-27T03:26", "h": 1.66, "k": "L", "port": "Newlyn"}, {"t": "2025-12-27T09:11", "h": 4.95, "k": "H", "port": "Newlyn"}, {"t": "2025-12-27T15:57", "h": 1.6, "k": "L", "port": "Newlyn"}, {"t": "2025-12-27T21:39", "h": 4.62, "k": "H", "port": "Newlyn"}], "plymouth": [{"t": "2025-12-27T03:50", "h": 1.85, "k": "L", "port": "Plymouth"}, {"t": "2025-12-27T09:53", "h": 4.96, "k": "H", "port": "Plymouth"}, {"t": "2025-12-27T16:25", "h": 1.79, "k": "L", "port": "Plymouth"}, {"t": "2025-12-27T22:27", "h": 4.67, "k": "H", "port": "Plymouth"}], "bundoran": [{"t": "2025-12-27T03:52", "h": 1.24, "k": "L", "port": "Bundoran"}, {"t": "2025-12-27T10:24", "h": 3.54, "k": "H", "port": "Bundoran"}, {"t": "2025-12-27T16:51", "h": 1.16, "k": "L", "port": "Bundoran"}, {"t": "2025-12-27T23:02", "h": 3.0, "k": "H", "port": "Bundoran"}], "cork": [{"t": "2025-12-27T03:53", "h": 1.04, "k": "L", "port": "Cork"}, {"t": "2025-12-27T09:54", "h": 3.62, "k": "H", "port": "Cork"}, {"t": "2025-12-27T16:25", "h": 1.17, "k": "L", "port": "Cork"}, {"t": "2025-12-27T22:19", "h": 3.5, "k": "H", "port": "Cork"}], "inishcrone": [{"t": "2025-12-27T04:06", "h": 1.26, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-27T10:32", "h": 3.13, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-27T16:48", "h": 0.96, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-27T23:19", "h": 2.9, "k": "H", "port": "Inishcrone"}], "falcarragh": [{"t": "2025-12-27T04:11", "h": 1.17, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-27T10:41", "h": 3.41, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-27T17:03", "h": 1.21, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-27T23:12", "h": 2.99, "k": "H", "port": "Falcarragh"}], "llangennith": [{"t": "2025-12-27T04:19", "h": 2.21, "k": "L", "port": "Llangennith"}, {"t": "2025-12-27T10:35", "h": 7.38, "k": "H", "port": "Llangennith"}, {"t": "2025-12-27T16:52", "h": 2.22, "k": "L", "port": "Llangennith"}, {"t": "2025-12-27T23:04", "h": 7.03, "k": "H", "port": "Llangennith"}], "lossiemouth": [{"t": "2025-12-27T04:28", "h": 3.33, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-27T10:12", "h": 1.65, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-27T16:26", "h": 3.67, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-27T23:03", "h": 1.18, "k": "L", "port": "Lossiemouth"}], "milfordhaven": [{"t": "2025-12-27T04:39", "h": 1.91, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-27T10:51", "h": 6.09, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-27T17:17", "h": 1.9, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-27T23:23", "h": 5.68, "k": "H", "port": "MilfordHaven"}], "croyde": [{"t": "2025-12-27T04:58", "h": 0.73, "k": "L", "port": "Croyde"}, {"t": "2025-12-27T10:43", "h": 5.95, "k": "H", "port": "Croyde"}, {"t": "2025-12-27T17:29", "h": 0.73, "k": "L", "port": "Croyde"}, {"t": "2025-12-27T23:12", "h": 5.61, "k": "H", "port": "Croyde"}], "campbeltown": [{"t": "2025-12-27T05:12", "h": 2.62, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-27T10:31", "h": 1.14, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-27T17:09", "h": 3.02, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-27T23:24", "h": 0.8, "k": "L", "port": "Campbeltown"}], "stornoway": [{"t": "2025-12-27T05:23", "h": 1.88, "k": "L", "port": "Stornoway"}, {"t": "2025-12-27T11:33", "h": 4.38, "k": "H", "port": "Stornoway"}, {"t": "2025-12-27T18:15", "h": 1.64, "k": "L", "port": "Stornoway"}], "londonderry": [{"t": "2025-12-27T05:58", "h": 0.83, "k": "L", "port": "Londonderry"}, {"t": "2025-12-27T12:27", "h": 2.21, "k": "H", "port": "Londonderry"}, {"t": "2025-12-27T19:19", "h": 0.95, "k": "L", "port": "Londonderry"}], "aberdeen": [{"t": "2025-12-27T06:08", "h": 3.62, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-27T11:51", "h": 1.74, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-27T18:07", "h": 3.96, "k": "H", "port": "Aberdeen"}]}, "ext": [{"t": "2025-12-27T00:07", "h": 3.96, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-27T00:17", "h": 3.68, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-27T01:19", "h": 3.89, "k": "H", "port": "Thurso"}, {"t": "2025-12-27T01:53", "h": 1.31, "k": "L", "port": "North Shields"}, {"t": "2025-12-27T02:14", "h": 3.57, "k": "H", "port": "Skirza"}, {"t": "2025-12-27T02:25", "h": 1.6, "k": "L", "port": "Whitby"}, {"t": "2025-12-27T02:49", "h": 1.67, "k": "L", "port": "Scarborough"}, {"t": "2025-12-27T03:00", "h": 1.4, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-27T03:22", "h": 1.62, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-27T03:26", "h": 1.66, "k": "L", "port": "Newlyn"}, {"t": "2025-12-27T03:50", "h": 1.85, "k": "L", "port": "Plymouth"}, {"t": "2025-12-27T03:52", "h": 1.24, "k": "L", "port": "Bundoran"}, {"t": "2025-12-27T03:53", "h": 1.04, "k": "L", "port": "Cork"}, {"t": "2025-12-27T04:06", "h": 1.26, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-27T04:11", "h": 1.17, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-27T04:19", "h": 2.21, "k": "L", "port": "Llangennith"}, {"t": "2025-12-27T04:28", "h": 3.33, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-27T04:39", "h": 1.91, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-27T04:58", "h": 0.73, "k": "L", "port": "Croyde"}, {"t": "2025-12-27T05:12", "h": 2.62, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-27T05:23", "h": 1.88, "k": "L", "port": "Stornoway"}, {"t": "2025-12-27T05:58", "h": 0.83, "k": "L", "port": "Londonderry"}, {"t": "2025-12-27T06:08", "h": 3.62, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-27T06:08", "h": 1.76, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-27T06:47", "h": 1.56, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-27T07:10", "h": 2.01, "k": "L", "port": "Thurso"}, {"t": "2025-12-27T07:43", "h": 2.01, "k": "L", "port": "Skirza"}, {"t": "2025-12-27T08:11", "h": 4.31, "k": "H", "port": "North Shields"}, {"t": "2025-12-27T08:46", "h": 4.72, "k": "H", "port": "Whitby"}, {"t": "2025-12-27T08:59", "h": 4.85, "k": "H", "port": "Scarborough"}, {"t": "2025-12-27T09:11", "h": 4.95, "k": "H", "port": "Newlyn"}, {"t": "2025-12-27T09:18", "h": 3.53, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-27T09:40", "h": 3.97, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-27T09:53", "h": 4.96, "k": "H", "port": "Plymouth"}, {"t": "2025-12-27T09:54", "h": 3.62, "k": "H", "port": "Cork"}, {"t": "2025-12-27T10:12", "h": 1.65, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-27T10:24", "h": 3.54, "k": "H", "port": "Bundoran"}, {"t": "2025-12-27T10:31", "h": 1.14, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-27T10:32", "h": 3.13, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-27T10:35", "h": 7.38, "k": "H", "port": "Llangennith"}, {"t": "2025-12-27T10:41", "h": 3.41, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-27T10:43", "h": 5.95, "k": "H", "port": "Croyde"}, {"t": "2025-12-27T10:51", "h": 6.09, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-27T11:33", "h": 4.38, "k": "H", "port": "Stornoway"}, {"t": "2025-12-27T11:51", "h": 1.74, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-27T12:20", "h": 3.99, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-27T12:27", "h": 2.21, "k": "H", "port": "Londonderry"}, {"t": "2025-12-27T12:34", "h": 4.36, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-27T13:18", "h": 4.28, "k": "H", "port": "Thurso"}, {"t": "2025-12-27T14:03", "h": 1.8, "k": "L", "port": "North Shields"}, {"t": "2025-12-27T14:11", "h": 3.93, "k": "H", "port": "Skirza"}, {"t": "2025-12-27T14:38", "h": 2.14, "k": "L", "port": "Whitby"}, {"t": "2025-12-27T14:59", "h": 2.34, "k": "L", "port": "Scarborough"}, {"t": "2025-12-27T15:38", "h": 1.17, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-27T15:57", "h": 1.6, "k": "L", "port": "Newlyn"}, {"t": "2025-12-27T16:00", "h": 1.33, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-27T16:25", "h": 1.79, "k": "L", "port": "Plymouth"}, {"t": "2025-12-27T16:25", "h": 1.17, "k": "L", "port": "Cork"}, {"t": "2025-12-27T16:26", "h": 3.67, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-27T16:48", "h": 0.96, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-27T16:51", "h": 1.16, "k": "L", "port": "Bundoran"}, {"t": "2025-12-27T16:52", "h": 2.22, "k": "L", "port": "Llangennith"}, {"t": "2025-12-27T17:03", "h": 1.21, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-27T17:09", "h": 3.02, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-27T17:17", "h": 1.9, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-27T17:29", "h": 0.73, "k": "L", "port": "Croyde"}, {"t": "2025-12-27T18:07", "h": 3.96, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-27T18:15", "h": 1.64, "k": "L", "port": "Stornoway"}, {"t": "2025-12-27T18:55", "h": 1.41, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-27T19:19", "h": 0.95, "k": "L", "port": "Londonderry"}, {"t": "2025-12-27T19:41", "h": 1.46, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-27T20:00", "h": 1.56, "k": "L", "port": "Thurso"}, {"t": "2025-12-27T20:12", "h": 4.62, "k": "H", "port": "North Shields"}, {"t": "2025-12-27T20:33", "h": 1.58, "k": "L", "port": "Skirza"}, {"t": "2025-12-27T20:44", "h": 5.04, "k": "H", "port": "Whitby"}, {"t": "2025-12-27T21:03", "h": 5.29, "k": "H", "port": "Scarborough"}, {"t": "2025-12-27T21:39", "h": 4.62, "k": "H", "port": "Newlyn"}, {"t": "2025-12-27T22:02", "h": 3.36, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-27T22:19", "h": 3.5, "k": "H", "port": "Cork"}, {"t": "2025-12-27T22:26", "h": 3.79, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-27T22:27", "h": 4.67, "k": "H", "port": "Plymouth"}, {"t": "2025-12-27T23:02", "h": 3.0, "k": "H", "port": "Bundoran"}, {"t": "2025-12-27T23:03", "h": 1.18, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-27T23:04", "h": 7.03, "k": "H", "port": "Llangennith"}, {"t": "2025-12-27T23:12", "h": 5.61, "k": "H", "port": "Croyde"}, {"t": "2025-12-27T23:12", "h": 2.99, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-27T23:19", "h": 2.9, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-27T23:23", "h": 5.68, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-27T23:24", "h": 0.8, "k": "L", "port": "Campbeltown"}], "sunrise": "2025-12-27T08:20", "sunset": "2025-12-27T16:22"}, "2025-12-28": {"by_port": {"stornoway": [{"t": "2025-12-28T00:21", "h": 3.84, "k": "H", "port": "Stornoway"}, {"t": "2025-12-28T06:26", "h": 1.99, "k": "L", "port": "Stornoway"}, {"t": "2025-12-28T12:36", "h": 4.27, "k": "H", "port": "Stornoway"}, {"t": "2025-12-28T19:21", "h": 1.71, "k": "L", "port": "Stornoway"}], "aberdeen": [{"t": "2025-12-28T00:40", "h": 1.28, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-28T07:07", "h": 3.56, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-28T12:54", "h": 1.78, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-28T19:11", "h": 3.88, "k": "H", "port": "Aberdeen"}], "londonderry": [{"t": "2025-12-28T00:52", "h": 1.74, "k": "H", "port": "Londonderry"}, {"t": "2025-12-28T06:57", "h": 0.9, "k": "L", "port": "Londonderry"}, {"t": "2025-12-28T13:33", "h": 2.16, "k": "H", "port": "Londonderry"}, {"t": "2025-12-28T20:29", "h": 0.96, "k": "L", "port": "Londonderry"}], "aberystwyth": [{"t": "2025-12-28T01:09", "h": 3.85, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-28T07:43", "h": 1.65, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-28T13:40", "h": 4.23, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-28T20:43", "h": 1.53, "k": "L", "port": "Aberystwyth"}], "cape wrath": [{"t": "2025-12-28T01:17", "h": 3.65, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-28T07:11", "h": 1.86, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-28T13:20", "h": 3.9, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-28T19:59", "h": 1.46, "k": "L", "port": "Cape Wrath"}], "thurso": [{"t": "2025-12-28T02:20", "h": 3.85, "k": "H", "port": "Thurso"}, {"t": "2025-12-28T08:14", "h": 2.09, "k": "L", "port": "Thurso"}, {"t": "2025-12-28T14:23", "h": 4.18, "k": "H", "port": "Thurso"}, {"t": "2025-12-28T21:05", "h": 1.62, "k": "L", "port": "Thurso"}], "north shields": [{"t": "2025-12-28T02:49", "h": 1.4, "k": "L", "port": "North Shields"}, {"t": "2025-12-28T09:09", "h": 4.24, "k": "H", "port": "North Shields"}, {"t": "2025-12-28T15:04", "h": 1.91, "k": "L", "port": "North Shields"}, {"t": "2025-12-28T21:13", "h": 4.54, "k": "H", "port": "North Shields"}], "skirza": [{"t": "2025-12-28T03:12", "h": 3.53, "k": "H", "port": "Skirza"}, {"t": "2025-12-28T08:47", "h": 2.07, "k": "L", "port": "Skirza"}, {"t": "2025-12-28T15:11", "h": 3.85, "k": "H", "port": "Skirza"}, {"t": "2025-12-28T21:37", "h": 1.63, "k": "L", "port": "Skirza"}], "whitby": [{"t": "2025-12-28T03:22", "h": 1.69, "k": "L", "port": "Whitby"}, {"t": "2025-12-28T09:45", "h": 4.64, "k": "H", "port": "Whitby"}, {"t": "2025-12-28T15:39", "h": 2.25, "k": "L", "port": "Whitby"}, {"t": "2025-12-28T21:47", "h": 4.96, "k": "H", "port": "Whitby"}], "scarborough": [{"t": "2025-12-28T03:46", "h": 1.78, "k": "L", "port": "Scarborough"}, {"t": "2025-12-28T09:59", "h": 4.79, "k": "H", "port": "Scarborough"}, {"t": "2025-12-28T16:01", "h": 2.41, "k": "L", "port": "Scarborough"}, {"t": "2025-12-28T22:07", "h": 5.19, "k": "H", "port": "Scarborough"}], "coomeenole": [{"t": "2025-12-28T04:02", "h": 1.46, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-28T10:17", "h": 3.44, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-28T16:40", "h": 1.21, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-28T23:05", "h": 3.36, "k": "H", "port": "Coomeenole"}], "newlyn": [{"t": "2025-12-28T04:19", "h": 1.77, "k": "L", "port": "Newlyn"}, {"t": "2025-12-28T10:11", "h": 4.83, "k": "H", "port": "Newlyn"}, {"t": "2025-12-28T16:55", "h": 1.7, "k": "L", "port": "Newlyn"}, {"t": "2025-12-28T22:46", "h": 4.55, "k": "H", "port": "Newlyn"}], "doonbeg": [{"t": "2025-12-28T04:25", "h": 1.68, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-28T10:40", "h": 3.86, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-28T17:02", "h": 1.38, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-28T23:29", "h": 3.8, "k": "H", "port": "Doonbeg"}], "plymouth": [{"t": "2025-12-28T04:45", "h": 1.99, "k": "L", "port": "Plymouth"}, {"t": "2025-12-28T10:49", "h": 4.84, "k": "H", "port": "Plymouth"}, {"t": "2025-12-28T17:24", "h": 1.92, "k": "L", "port": "Plymouth"}, {"t": "2025-12-28T23:28", "h": 4.62, "k": "H", "port": "Plymouth"}], "cork": [{"t": "2025-12-28T04:50", "h": 1.11, "k": "L", "port": "Cork"}, {"t": "2025-12-28T10:55", "h": 3.54, "k": "H", "port": "Cork"}, {"t": "2025-12-28T17:25", "h": 1.22, "k": "L", "port": "Cork"}, {"t": "2025-12-28T23:24", "h": 3.47, "k": "H", "port": "Cork"}], "bundoran": [{"t": "2025-12-28T04:52", "h": 1.35, "k": "L", "port": "Bundoran"}, {"t": "2025-12-28T11:22", "h": 3.45, "k": "H", "port": "Bundoran"}, {"t": "2025-12-28T17:53", "h": 1.17, "k": "L", "port": "Bundoran"}], "inishcrone": [{"t": "2025-12-28T05:07", "h": 1.32, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-28T11:33", "h": 3.02, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-28T17:50", "h": 1.04, "k": "L", "port": "Inishcrone"}], "falcarragh": [{"t": "2025-12-28T05:10", "h": 1.27, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-28T11:41", "h": 3.34, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-28T18:06", "h": 1.23, "k": "L", "port": "Falcarragh"}], "llangennith": [{"t": "2025-12-28T05:15", "h": 2.38, "k": "L", "port": "Llangennith"}, {"t": "2025-12-28T11:32", "h": 7.19, "k": "H", "port": "Llangennith"}, {"t": "2025-12-28T17:53", "h": 2.35, "k": "L", "port": "Llangennith"}], "lossiemouth": [{"t": "2025-12-28T05:26", "h": 3.28, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-28T11:14", "h": 1.68, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-28T17:30", "h": 3.6, "k": "H", "port": "Lossiemouth"}], "milfordhaven": [{"t": "2025-12-28T05:36", "h": 2.05, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-28T11:51", "h": 5.92, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-28T18:17", "h": 2.02, "k": "L", "port": "MilfordHaven"}], "croyde": [{"t": "2025-12-28T05:49", "h": 0.87, "k": "L", "port": "Croyde"}, {"t": "2025-12-28T11:42", "h": 5.75, "k": "H", "port": "Croyde"}, {"t": "2025-12-28T18:24", "h": 0.88, "k": "L", "port": "Croyde"}], "campbeltown": [{"t": "2025-12-28T06:04", "h": 2.59, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-28T11:29", "h": 1.15, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-28T18:06", "h": 2.97, "k": "H", "port": "Campbeltown"}]}, "ext": [{"t": "2025-12-28T00:21", "h": 3.84, "k": "H", "port": "Stornoway"}, {"t": "2025-12-28T00:40", "h": 1.28, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-28T00:52", "h": 1.74, "k": "H", "port": "Londonderry"}, {"t": "2025-12-28T01:09", "h": 3.85, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-28T01:17", "h": 3.65, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-28T02:20", "h": 3.85, "k": "H", "port": "Thurso"}, {"t": "2025-12-28T02:49", "h": 1.4, "k": "L", "port": "North Shields"}, {"t": "2025-12-28T03:12", "h": 3.53, "k": "H", "port": "Skirza"}, {"t": "2025-12-28T03:22", "h": 1.69, "k": "L", "port": "Whitby"}, {"t": "2025-12-28T03:46", "h": 1.78, "k": "L", "port": "Scarborough"}, {"t": "2025-12-28T04:02", "h": 1.46, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-28T04:19", "h": 1.77, "k": "L", "port": "Newlyn"}, {"t": "2025-12-28T04:25", "h": 1.68, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-28T04:45", "h": 1.99, "k": "L", "port": "Plymouth"}, {"t": "2025-12-28T04:50", "h": 1.11, "k": "L", "port": "Cork"}, {"t": "2025-12-28T04:52", "h": 1.35, "k": "L", "port": "Bundoran"}, {"t": "2025-12-28T05:07", "h": 1.32, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-28T05:10", "h": 1.27, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-28T05:15", "h": 2.38, "k": "L", "port": "Llangennith"}, {"t": "2025-12-28T05:26", "h": 3.28, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-28T05:36", "h": 2.05, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-28T05:49", "h": 0.87, "k": "L", "port": "Croyde"}, {"t": "2025-12-28T06:04", "h": 2.59, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-28T06:26", "h": 1.99, "k": "L", "port": "Stornoway"}, {"t": "2025-12-28T06:57", "h": 0.9, "k": "L", "port": "Londonderry"}, {"t": "2025-12-28T07:07", "h": 3.56, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-28T07:11", "h": 1.86, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-28T07:43", "h": 1.65, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-28T08:14", "h": 2.09, "k": "L", "port": "Thurso"}, {"t": "2025-12-28T08:47", "h": 2.07, "k": "L", "port": "Skirza"}, {"t": "2025-12-28T09:09", "h": 4.24, "k": "H", "port": "North Shields"}, {"t": "2025-12-28T09:45", "h": 4.64, "k": "H", "port": "Whitby"}, {"t": "2025-12-28T09:59", "h": 4.79, "k": "H", "port": "Scarborough"}, {"t": "2025-12-28T10:11", "h": 4.83, "k": "H", "port": "Newlyn"}, {"t": "2025-12-28T10:17", "h": 3.44, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-28T10:40", "h": 3.86, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-28T10:49", "h": 4.84, "k": "H", "port": "Plymouth"}, {"t": "2025-12-28T10:55", "h": 3.54, "k": "H", "port": "Cork"}, {"t": "2025-12-28T11:14", "h": 1.68, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-28T11:22", "h": 3.45, "k": "H", "port": "Bundoran"}, {"t": "2025-12-28T11:29", "h": 1.15, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-28T11:32", "h": 7.19, "k": "H", "port": "Llangennith"}, {"t": "2025-12-28T11:33", "h": 3.02, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-28T11:41", "h": 3.34, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-28T11:42", "h": 5.75, "k": "H", "port": "Croyde"}, {"t": "2025-12-28T11:51", "h": 5.92, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-28T12:36", "h": 4.27, "k": "H", "port": "Stornoway"}, {"t": "2025-12-28T12:54", "h": 1.78, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-28T13:20", "h": 3.9, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-28T13:33", "h": 2.16, "k": "H", "port": "Londonderry"}, {"t": "2025-12-28T13:40", "h": 4.23, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-28T14:23", "h": 4.18, "k": "H", "port": "Thurso"}, {"t": "2025-12-28T15:04", "h": 1.91, "k": "L", "port": "North Shields"}, {"t": "2025-12-28T15:11", "h": 3.85, "k": "H", "port": "Skirza"}, {"t": "2025-12-28T15:39", "h": 2.25, "k": "L", "port": "Whitby"}, {"t": "2025-12-28T16:01", "h": 2.41, "k": "L", "port": "Scarborough"}, {"t": "2025-12-28T16:40", "h": 1.21, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-28T16:55", "h": 1.7, "k": "L", "port": "Newlyn"}, {"t": "2025-12-28T17:02", "h": 1.38, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-28T17:24", "h": 1.92, "k": "L", "port": "Plymouth"}, {"t": "2025-12-28T17:25", "h": 1.22, "k": "L", "port": "Cork"}, {"t": "2025-12-28T17:30", "h": 3.6, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-28T17:50", "h": 1.04, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-28T17:53", "h": 2.35, "k": "L", "port": "Llangennith"}, {"t": "2025-12-28T17:53", "h": 1.17, "k": "L", "port": "Bundoran"}, {"t": "2025-12-28T18:06", "h": 1.23, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-28T18:06", "h": 2.97, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-28T18:17", "h": 2.02, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-28T18:24", "h": 0.88, "k": "L", "port": "Croyde"}, {"t": "2025-12-28T19:11", "h": 3.88, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-28T19:21", "h": 1.71, "k": "L", "port": "Stornoway"}, {"t": "2025-12-28T19:59", "h": 1.46, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-28T20:29", "h": 0.96, "k": "L", "port": "Londonderry"}, {"t": "2025-12-28T20:43", "h": 1.53, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-28T21:05", "h": 1.62, "k": "L", "port": "Thurso"}, {"t": "2025-12-28T21:13", "h": 4.54, "k": "H", "port": "North Shields"}, {"t": "2025-12-28T21:37", "h": 1.63, "k": "L", "port": "Skirza"}, {"t": "2025-12-28T21:47", "h": 4.96, "k": "H", "port": "Whitby"}, {"t": "2025-12-28T22:07", "h": 5.19, "k": "H", "port": "Scarborough"}, {"t": "2025-12-28T22:46", "h": 4.55, "k": "H", "port": "Newlyn"}, {"t": "2025-12-28T23:05", "h": 3.36, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-28T23:24", "h": 3.47, "k": "H", "port": "Cork"}, {"t": "2025-12-28T23:28", "h": 4.62, "k": "H", "port": "Plymouth"}, {"t": "2025-12-28T23:29", "h": 3.8, "k": "H", "port": "Doonbeg"}], "sunrise": "2025-12-28T08:20", "sunset": "2025-12-28T16:22"}, "2025-12-29": {"by_port": {"lossiemouth": [{"t": "2025-12-29T00:07", "h": 1.24, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-29T06:31", "h": 3.29, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-29T12:26", "h": 1.65, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-29T18:42", "h": 3.58, "k": "H", "port": "Lossiemouth"}], "llangennith": [{"t": "2025-12-29T00:07", "h": 6.91, "k": "H", "port": "Llangennith"}, {"t": "2025-12-29T06:21", "h": 2.48, "k": "L", "port": "Llangennith"}, {"t": "2025-12-29T12:40", "h": 7.08, "k": "H", "port": "Llangennith"}, {"t": "2025-12-29T19:01", "h": 2.4, "k": "L", "port": "Llangennith"}], "bundoran": [{"t": "2025-12-29T00:08", "h": 3.01, "k": "H", "port": "Bundoran"}, {"t": "2025-12-29T06:01", "h": 1.4, "k": "L", "port": "Bundoran"}, {"t": "2025-12-29T12:28", "h": 3.4, "k": "H", "port": "Bundoran"}, {"t": "2025-12-29T18:59", "h": 1.15, "k": "L", "port": "Bundoran"}], "croyde": [{"t": "2025-12-29T00:15", "h": 5.5, "k": "H", "port": "Croyde"}, {"t": "2025-12-29T06:50", "h": 0.96, "k": "L", "port": "Croyde"}, {"t": "2025-12-29T12:48", "h": 5.63, "k": "H", "port": "Croyde"}, {"t": "2025-12-29T19:29", "h": 0.94, "k": "L", "port": "Croyde"}], "falcarragh": [{"t": "2025-12-29T00:20", "h": 2.98, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-29T06:19", "h": 1.32, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-29T12:49", "h": 3.33, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-29T19:14", "h": 1.21, "k": "L", "port": "Falcarragh"}], "inishcrone": [{"t": "2025-12-29T00:22", "h": 2.92, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-29T06:19", "h": 1.3, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-29T12:42", "h": 2.98, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-29T18:57", "h": 1.04, "k": "L", "port": "Inishcrone"}], "campbeltown": [{"t": "2025-12-29T00:23", "h": 0.83, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-29T07:01", "h": 2.6, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-29T12:33", "h": 1.13, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-29T19:09", "h": 2.93, "k": "H", "port": "Campbeltown"}], "milfordhaven": [{"t": "2025-12-29T00:28", "h": 5.6, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-29T06:43", "h": 2.13, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-29T13:01", "h": 5.83, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-29T19:26", "h": 2.05, "k": "L", "port": "MilfordHaven"}], "stornoway": [{"t": "2025-12-29T01:30", "h": 3.86, "k": "H", "port": "Stornoway"}, {"t": "2025-12-29T07:40", "h": 2.02, "k": "L", "port": "Stornoway"}, {"t": "2025-12-29T13:48", "h": 4.21, "k": "H", "port": "Stornoway"}, {"t": "2025-12-29T20:32", "h": 1.7, "k": "L", "port": "Stornoway"}], "aberdeen": [{"t": "2025-12-29T01:46", "h": 1.35, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-29T08:12", "h": 3.57, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-29T14:06", "h": 1.75, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-29T20:24", "h": 3.85, "k": "H", "port": "Aberdeen"}], "londonderry": [{"t": "2025-12-29T02:08", "h": 1.76, "k": "H", "port": "Londonderry"}, {"t": "2025-12-29T08:19", "h": 0.94, "k": "L", "port": "Londonderry"}, {"t": "2025-12-29T14:44", "h": 2.15, "k": "H", "port": "Londonderry"}, {"t": "2025-12-29T21:42", "h": 0.91, "k": "L", "port": "Londonderry"}], "aberystwyth": [{"t": "2025-12-29T02:21", "h": 3.83, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-29T08:56", "h": 1.68, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-29T14:54", "h": 4.17, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-29T21:54", "h": 1.52, "k": "L", "port": "Aberystwyth"}], "cape wrath": [{"t": "2025-12-29T02:22", "h": 3.67, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-29T08:24", "h": 1.88, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-29T14:30", "h": 3.88, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-29T21:08", "h": 1.46, "k": "L", "port": "Cape Wrath"}], "thurso": [{"t": "2025-12-29T03:27", "h": 3.87, "k": "H", "port": "Thurso"}, {"t": "2025-12-29T09:29", "h": 2.08, "k": "L", "port": "Thurso"}, {"t": "2025-12-29T15:36", "h": 4.13, "k": "H", "port": "Thurso"}, {"t": "2025-12-29T22:14", "h": 1.61, "k": "L", "port": "Thurso"}], "north shields": [{"t": "2025-12-29T03:56", "h": 1.46, "k": "L", "port": "North Shields"}, {"t": "2025-12-29T10:15", "h": 4.22, "k": "H", "port": "North Shields"}, {"t": "2025-12-29T16:17", "h": 1.94, "k": "L", "port": "North Shields"}, {"t": "2025-12-29T22:23", "h": 4.51, "k": "H", "port": "North Shields"}], "skirza": [{"t": "2025-12-29T04:16", "h": 3.55, "k": "H", "port": "Skirza"}, {"t": "2025-12-29T09:59", "h": 2.05, "k": "L", "port": "Skirza"}, {"t": "2025-12-29T16:21", "h": 3.8, "k": "H", "port": "Skirza"}, {"t": "2025-12-29T22:45", "h": 1.63, "k": "L", "port": "Skirza"}], "whitby": [{"t": "2025-12-29T04:27", "h": 1.76, "k": "L", "port": "Whitby"}, {"t": "2025-12-29T10:50", "h": 4.63, "k": "H", "port": "Whitby"}, {"t": "2025-12-29T16:50", "h": 2.28, "k": "L", "port": "Whitby"}, {"t": "2025-12-29T22:58", "h": 4.94, "k": "H", "port": "Whitby"}], "scarborough": [{"t": "2025-12-29T04:50", "h": 1.86, "k": "L", "port": "Scarborough"}, {"t": "2025-12-29T11:05", "h": 4.8, "k": "H", "port": "Scarborough"}, {"t": "2025-12-29T17:12", "h": 2.39, "k": "L", "port": "Scarborough"}, {"t": "2025-12-29T23:18", "h": 5.15, "k": "H", "port": "Scarborough"}], "coomeenole": [{"t": "2025-12-29T05:11", "h": 1.46, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-29T11:26", "h": 3.41, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-29T17:46", "h": 1.22, "k": "L", "port": "Coomeenole"}], "newlyn": [{"t": "2025-12-29T05:24", "h": 1.85, "k": "L", "port": "Newlyn"}, {"t": "2025-12-29T11:20", "h": 4.76, "k": "H", "port": "Newlyn"}, {"t": "2025-12-29T18:03", "h": 1.74, "k": "L", "port": "Newlyn"}], "doonbeg": [{"t": "2025-12-29T05:34", "h": 1.67, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-29T11:49", "h": 3.83, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-29T18:08", "h": 1.4, "k": "L", "port": "Doonbeg"}], "plymouth": [{"t": "2025-12-29T05:51", "h": 2.09, "k": "L", "port": "Plymouth"}, {"t": "2025-12-29T11:55", "h": 4.73, "k": "H", "port": "Plymouth"}, {"t": "2025-12-29T18:31", "h": 2.0, "k": "L", "port": "Plymouth"}], "cork": [{"t": "2025-12-29T05:56", "h": 1.15, "k": "L", "port": "Cork"}, {"t": "2025-12-29T12:04", "h": 3.5, "k": "H", "port": "Cork"}, {"t": "2025-12-29T18:34", "h": 1.22, "k": "L", "port": "Cork"}]}, "ext": [{"t": "2025-12-29T00:07", "h": 1.24, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-29T00:07", "h": 6.91, "k": "H", "port": "Llangennith"}, {"t": "2025-12-29T00:08", "h": 3.01, "k": "H", "port": "Bundoran"}, {"t": "2025-12-29T00:15", "h": 5.5, "k": "H", "port": "Croyde"}, {"t": "2025-12-29T00:20", "h": 2.98, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-29T00:22", "h": 2.92, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-29T00:23", "h": 0.83, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-29T00:28", "h": 5.6, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-29T01:30", "h": 3.86, "k": "H", "port": "Stornoway"}, {"t": "2025-12-29T01:46", "h": 1.35, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-29T02:08", "h": 1.76, "k": "H", "port": "Londonderry"}, {"t": "2025-12-29T02:21", "h": 3.83, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-29T02:22", "h": 3.67, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-29T03:27", "h": 3.87, "k": "H", "port": "Thurso"}, {"t": "2025-12-29T03:56", "h": 1.46, "k": "L", "port": "North Shields"}, {"t": "2025-12-29T04:16", "h": 3.55, "k": "H", "port": "Skirza"}, {"t": "2025-12-29T04:27", "h": 1.76, "k": "L", "port": "Whitby"}, {"t": "2025-12-29T04:50", "h": 1.86, "k": "L", "port": "Scarborough"}, {"t": "2025-12-29T05:11", "h": 1.46, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-29T05:24", "h": 1.85, "k": "L", "port": "Newlyn"}, {"t": "2025-12-29T05:34", "h": 1.67, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-29T05:51", "h": 2.09, "k": "L", "port": "Plymouth"}, {"t": "2025-12-29T05:56", "h": 1.15, "k": "L", "port": "Cork"}, {"t": "2025-12-29T06:01", "h": 1.4, "k": "L", "port": "Bundoran"}, {"t": "2025-12-29T06:19", "h": 1.3, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-29T06:19", "h": 1.32, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-29T06:21", "h": 2.48, "k": "L", "port": "Llangennith"}, {"t": "2025-12-29T06:31", "h": 3.29, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-29T06:43", "h": 2.13, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-29T06:50", "h": 0.96, "k": "L", "port": "Croyde"}, {"t": "2025-12-29T07:01", "h": 2.6, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-29T07:40", "h": 2.02, "k": "L", "port": "Stornoway"}, {"t": "2025-12-29T08:12", "h": 3.57, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-29T08:19", "h": 0.94, "k": "L", "port": "Londonderry"}, {"t": "2025-12-29T08:24", "h": 1.88, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-29T08:56", "h": 1.68, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-29T09:29", "h": 2.08, "k": "L", "port": "Thurso"}, {"t": "2025-12-29T09:59", "h": 2.05, "k": "L", "port": "Skirza"}, {"t": "2025-12-29T10:15", "h": 4.22, "k": "H", "port": "North Shields"}, {"t": "2025-12-29T10:50", "h": 4.63, "k": "H", "port": "Whitby"}, {"t": "2025-12-29T11:05", "h": 4.8, "k": "H", "port": "Scarborough"}, {"t": "2025-12-29T11:20", "h": 4.76, "k": "H", "port": "Newlyn"}, {"t": "2025-12-29T11:26", "h": 3.41, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-29T11:49", "h": 3.83, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-29T11:55", "h": 4.73, "k": "H", "port": "Plymouth"}, {"t": "2025-12-29T12:04", "h": 3.5, "k": "H", "port": "Cork"}, {"t": "2025-12-29T12:26", "h": 1.65, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-29T12:28", "h": 3.4, "k": "H", "port": "Bundoran"}, {"t": "2025-12-29T12:33", "h": 1.13, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-29T12:40", "h": 7.08, "k": "H", "port": "Llangennith"}, {"t": "2025-12-29T12:42", "h": 2.98, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-29T12:48", "h": 5.63, "k": "H", "port": "Croyde"}, {"t": "2025-12-29T12:49", "h": 3.33, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-29T13:01", "h": 5.83, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-29T13:48", "h": 4.21, "k": "H", "port": "Stornoway"}, {"t": "2025-12-29T14:06", "h": 1.75, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-29T14:30", "h": 3.88, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-29T14:44", "h": 2.15, "k": "H", "port": "Londonderry"}, {"t": "2025-12-29T14:54", "h": 4.17, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-29T15:36", "h": 4.13, "k": "H", "port": "Thurso"}, {"t": "2025-12-29T16:17", "h": 1.94, "k": "L", "port": "North Shields"}, {"t": "2025-12-29T16:21", "h": 3.8, "k": "H", "port": "Skirza"}, {"t": "2025-12-29T16:50", "h": 2.28, "k": "L", "port": "Whitby"}, {"t": "2025-12-29T17:12", "h": 2.39, "k": "L", "port": "Scarborough"}, {"t": "2025-12-29T17:46", "h": 1.22, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-29T18:03", "h": 1.74, "k": "L", "port": "Newlyn"}, {"t": "2025-12-29T18:08", "h": 1.4, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-29T18:31", "h": 2.0, "k": "L", "port": "Plymouth"}, {"t": "2025-12-29T18:34", "h": 1.22, "k": "L", "port": "Cork"}, {"t": "2025-12-29T18:42", "h": 3.58, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-29T18:57", "h": 1.04, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-29T18:59", "h": 1.15, "k": "L", "port": "Bundoran"}, {"t": "2025-12-29T19:01", "h": 2.4, "k": "L", "port": "Llangennith"}, {"t": "2025-12-29T19:09", "h": 2.93, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-29T19:14", "h": 1.21, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-29T19:26", "h": 2.05, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-29T19:29", "h": 0.94, "k": "L", "port": "Croyde"}, {"t": "2025-12-29T20:24", "h": 3.85, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-29T20:32", "h": 1.7, "k": "L", "port": "Stornoway"}, {"t": "2025-12-29T21:08", "h": 1.46, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-29T21:42", "h": 0.91, "k": "L", "port": "Londonderry"}, {"t": "2025-12-29T21:54", "h": 1.52, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-29T22:14", "h": 1.61, "k": "L", "port": "Thurso"}, {"t": "2025-12-29T22:23", "h": 4.51, "k": "H", "port": "North Shields"}, {"t": "2025-12-29T22:45", "h": 1.63, "k": "L", "port": "Skirza"}, {"t": "2025-12-29T22:58", "h": 4.94, "k": "H", "port": "Whitby"}, {"t": "2025-12-29T23:18", "h": 5.15, "k": "H", "port": "Scarborough"}], "sunrise": "2025-12-29T08:20", "sunset": "2025-12-29T16:23"}, "2025-12-30": {"by_port": {"newlyn": [{"t": "2025-12-30T00:00", "h": 4.58, "k": "H", "port": "Newlyn"}, {"t": "2025-12-30T06:38", "h": 1.82, "k": "L", "port": "Newlyn"}, {"t": "2025-12-30T12:34", "h": 4.79, "k": "H", "port": "Newlyn"}, {"t": "2025-12-30T19:16", "h": 1.68, "k": "L", "port": "Newlyn"}], "coomeenole": [{"t": "2025-12-30T00:13", "h": 3.43, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-30T06:21", "h": 1.37, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-30T12:38", "h": 3.47, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-30T18:53", "h": 1.17, "k": "L", "port": "Coomeenole"}], "doonbeg": [{"t": "2025-12-30T00:36", "h": 3.88, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-30T06:45", "h": 1.56, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-30T13:02", "h": 3.89, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-30T19:15", "h": 1.34, "k": "L", "port": "Doonbeg"}], "cork": [{"t": "2025-12-30T00:36", "h": 3.49, "k": "H", "port": "Cork"}, {"t": "2025-12-30T07:09", "h": 1.12, "k": "L", "port": "Cork"}, {"t": "2025-12-30T13:15", "h": 3.54, "k": "H", "port": "Cork"}, {"t": "2025-12-30T19:45", "h": 1.14, "k": "L", "port": "Cork"}], "plymouth": [{"t": "2025-12-30T00:39", "h": 4.62, "k": "H", "port": "Plymouth"}, {"t": "2025-12-30T07:06", "h": 2.1, "k": "L", "port": "Plymouth"}, {"t": "2025-12-30T13:10", "h": 4.69, "k": "H", "port": "Plymouth"}, {"t": "2025-12-30T19:45", "h": 1.98, "k": "L", "port": "Plymouth"}], "lossiemouth": [{"t": "2025-12-30T01:17", "h": 1.27, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-30T07:37", "h": 3.38, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-30T13:44", "h": 1.54, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-30T19:56", "h": 3.61, "k": "H", "port": "Lossiemouth"}], "bundoran": [{"t": "2025-12-30T01:17", "h": 3.11, "k": "H", "port": "Bundoran"}, {"t": "2025-12-30T07:16", "h": 1.35, "k": "L", "port": "Bundoran"}, {"t": "2025-12-30T13:38", "h": 3.42, "k": "H", "port": "Bundoran"}, {"t": "2025-12-30T20:03", "h": 1.08, "k": "L", "port": "Bundoran"}], "llangennith": [{"t": "2025-12-30T01:19", "h": 6.93, "k": "H", "port": "Llangennith"}, {"t": "2025-12-30T07:34", "h": 2.46, "k": "L", "port": "Llangennith"}, {"t": "2025-12-30T13:54", "h": 7.13, "k": "H", "port": "Llangennith"}, {"t": "2025-12-30T20:15", "h": 2.32, "k": "L", "port": "Llangennith"}], "croyde": [{"t": "2025-12-30T01:24", "h": 5.51, "k": "H", "port": "Croyde"}, {"t": "2025-12-30T08:01", "h": 0.95, "k": "L", "port": "Croyde"}, {"t": "2025-12-30T13:59", "h": 5.65, "k": "H", "port": "Croyde"}, {"t": "2025-12-30T20:40", "h": 0.89, "k": "L", "port": "Croyde"}], "campbeltown": [{"t": "2025-12-30T01:24", "h": 0.86, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-30T08:02", "h": 2.65, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-30T13:41", "h": 1.07, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-30T20:18", "h": 2.91, "k": "H", "port": "Campbeltown"}], "inishcrone": [{"t": "2025-12-30T01:28", "h": 3.02, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-30T07:33", "h": 1.17, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-30T13:53", "h": 3.03, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-30T20:03", "h": 0.95, "k": "L", "port": "Inishcrone"}], "falcarragh": [{"t": "2025-12-30T01:31", "h": 3.07, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-30T07:32", "h": 1.27, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-30T13:59", "h": 3.38, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-30T20:20", "h": 1.13, "k": "L", "port": "Falcarragh"}], "milfordhaven": [{"t": "2025-12-30T01:40", "h": 5.65, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-30T07:57", "h": 2.08, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-30T14:14", "h": 5.87, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-30T20:37", "h": 1.94, "k": "L", "port": "MilfordHaven"}], "stornoway": [{"t": "2025-12-30T02:42", "h": 3.98, "k": "H", "port": "Stornoway"}, {"t": "2025-12-30T08:59", "h": 1.92, "k": "L", "port": "Stornoway"}, {"t": "2025-12-30T15:02", "h": 4.23, "k": "H", "port": "Stornoway"}, {"t": "2025-12-30T21:41", "h": 1.59, "k": "L", "port": "Stornoway"}], "aberdeen": [{"t": "2025-12-30T02:55", "h": 1.36, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-30T09:20", "h": 3.65, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-30T15:20", "h": 1.62, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-30T21:39", "h": 3.9, "k": "H", "port": "Aberdeen"}], "londonderry": [{"t": "2025-12-30T03:22", "h": 1.87, "k": "H", "port": "Londonderry"}, {"t": "2025-12-30T09:47", "h": 0.9, "k": "L", "port": "Londonderry"}, {"t": "2025-12-30T15:50", "h": 2.18, "k": "H", "port": "Londonderry"}, {"t": "2025-12-30T22:47", "h": 0.81, "k": "L", "port": "Londonderry"}], "cape wrath": [{"t": "2025-12-30T03:29", "h": 3.77, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-30T09:38", "h": 1.77, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-30T15:42", "h": 3.94, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-30T22:16", "h": 1.39, "k": "L", "port": "Cape Wrath"}], "aberystwyth": [{"t": "2025-12-30T03:36", "h": 3.93, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-30T10:18", "h": 1.61, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-30T16:09", "h": 4.24, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-30T23:06", "h": 1.43, "k": "L", "port": "Aberystwyth"}], "thurso": [{"t": "2025-12-30T04:35", "h": 3.99, "k": "H", "port": "Thurso"}, {"t": "2025-12-30T10:44", "h": 1.94, "k": "L", "port": "Thurso"}, {"t": "2025-12-30T16:49", "h": 4.18, "k": "H", "port": "Thurso"}, {"t": "2025-12-30T23:20", "h": 1.52, "k": "L", "port": "Thurso"}], "north shields": [{"t": "2025-12-30T05:09", "h": 1.46, "k": "L", "port": "North Shields"}, {"t": "2025-12-30T11:23", "h": 4.3, "k": "H", "port": "North Shields"}, {"t": "2025-12-30T17:34", "h": 1.83, "k": "L", "port": "North Shields"}, {"t": "2025-12-30T23:37", "h": 4.58, "k": "H", "port": "North Shields"}], "skirza": [{"t": "2025-12-30T05:23", "h": 3.64, "k": "H", "port": "Skirza"}, {"t": "2025-12-30T11:12", "h": 1.92, "k": "L", "port": "Skirza"}, {"t": "2025-12-30T17:34", "h": 3.81, "k": "H", "port": "Skirza"}, {"t": "2025-12-30T23:49", "h": 1.57, "k": "L", "port": "Skirza"}], "whitby": [{"t": "2025-12-30T05:39", "h": 1.76, "k": "L", "port": "Whitby"}, {"t": "2025-12-30T11:57", "h": 4.72, "k": "H", "port": "Whitby"}, {"t": "2025-12-30T18:05", "h": 2.17, "k": "L", "port": "Whitby"}], "scarborough": [{"t": "2025-12-30T05:58", "h": 1.86, "k": "L", "port": "Scarborough"}, {"t": "2025-12-30T12:13", "h": 4.91, "k": "H", "port": "Scarborough"}, {"t": "2025-12-30T18:26", "h": 2.24, "k": "L", "port": "Scarborough"}]}, "ext": [{"t": "2025-12-30T00:00", "h": 4.58, "k": "H", "port": "Newlyn"}, {"t": "2025-12-30T00:13", "h": 3.43, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-30T00:36", "h": 3.88, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-30T00:36", "h": 3.49, "k": "H", "port": "Cork"}, {"t": "2025-12-30T00:39", "h": 4.62, "k": "H", "port": "Plymouth"}, {"t": "2025-12-30T01:17", "h": 1.27, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-30T01:17", "h": 3.11, "k": "H", "port": "Bundoran"}, {"t": "2025-12-30T01:19", "h": 6.93, "k": "H", "port": "Llangennith"}, {"t": "2025-12-30T01:24", "h": 5.51, "k": "H", "port": "Croyde"}, {"t": "2025-12-30T01:24", "h": 0.86, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-30T01:28", "h": 3.02, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-30T01:31", "h": 3.07, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-30T01:40", "h": 5.65, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-30T02:42", "h": 3.98, "k": "H", "port": "Stornoway"}, {"t": "2025-12-30T02:55", "h": 1.36, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-30T03:22", "h": 1.87, "k": "H", "port": "Londonderry"}, {"t": "2025-12-30T03:29", "h": 3.77, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-30T03:36", "h": 3.93, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-30T04:35", "h": 3.99, "k": "H", "port": "Thurso"}, {"t": "2025-12-30T05:09", "h": 1.46, "k": "L", "port": "North Shields"}, {"t": "2025-12-30T05:23", "h": 3.64, "k": "H", "port": "Skirza"}, {"t": "2025-12-30T05:39", "h": 1.76, "k": "L", "port": "Whitby"}, {"t": "2025-12-30T05:58", "h": 1.86, "k": "L", "port": "Scarborough"}, {"t": "2025-12-30T06:21", "h": 1.37, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-30T06:38", "h": 1.82, "k": "L", "port": "Newlyn"}, {"t": "2025-12-30T06:45", "h": 1.56, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-30T07:06", "h": 2.1, "k": "L", "port": "Plymouth"}, {"t": "2025-12-30T07:09", "h": 1.12, "k": "L", "port": "Cork"}, {"t": "2025-12-30T07:16", "h": 1.35, "k": "L", "port": "Bundoran"}, {"t": "2025-12-30T07:32", "h": 1.27, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-30T07:33", "h": 1.17, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-30T07:34", "h": 2.46, "k": "L", "port": "Llangennith"}, {"t": "2025-12-30T07:37", "h": 3.38, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-30T07:57", "h": 2.08, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-30T08:01", "h": 0.95, "k": "L", "port": "Croyde"}, {"t": "2025-12-30T08:02", "h": 2.65, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-30T08:59", "h": 1.92, "k": "L", "port": "Stornoway"}, {"t": "2025-12-30T09:20", "h": 3.65, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-30T09:38", "h": 1.77, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-30T09:47", "h": 0.9, "k": "L", "port": "Londonderry"}, {"t": "2025-12-30T10:18", "h": 1.61, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-30T10:44", "h": 1.94, "k": "L", "port": "Thurso"}, {"t": "2025-12-30T11:12", "h": 1.92, "k": "L", "port": "Skirza"}, {"t": "2025-12-30T11:23", "h": 4.3, "k": "H", "port": "North Shields"}, {"t": "2025-12-30T11:57", "h": 4.72, "k": "H", "port": "Whitby"}, {"t": "2025-12-30T12:13", "h": 4.91, "k": "H", "port": "Scarborough"}, {"t": "2025-12-30T12:34", "h": 4.79, "k": "H", "port": "Newlyn"}, {"t": "2025-12-30T12:38", "h": 3.47, "k": "H", "port": "Coomeenole"}, {"t": "2025-12-30T13:02", "h": 3.89, "k": "H", "port": "Doonbeg"}, {"t": "2025-12-30T13:10", "h": 4.69, "k": "H", "port": "Plymouth"}, {"t": "2025-12-30T13:15", "h": 3.54, "k": "H", "port": "Cork"}, {"t": "2025-12-30T13:38", "h": 3.42, "k": "H", "port": "Bundoran"}, {"t": "2025-12-30T13:41", "h": 1.07, "k": "L", "port": "Campbeltown"}, {"t": "2025-12-30T13:44", "h": 1.54, "k": "L", "port": "Lossiemouth"}, {"t": "2025-12-30T13:53", "h": 3.03, "k": "H", "port": "Inishcrone"}, {"t": "2025-12-30T13:54", "h": 7.13, "k": "H", "port": "Llangennith"}, {"t": "2025-12-30T13:59", "h": 5.65, "k": "H", "port": "Croyde"}, {"t": "2025-12-30T13:59", "h": 3.38, "k": "H", "port": "Falcarragh"}, {"t": "2025-12-30T14:14", "h": 5.87, "k": "H", "port": "MilfordHaven"}, {"t": "2025-12-30T15:02", "h": 4.23, "k": "H", "port": "Stornoway"}, {"t": "2025-12-30T15:20", "h": 1.62, "k": "L", "port": "Aberdeen"}, {"t": "2025-12-30T15:42", "h": 3.94, "k": "H", "port": "Cape Wrath"}, {"t": "2025-12-30T15:50", "h": 2.18, "k": "H", "port": "Londonderry"}, {"t": "2025-12-30T16:09", "h": 4.24, "k": "H", "port": "Aberystwyth"}, {"t": "2025-12-30T16:49", "h": 4.18, "k": "H", "port": "Thurso"}, {"t": "2025-12-30T17:34", "h": 3.81, "k": "H", "port": "Skirza"}, {"t": "2025-12-30T17:34", "h": 1.83, "k": "L", "port": "North Shields"}, {"t": "2025-12-30T18:05", "h": 2.17, "k": "L", "port": "Whitby"}, {"t": "2025-12-30T18:26", "h": 2.24, "k": "L", "port": "Scarborough"}, {"t": "2025-12-30T18:53", "h": 1.17, "k": "L", "port": "Coomeenole"}, {"t": "2025-12-30T19:15", "h": 1.34, "k": "L", "port": "Doonbeg"}, {"t": "2025-12-30T19:16", "h": 1.68, "k": "L", "port": "Newlyn"}, {"t": "2025-12-30T19:45", "h": 1.98, "k": "L", "port": "Plymouth"}, {"t": "2025-12-30T19:45", "h": 1.14, "k": "L", "port": "Cork"}, {"t": "2025-12-30T19:56", "h": 3.61, "k": "H", "port": "Lossiemouth"}, {"t": "2025-12-30T20:03", "h": 1.08, "k": "L", "port": "Bundoran"}, {"t": "2025-12-30T20:03", "h": 0.95, "k": "L", "port": "Inishcrone"}, {"t": "2025-12-30T20:15", "h": 2.32, "k": "L", "port": "Llangennith"}, {"t": "2025-12-30T20:18", "h": 2.91, "k": "H", "port": "Campbeltown"}, {"t": "2025-12-30T20:20", "h": 1.13, "k": "L", "port": "Falcarragh"}, {"t": "2025-12-30T20:37", "h": 1.94, "k": "L", "port": "MilfordHaven"}, {"t": "2025-12-30T20:40", "h": 0.89, "k": "L", "port": "Croyde"}, {"t": "2025-12-30T21:39", "h": 3.9, "k": "H", "port": "Aberdeen"}, {"t": "2025-12-30T21:41", "h": 1.59, "k": "L", "port": "Stornoway"}, {"t": "2025-12-30T22:16", "h": 1.39, "k": "L", "port": "Cape Wrath"}, {"t": "2025-12-30T22:47", "h": 0.81, "k": "L", "port": "Londonderry"}, {"t": "2025-12-30T23:06", "h": 1.43, "k": "L", "port": "Aberystwyth"}, {"t": "2025-12-30T23:20", "h": 1.52, "k": "L", "port": "Thurso"}, {"t": "2025-12-30T23:37", "h": 4.58, "k": "H", "port": "North Shields"}, {"t": "2025-12-30T23:49", "h": 1.57, "k": "L", "port": "Skirza"}], "sunrise": "2025-12-30T08:20", "sunset": "2025-12-30T16:24"}};</script>
<script>window.MOON  = {"2025-12-28": {"name": "First Quarter", "emoji": "\ud83c\udf13", "illumination": 0.529, "age_days": 7.66, "is_spring": false, "is_neap": true}, "2025-12-29": {"name": "Waxing Gibbous", "emoji": "\ud83c\udf14", "illumination": 0.635, "age_days": 8.67, "is_spring": false, "is_neap": true}, "2025-12-30": {"name": "Waxing Gibbous", "emoji": "\ud83c\udf14", "illumination": 0.742, "age_days": 9.76, "is_spring": false, "is_neap": false}, "2025-12-31": {"name": "Waxing Gibbous", "emoji": "\ud83c\udf14", "illumination": 0.83, "age_days": 10.77, "is_spring": false, "is_neap": false}};</script>
<script>
/* Convert day-first TIDES to station-first, and build a name index */
(function(){
  const T = window.TIDES || {};
  const out = {};       // station-first: out[Station][YYYY-MM-DD] = [events...]
  const nameIndex = {}; // lc-name â†’ Canonical Station Name
  const norm = s => String(s || '').trim();
  const lc   = s => norm(s).toLowerCase();

  for (const day of Object.keys(T)) {
    const byp = (T[day] && T[day].by_port) || {};
    for (const portKey of Object.keys(byp)) {
      const evs = byp[portKey] || [];
      // Prefer the nice-cased name from the row payload; fallback to the key.
      const canonical = norm(evs[0]?.port || portKey);
      nameIndex[lc(canonical)] = canonical;
      nameIndex[lc(portKey)]   = canonical;

      const slot = out[canonical] || (out[canonical] = {});
      const arr  = slot[day] || (slot[day] = []);
      // Convert ext rows to the compact event objects the mobile renderer uses
      for (const r of evs) {
        arr.push({
          time: (String(r.t || '').slice(11,16) || ''),  // "HH:MM"
          kind: (String(r.k || '').toUpperCase() === 'H') ? 'High' : 'Low',
          height_m: (typeof r.h === 'number') ? r.h : (parseFloat(r.h) || null),
        });
      }
      // Keep events per day ordered by time for a tidy display
      arr.sort((a,b) => a.time.localeCompare(b.time));
    }
  }

  // Expose the station-first map + a resolver index for tolerant lookups
  window.TIDES_STATIONS  = out;
  window.TIDE_NAME_INDEX = nameIndex;
    window.LAST_TIDE_PORT = null;
    window.LAST_TIDE_PREF = null;
})();
</script>
<script>window.BOUNDARIES={"nodes":[{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"Cornwall","min_lon":-7.45679,"min_lat":49.74071,"max_lon":-2.87208,"max_lat":51.19398,"slug":"/eu/gb/cornwall","bbox":[-7.45679,49.74071,-2.87208,51.19398],"area_code":"GB-01"},{"layer":"country_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"nan","min_lon":-12.0,"min_lat":51.14226,"max_lon":0.1,"max_lat":53.54891,"slug":"/eu/cym","bbox":[-12.0,51.14226,0.1,53.54891],"area_code":"CYM-00"},{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Northwest Wales","min_lon":-8.92864,"min_lat":51.85058,"max_lon":-3.13816,"max_lat":53.59695,"slug":"/eu/cym/northwest-wales","bbox":[-8.92864,51.85058,-3.13816,53.59695],"area_code":"CYM-01"},{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Pembrokeshire","min_lon":-5.85805,"min_lat":51.57926,"max_lon":-4.48088,"max_lat":52.00351,"slug":"/eu/cym/pembrokeshire","bbox":[-5.85805,51.57926,-4.48088,52.00351],"area_code":"CYM-02"},{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Gower","min_lon":-4.55374,"min_lat":51.50456,"max_lon":-3.94301,"max_lat":51.6935,"slug":"/eu/cym/gower","bbox":[-4.55374,51.50456,-3.94301,51.6935],"area_code":"CYM-03"},{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Glamorgan","min_lon":-4.01237,"min_lat":51.27993,"max_lon":-2.20758,"max_lat":51.83875,"slug":"/eu/cym/glamorgan","bbox":[-4.01237,51.27993,-2.20758,51.83875],"area_code":"CYM-04"},{"layer":"country_layer","continent_code":"EU","country_code":"UK","country_name":"United Kingdom","area":"nan","min_lon":-31.75418,"min_lat":49.10161,"max_lon":4.86193,"max_lat":59.6499,"slug":"/eu","bbox":[-31.75418,49.10161,4.86193,59.6499],"area_code":"UK-00"},{"layer":"country_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"nan","min_lon":-31.75418,"min_lat":49.10161,"max_lon":4.86193,"max_lat":59.6499,"slug":"/eu/gb","bbox":[-31.75418,49.10161,4.86193,59.6499],"area_code":"GB-00"},{"layer":"country_layer","continent_code":"EU","country_code":"NEA","country_name":"NE Atlantic","area":"nan","min_lon":-94.46594,"min_lat":34.42798,"max_lon":19.54779,"max_lat":67.86705,"slug":"/eu","bbox":[-94.46594,34.42798,19.54779,67.86705],"area_code":"NEA-00"},{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"The North East","min_lon":-5.41705,"min_lat":54.39914,"max_lon":-0.04508,"max_lat":55.92725,"slug":"/eu/gb/the-north-east","bbox":[-5.41705,54.39914,-0.04508,55.92725],"area_code":"GB-02"},{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"North Yorks","min_lon":-2.84109,"min_lat":53.53485,"max_lon":0.68496,"max_lat":54.56577,"slug":"/eu/gb/north-yorks","bbox":[-2.84109,53.53485,0.68496,54.56577],"area_code":"GB-03"},{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"South Coast","min_lon":-4.14567,"min_lat":49.96056,"max_lon":0.83642,"max_lat":51.53045,"slug":"/eu/gb/south-coast","bbox":[-4.14567,49.96056,0.83642,51.53045],"area_code":"GB-04"},{"layer":"area_layer","continent_code":"EU","country_code":"CHI","country_name":"England","area":"nan","min_lon":-3.1638,"min_lat":49.1355,"max_lon":-1.91948,"max_lat":49.53932,"slug":"/eu/chi/channel-islands","bbox":[-3.1638,49.1355,-1.91948,49.53932],"area_code":"CHI-01"},{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"South Devon","min_lon":-5.24937,"min_lat":50.07248,"max_lon":-3.75962,"max_lat":50.54632,"slug":"/eu/gb/south-devon","bbox":[-5.24937,50.07248,-3.75962,50.54632],"area_code":"GB-05"},{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"North Devon","min_lon":-4.69282,"min_lat":50.74296,"max_lon":-2.77851,"max_lat":51.3424,"slug":"/eu/gb/north-devon","bbox":[-4.69282,50.74296,-2.77851,51.3424],"area_code":"GB-06"},{"layer":"country_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"nan","min_lon":-19.8446,"min_lat":54.32204,"max_lon":-0.27571,"max_lat":59.62324,"slug":"/eu/sct","bbox":[-19.8446,54.32204,-0.27571,59.62324],"area_code":"SCT-00"},{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"The North","min_lon":-9.27226,"min_lat":56.72384,"max_lon":-1.69002,"max_lat":58.73933,"slug":"/eu/sct/the-north","bbox":[-9.27226,56.72384,-1.69002,58.73933],"area_code":"SCT-01"},{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Hebrides","min_lon":-12.17333,"min_lat":56.71434,"max_lon":-4.74721,"max_lat":58.68997,"slug":"/eu/sct/hebrides","bbox":[-12.17333,56.71434,-4.74721,58.68997],"area_code":"SCT-02"},{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Sutherland","min_lon":-5.17617,"min_lat":58.36359,"max_lon":-3.90032,"max_lat":58.69533,"slug":"/eu/sct/sutherland","bbox":[-5.17617,58.36359,-3.90032,58.69533],"area_code":"SCT-03"},{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Caithness","min_lon":-3.71257,"min_lat":58.46007,"max_lon":-2.87693,"max_lat":58.6771,"slug":"/eu/sct/caithness","bbox":[-3.71257,58.46007,-2.87693,58.6771],"area_code":"SCT-04"},{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Moray","min_lon":-4.58781,"min_lat":57.32754,"max_lon":-1.70407,"max_lat":58.09473,"slug":"/eu/sct/moray","bbox":[-4.58781,57.32754,-1.70407,58.09473],"area_code":"SCT-05"},{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"The East Coast","min_lon":-14.15,"min_lat":55.59271,"max_lon":6.11,"max_lat":57.84408,"slug":"/eu/sct/the-east-coast","bbox":[-14.15,55.59271,6.11,57.84408],"area_code":"SCT-06"},{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"The West Coast","min_lon":-11.597903,"min_lat":55.171505,"max_lon":-4.124426,"max_lat":57.497512,"slug":"/eu/sct/the-west-coast","bbox":[-11.597903,55.171505,-4.124426,57.497512],"area_code":"SCT-07"},{"layer":"country_layer","continent_code":"EU","country_code":"NIR","country_name":"Northern Ireland","area":"nan","min_lon":-7.56593,"min_lat":54.91097,"max_lon":-5.9854,"max_lat":55.36094,"slug":"/eu/nir/northern-ireland","bbox":[-7.56593,54.91097,-5.9854,55.36094],"area_code":"NIR-00"},{"layer":"area_layer","continent_code":"EU","country_code":"NIR","country_name":"Northern Ireland","area":"Causeway Coast","min_lon":-7.56593,"min_lat":54.91097,"max_lon":-5.9854,"max_lat":55.36094,"slug":"/eu/nir/causeway-coast","bbox":[-7.56593,54.91097,-5.9854,55.36094],"area_code":"NIR-01"},{"layer":"country_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"nan","min_lon":-18.89354,"min_lat":51.35501,"max_lon":-5.09757,"max_lat":55.44754,"slug":"/eu/ie","bbox":[-18.89354,51.35501,-5.09757,55.44754],"area_code":"IE-00"},{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"Donegal","min_lon":-9.69,"min_lat":54.279335,"max_lon":-6.768997,"max_lat":55.426818,"slug":"/eu/ie/donegal","bbox":[-9.69,54.279335,-6.768997,55.426818],"area_code":"IE-01"},{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"County Clare","min_lon":-11.005,"min_lat":52.47035,"max_lon":-8.47168,"max_lat":53.23225,"slug":"/eu/ie/county-clare","bbox":[-11.005,52.47035,-8.47168,53.23225],"area_code":"IE-02"},{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"Dingle Peninsula","min_lon":-10.98594,"min_lat":52.00235,"max_lon":-9.74773,"max_lat":52.38039,"slug":"/eu/ie/dingle-peninsula","bbox":[-10.98594,52.00235,-9.74773,52.38039],"area_code":"IE-03"},{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"The South","min_lon":-10.7236,"min_lat":51.19293,"max_lon":-6.21868,"max_lat":52.57766,"slug":"/eu/ie/the-south","bbox":[-10.7236,51.19293,-6.21868,52.57766],"area_code":"IE-04"},{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"County Sligo","min_lon":-10.87,"min_lat":54.21,"max_lon":-6.49,"max_lat":54.29,"slug":"/eu/ie/county-sligo","bbox":[-10.87,54.21,-6.49,54.29],"area_code":"IE-05"},{"layer":"country_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"nan","min_lon":-20.52951,"min_lat":42.14883,"max_lon":11.90049,"max_lat":52.99079,"slug":"/eu/fr","bbox":[-20.52951,42.14883,11.90049,52.99079],"area_code":"FR-00"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"La Manche","min_lon":-4.21902,"min_lat":48.44612,"max_lon":4.76989,"max_lat":51.32936,"slug":"/eu/fr/la-manche","bbox":[-4.21902,48.44612,4.76989,51.32936],"area_code":"FR-01"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Bretagne","min_lon":-5.74759,"min_lat":47.2598,"max_lon":-0.44871,"max_lat":49.02065,"slug":"/eu/fr/bretagne","bbox":[-5.74759,47.2598,-0.44871,49.02065],"area_code":"FR-02"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Vend\u00e9e","min_lon":-3.67731,"min_lat":46.22025,"max_lon":-0.17962,"max_lat":47.41231,"slug":"/eu/fr/vendee","bbox":[-3.67731,46.22025,-0.17962,47.41231],"area_code":"FR-03"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Charentes et \u00celes","min_lon":-4.17894,"min_lat":45.33114,"max_lon":0.7531,"max_lat":47.03169,"slug":"/eu/fr/charentes-et-iles","bbox":[-4.17894,45.33114,0.7531,47.03169],"area_code":"FR-04"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Gironde","min_lon":-2.79361,"min_lat":44.58139,"max_lon":0.08857,"max_lat":45.59481,"slug":"/eu/fr/gironde","bbox":[-2.79361,44.58139,0.08857,45.59481],"area_code":"FR-05"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Landes","min_lon":-4.12366,"min_lat":43.31241,"max_lon":0.32685,"max_lat":44.90382,"slug":"/eu/fr/landes","bbox":[-4.12366,43.31241,0.32685,44.90382],"area_code":"FR-06"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Hossegor","min_lon":-1.51549,"min_lat":43.6374,"max_lon":-1.37995,"max_lat":43.68624,"slug":"/eu/fr/hossegor","bbox":[-1.51549,43.6374,-1.37995,43.68624],"area_code":"FR-07"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Biarritz","min_lon":-1.84238,"min_lat":43.37864,"max_lon":-1.41503,"max_lat":43.53314,"slug":"/eu/fr/biarritz","bbox":[-1.84238,43.37864,-1.41503,43.53314],"area_code":"FR-08"},{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"C\u00f4te Basque","min_lon":-1.8204,"min_lat":43.34713,"max_lon":-1.58951,"max_lat":43.4307,"slug":"/eu/fr/cote-basque","bbox":[-1.8204,43.34713,-1.58951,43.4307],"area_code":"FR-09"},{"layer":"country_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"nan","min_lon":-21.16417,"min_lat":35.1164,"max_lon":3.94906,"max_lat":44.68488,"slug":"/eu/es","bbox":[-21.16417,35.1164,3.94906,44.68488],"area_code":"ES-00"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Cantabria","min_lon":-5.90522,"min_lat":42.86,"max_lon":-3.18452,"max_lat":43.84527,"slug":"/eu/es/cantabria","bbox":[-5.90522,42.86,-3.18452,43.84527],"area_code":"ES-01"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Asturias","min_lon":-7.07532,"min_lat":43.00823,"max_lon":-4.78789,"max_lat":43.83566,"slug":"/eu/es/asturias","bbox":[-7.07532,43.00823,-4.78789,43.83566],"area_code":"ES-02"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Galicia","min_lon":-10.80027,"min_lat":41.8692,"max_lon":-5.11763,"max_lat":43.94196,"slug":"/eu/es/galicia","bbox":[-10.80027,41.8692,-5.11763,43.94196],"area_code":"ES-03"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Andaluc\u00eda","min_lon":-6.66457,"min_lat":35.91454,"max_lon":-4.83656,"max_lat":36.64845,"slug":"/eu/es/andalucia","bbox":[-6.66457,35.91454,-4.83656,36.64845],"area_code":"ES-04"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Pa\u00eds Vasco","min_lon":-3.21492,"min_lat":43.01859,"max_lon":-1.75754,"max_lat":43.54698,"slug":"/eu/es/pais-vasco","bbox":[-3.21492,43.01859,-1.75754,43.54698],"area_code":"ES-05"},{"layer":"country_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"nan","min_lon":-18.5568,"min_lat":36.91819,"max_lon":-4.40588,"max_lat":42.34148,"slug":"/eu/pt","bbox":[-18.5568,36.91819,-4.40588,42.34148],"area_code":"PT-00"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Minho and Douro","min_lon":-12.07765,"min_lat":40.36537,"max_lon":-7.00524,"max_lat":42.26266,"slug":"/eu/pt/minho-and-douro","bbox":[-12.07765,40.36537,-7.00524,42.26266],"area_code":"PT-01"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Beira Litoral","min_lon":-11.43115,"min_lat":39.34048,"max_lon":-7.68287,"max_lat":40.7693,"slug":"/eu/pt/beira-litoral","bbox":[-11.43115,39.34048,-7.68287,40.7693],"area_code":"PT-02"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Peniche","min_lon":-10.23197,"min_lat":39.09779,"max_lon":-8.80765,"max_lat":39.64616,"slug":"/eu/pt/peniche","bbox":[-10.23197,39.09779,-8.80765,39.64616],"area_code":"PT-03"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Ericeira","min_lon":-9.54955,"min_lat":38.9361,"max_lon":-9.34303,"max_lat":39.01606,"slug":"/eu/pt/ericeira","bbox":[-9.54955,38.9361,-9.34303,39.01606],"area_code":"PT-04"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Lisbon","min_lon":-9.97214,"min_lat":38.35114,"max_lon":-8.5737,"max_lat":38.89528,"slug":"/eu/pt/lisbon","bbox":[-9.97214,38.35114,-8.5737,38.89528],"area_code":"PT-05"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Southern Portugal","min_lon":-10.6298,"min_lat":36.91214,"max_lon":-7.61894,"max_lat":38.10166,"slug":"/eu/pt/southern-portugal","bbox":[-10.6298,36.91214,-7.61894,38.10166],"area_code":"PT-06"},{"layer":"country_layer","continent_code":"EU","country_code":"IS","country_name":"Iceland","area":"nan","min_lon":-27.92696,"min_lat":63.12567,"max_lon":-10.64459,"max_lat":66.76457,"slug":"/eu/is","bbox":[-27.92696,63.12567,-10.64459,66.76457],"area_code":"IS-00"},{"layer":"area_layer","continent_code":"EU","country_code":"IS","country_name":"Iceland","area":"Reykjanes","min_lon":-23.05549,"min_lat":63.7965,"max_lon":-21.59133,"max_lat":64.11666,"slug":"/eu/is/reykjanes","bbox":[-23.05549,63.7965,-21.59133,64.11666],"area_code":"IS-01"},{"layer":"country_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"nan","min_lon":-28.74255,"min_lat":57.72288,"max_lon":26.0553,"max_lat":69.62407,"slug":"/eu/no","bbox":[-28.74255,57.72288,26.0553,69.62407],"area_code":"NO-00"},{"layer":"area_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"Southern Norway","min_lon":-5.42354,"min_lat":57.79727,"max_lon":20.50681,"max_lat":64.05006,"slug":"/eu/no/southern-norway","bbox":[-5.42354,57.79727,20.50681,64.05006],"area_code":"NO-01"},{"layer":"area_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"J\u00e6ren","min_lon":4.0852,"min_lat":57.91828,"max_lon":8.74011,"max_lat":59.12867,"slug":"/eu/no/jaeren","bbox":[4.0852,57.91828,8.74011,59.12867],"area_code":"NO-02"},{"layer":"area_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"Lofoten","min_lon":13.48027,"min_lat":68.25777,"max_lon":13.66708,"max_lat":68.29221,"slug":"/eu/no/lofoten","bbox":[13.48027,68.25777,13.66708,68.29221],"area_code":"NO-03"},{"layer":"country_layer","continent_code":"EU","country_code":"FO","country_name":"Faroe Islands","area":"nan","min_lon":-10.45863,"min_lat":61.19361,"max_lon":-4.09049,"max_lat":62.68522,"slug":"/eu/fo","bbox":[-10.45863,61.19361,-4.09049,62.68522],"area_code":"FO-00"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Azores","min_lon":-32.37373,"min_lat":37.1622,"max_lon":-23.741,"max_lat":40.3895,"slug":"/eu/pt/azores","bbox":[-32.37373,37.1622,-23.741,40.3895],"area_code":"PT-07"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"S\u00e3o Miguel","min_lon":-26.02414,"min_lat":37.61961,"max_lon":-24.99271,"max_lat":38.01047,"slug":"/eu/pt/sao-miguel","bbox":[-26.02414,37.61961,-24.99271,38.01047],"area_code":"PT-08"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Terceira","min_lon":-27.5276,"min_lat":38.6021,"max_lon":-26.88786,"max_lat":38.84152,"slug":"/eu/pt/terceira","bbox":[-27.5276,38.6021,-26.88786,38.84152],"area_code":"PT-09"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"S\u00e3o Jorge","min_lon":-28.42662,"min_lat":38.50657,"max_lon":-27.62704,"max_lat":38.80608,"slug":"/eu/pt/sao-jorge","bbox":[-28.42662,38.50657,-27.62704,38.80608],"area_code":"PT-10"},{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Madeira","min_lon":-17.39369,"min_lat":32.57495,"max_lon":-16.51485,"max_lat":32.92949,"slug":"/eu/pt/madeira","bbox":[-17.39369,32.57495,-16.51485,32.92949],"area_code":"PT-11"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Canary Islands","min_lon":-19.27873,"min_lat":27.11726,"max_lon":-12.91528,"max_lat":29.80043,"slug":"/eu/es/canary-islands","bbox":[-19.27873,27.11726,-12.91528,29.80043],"area_code":"ES-06"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Tenerife","min_lon":-17.62319,"min_lat":27.94531,"max_lon":-15.81437,"max_lat":28.70905,"slug":"/eu/es/tenerife","bbox":[-17.62319,27.94531,-15.81437,28.70905],"area_code":"ES-07"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Gran Canaria","min_lon":-16.24904,"min_lat":27.68159,"max_lon":-14.9082,"max_lat":28.24966,"slug":"/eu/es/gran-canaria","bbox":[-16.24904,27.68159,-14.9082,28.24966],"area_code":"ES-08"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Lanzarote","min_lon":-14.38581,"min_lat":28.81558,"max_lon":-13.08006,"max_lat":29.36291,"slug":"/eu/es/lanzarote","bbox":[-14.38581,28.81558,-13.08006,29.36291],"area_code":"ES-09"},{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Fuerteventura","min_lon":-15.29579,"min_lat":27.97139,"max_lon":-13.29153,"max_lat":28.84938,"slug":"/eu/es/fuerteventura","bbox":[-15.29579,27.97139,-13.29153,28.84938],"area_code":"ES-10"},{"layer":"country_layer","continent_code":"EU","country_code":"NL","country_name":"Netherlands","area":"nan","min_lon":-1.22993,"min_lat":50.88552,"max_lon":9.64774,"max_lat":54.06201,"slug":"/eu/nl","bbox":[-1.22993,50.88552,9.64774,54.06201],"area_code":"NL-00"},{"layer":"country_layer","continent_code":"EU","country_code":"DK","country_name":"Denmark","area":"nan","min_lon":0.73024,"min_lat":53.08096,"max_lon":18.32313,"max_lat":57.85733,"slug":"/eu/dk","bbox":[0.73024,53.08096,18.32313,57.85733],"area_code":"DK-00"},{"layer":"country_layer","continent_code":"EU","country_code":"DE","country_name":"Germany","area":"nan","min_lon":3.55218,"min_lat":52.24462,"max_lon":14.64242,"max_lat":55.38358,"slug":"/eu/de","bbox":[3.55218,52.24462,14.64242,55.38358],"area_code":"DE-00"},{"layer":"country_layer","continent_code":"EU","country_code":"BE","country_name":"Belgium","area":"nan","min_lon":1.88763,"min_lat":50.96358,"max_lon":3.87957,"max_lat":51.56148,"slug":"/eu/be","bbox":[1.88763,50.96358,3.87957,51.56148],"area_code":"BE-00"},{"layer":"country_layer","continent_code":"EU","country_code":"SE","country_name":"Sweden","area":"nan","min_lon":4.18334,"min_lat":55.24798,"max_lon":22.64993,"max_lat":60.15342,"slug":"/eu/se","bbox":[4.18334,55.24798,22.64993,60.15342],"area_code":"SE-00"},{"layer":"area_layer","continent_code":"EU","country_code":"SE","country_name":"Sweden","area":"Sweden West","min_lon":7.23909,"min_lat":55.64705,"max_lon":15.41596,"max_lat":57.87841,"slug":"/eu/se/sweden-west","bbox":[7.23909,55.64705,15.41596,57.87841],"area_code":"SE-01"}],"by_country":{"cym":{"layer":"country_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"nan","min_lon":-12.0,"min_lat":51.14226,"max_lon":0.1,"max_lat":53.54891,"slug":"/eu/cym","bbox":[-12.0,51.14226,0.1,53.54891],"area_code":"CYM-00"},"uk":{"layer":"country_layer","continent_code":"EU","country_code":"UK","country_name":"United Kingdom","area":"nan","min_lon":-31.75418,"min_lat":49.10161,"max_lon":4.86193,"max_lat":59.6499,"slug":"/eu","bbox":[-31.75418,49.10161,4.86193,59.6499],"area_code":"UK-00"},"gb":{"layer":"country_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"nan","min_lon":-31.75418,"min_lat":49.10161,"max_lon":4.86193,"max_lat":59.6499,"slug":"/eu/gb","bbox":[-31.75418,49.10161,4.86193,59.6499],"area_code":"GB-00"},"nea":{"layer":"country_layer","continent_code":"EU","country_code":"NEA","country_name":"NE Atlantic","area":"nan","min_lon":-94.46594,"min_lat":34.42798,"max_lon":19.54779,"max_lat":67.86705,"slug":"/eu","bbox":[-94.46594,34.42798,19.54779,67.86705],"area_code":"NEA-00"},"sct":{"layer":"country_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"nan","min_lon":-19.8446,"min_lat":54.32204,"max_lon":-0.27571,"max_lat":59.62324,"slug":"/eu/sct","bbox":[-19.8446,54.32204,-0.27571,59.62324],"area_code":"SCT-00"},"nir":{"layer":"country_layer","continent_code":"EU","country_code":"NIR","country_name":"Northern Ireland","area":"nan","min_lon":-7.56593,"min_lat":54.91097,"max_lon":-5.9854,"max_lat":55.36094,"slug":"/eu/nir/northern-ireland","bbox":[-7.56593,54.91097,-5.9854,55.36094],"area_code":"NIR-00"},"ie":{"layer":"country_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"nan","min_lon":-18.89354,"min_lat":51.35501,"max_lon":-5.09757,"max_lat":55.44754,"slug":"/eu/ie","bbox":[-18.89354,51.35501,-5.09757,55.44754],"area_code":"IE-00"},"fr":{"layer":"country_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"nan","min_lon":-20.52951,"min_lat":42.14883,"max_lon":11.90049,"max_lat":52.99079,"slug":"/eu/fr","bbox":[-20.52951,42.14883,11.90049,52.99079],"area_code":"FR-00"},"es":{"layer":"country_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"nan","min_lon":-21.16417,"min_lat":35.1164,"max_lon":3.94906,"max_lat":44.68488,"slug":"/eu/es","bbox":[-21.16417,35.1164,3.94906,44.68488],"area_code":"ES-00"},"pt":{"layer":"country_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"nan","min_lon":-18.5568,"min_lat":36.91819,"max_lon":-4.40588,"max_lat":42.34148,"slug":"/eu/pt","bbox":[-18.5568,36.91819,-4.40588,42.34148],"area_code":"PT-00"},"is":{"layer":"country_layer","continent_code":"EU","country_code":"IS","country_name":"Iceland","area":"nan","min_lon":-27.92696,"min_lat":63.12567,"max_lon":-10.64459,"max_lat":66.76457,"slug":"/eu/is","bbox":[-27.92696,63.12567,-10.64459,66.76457],"area_code":"IS-00"},"no":{"layer":"country_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"nan","min_lon":-28.74255,"min_lat":57.72288,"max_lon":26.0553,"max_lat":69.62407,"slug":"/eu/no","bbox":[-28.74255,57.72288,26.0553,69.62407],"area_code":"NO-00"},"fo":{"layer":"country_layer","continent_code":"EU","country_code":"FO","country_name":"Faroe Islands","area":"nan","min_lon":-10.45863,"min_lat":61.19361,"max_lon":-4.09049,"max_lat":62.68522,"slug":"/eu/fo","bbox":[-10.45863,61.19361,-4.09049,62.68522],"area_code":"FO-00"},"nl":{"layer":"country_layer","continent_code":"EU","country_code":"NL","country_name":"Netherlands","area":"nan","min_lon":-1.22993,"min_lat":50.88552,"max_lon":9.64774,"max_lat":54.06201,"slug":"/eu/nl","bbox":[-1.22993,50.88552,9.64774,54.06201],"area_code":"NL-00"},"dk":{"layer":"country_layer","continent_code":"EU","country_code":"DK","country_name":"Denmark","area":"nan","min_lon":0.73024,"min_lat":53.08096,"max_lon":18.32313,"max_lat":57.85733,"slug":"/eu/dk","bbox":[0.73024,53.08096,18.32313,57.85733],"area_code":"DK-00"},"de":{"layer":"country_layer","continent_code":"EU","country_code":"DE","country_name":"Germany","area":"nan","min_lon":3.55218,"min_lat":52.24462,"max_lon":14.64242,"max_lat":55.38358,"slug":"/eu/de","bbox":[3.55218,52.24462,14.64242,55.38358],"area_code":"DE-00"},"be":{"layer":"country_layer","continent_code":"EU","country_code":"BE","country_name":"Belgium","area":"nan","min_lon":1.88763,"min_lat":50.96358,"max_lon":3.87957,"max_lat":51.56148,"slug":"/eu/be","bbox":[1.88763,50.96358,3.87957,51.56148],"area_code":"BE-00"},"se":{"layer":"country_layer","continent_code":"EU","country_code":"SE","country_name":"Sweden","area":"nan","min_lon":4.18334,"min_lat":55.24798,"max_lon":22.64993,"max_lat":60.15342,"slug":"/eu/se","bbox":[4.18334,55.24798,22.64993,60.15342],"area_code":"SE-00"}},"by_area":{"gb-01":{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"Cornwall","min_lon":-7.45679,"min_lat":49.74071,"max_lon":-2.87208,"max_lat":51.19398,"slug":"/eu/gb/cornwall","bbox":[-7.45679,49.74071,-2.87208,51.19398],"area_code":"GB-01"},"cym-01":{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Northwest Wales","min_lon":-8.92864,"min_lat":51.85058,"max_lon":-3.13816,"max_lat":53.59695,"slug":"/eu/cym/northwest-wales","bbox":[-8.92864,51.85058,-3.13816,53.59695],"area_code":"CYM-01"},"cym-02":{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Pembrokeshire","min_lon":-5.85805,"min_lat":51.57926,"max_lon":-4.48088,"max_lat":52.00351,"slug":"/eu/cym/pembrokeshire","bbox":[-5.85805,51.57926,-4.48088,52.00351],"area_code":"CYM-02"},"cym-03":{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Gower","min_lon":-4.55374,"min_lat":51.50456,"max_lon":-3.94301,"max_lat":51.6935,"slug":"/eu/cym/gower","bbox":[-4.55374,51.50456,-3.94301,51.6935],"area_code":"CYM-03"},"cym-04":{"layer":"area_layer","continent_code":"EU","country_code":"CYM","country_name":"Wales","area":"Glamorgan","min_lon":-4.01237,"min_lat":51.27993,"max_lon":-2.20758,"max_lat":51.83875,"slug":"/eu/cym/glamorgan","bbox":[-4.01237,51.27993,-2.20758,51.83875],"area_code":"CYM-04"},"gb-02":{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"The North East","min_lon":-5.41705,"min_lat":54.39914,"max_lon":-0.04508,"max_lat":55.92725,"slug":"/eu/gb/the-north-east","bbox":[-5.41705,54.39914,-0.04508,55.92725],"area_code":"GB-02"},"gb-03":{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"North Yorks","min_lon":-2.84109,"min_lat":53.53485,"max_lon":0.68496,"max_lat":54.56577,"slug":"/eu/gb/north-yorks","bbox":[-2.84109,53.53485,0.68496,54.56577],"area_code":"GB-03"},"gb-04":{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"South Coast","min_lon":-4.14567,"min_lat":49.96056,"max_lon":0.83642,"max_lat":51.53045,"slug":"/eu/gb/south-coast","bbox":[-4.14567,49.96056,0.83642,51.53045],"area_code":"GB-04"},"chi-01":{"layer":"area_layer","continent_code":"EU","country_code":"CHI","country_name":"England","area":"nan","min_lon":-3.1638,"min_lat":49.1355,"max_lon":-1.91948,"max_lat":49.53932,"slug":"/eu/chi/channel-islands","bbox":[-3.1638,49.1355,-1.91948,49.53932],"area_code":"CHI-01"},"gb-05":{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"South Devon","min_lon":-5.24937,"min_lat":50.07248,"max_lon":-3.75962,"max_lat":50.54632,"slug":"/eu/gb/south-devon","bbox":[-5.24937,50.07248,-3.75962,50.54632],"area_code":"GB-05"},"gb-06":{"layer":"area_layer","continent_code":"EU","country_code":"GB","country_name":"England","area":"North Devon","min_lon":-4.69282,"min_lat":50.74296,"max_lon":-2.77851,"max_lat":51.3424,"slug":"/eu/gb/north-devon","bbox":[-4.69282,50.74296,-2.77851,51.3424],"area_code":"GB-06"},"sct-01":{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"The North","min_lon":-9.27226,"min_lat":56.72384,"max_lon":-1.69002,"max_lat":58.73933,"slug":"/eu/sct/the-north","bbox":[-9.27226,56.72384,-1.69002,58.73933],"area_code":"SCT-01"},"sct-02":{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Hebrides","min_lon":-12.17333,"min_lat":56.71434,"max_lon":-4.74721,"max_lat":58.68997,"slug":"/eu/sct/hebrides","bbox":[-12.17333,56.71434,-4.74721,58.68997],"area_code":"SCT-02"},"sct-03":{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Sutherland","min_lon":-5.17617,"min_lat":58.36359,"max_lon":-3.90032,"max_lat":58.69533,"slug":"/eu/sct/sutherland","bbox":[-5.17617,58.36359,-3.90032,58.69533],"area_code":"SCT-03"},"sct-04":{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Caithness","min_lon":-3.71257,"min_lat":58.46007,"max_lon":-2.87693,"max_lat":58.6771,"slug":"/eu/sct/caithness","bbox":[-3.71257,58.46007,-2.87693,58.6771],"area_code":"SCT-04"},"sct-05":{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"Moray","min_lon":-4.58781,"min_lat":57.32754,"max_lon":-1.70407,"max_lat":58.09473,"slug":"/eu/sct/moray","bbox":[-4.58781,57.32754,-1.70407,58.09473],"area_code":"SCT-05"},"sct-06":{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"The East Coast","min_lon":-14.15,"min_lat":55.59271,"max_lon":6.11,"max_lat":57.84408,"slug":"/eu/sct/the-east-coast","bbox":[-14.15,55.59271,6.11,57.84408],"area_code":"SCT-06"},"sct-07":{"layer":"area_layer","continent_code":"EU","country_code":"SCT","country_name":"Scotland","area":"The West Coast","min_lon":-11.597903,"min_lat":55.171505,"max_lon":-4.124426,"max_lat":57.497512,"slug":"/eu/sct/the-west-coast","bbox":[-11.597903,55.171505,-4.124426,57.497512],"area_code":"SCT-07"},"nir-01":{"layer":"area_layer","continent_code":"EU","country_code":"NIR","country_name":"Northern Ireland","area":"Causeway Coast","min_lon":-7.56593,"min_lat":54.91097,"max_lon":-5.9854,"max_lat":55.36094,"slug":"/eu/nir/causeway-coast","bbox":[-7.56593,54.91097,-5.9854,55.36094],"area_code":"NIR-01"},"ie-01":{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"Donegal","min_lon":-9.69,"min_lat":54.279335,"max_lon":-6.768997,"max_lat":55.426818,"slug":"/eu/ie/donegal","bbox":[-9.69,54.279335,-6.768997,55.426818],"area_code":"IE-01"},"ie-02":{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"County Clare","min_lon":-11.005,"min_lat":52.47035,"max_lon":-8.47168,"max_lat":53.23225,"slug":"/eu/ie/county-clare","bbox":[-11.005,52.47035,-8.47168,53.23225],"area_code":"IE-02"},"ie-03":{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"Dingle Peninsula","min_lon":-10.98594,"min_lat":52.00235,"max_lon":-9.74773,"max_lat":52.38039,"slug":"/eu/ie/dingle-peninsula","bbox":[-10.98594,52.00235,-9.74773,52.38039],"area_code":"IE-03"},"ie-04":{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"The South","min_lon":-10.7236,"min_lat":51.19293,"max_lon":-6.21868,"max_lat":52.57766,"slug":"/eu/ie/the-south","bbox":[-10.7236,51.19293,-6.21868,52.57766],"area_code":"IE-04"},"ie-05":{"layer":"area_layer","continent_code":"EU","country_code":"IE","country_name":"Ireland","area":"County Sligo","min_lon":-10.87,"min_lat":54.21,"max_lon":-6.49,"max_lat":54.29,"slug":"/eu/ie/county-sligo","bbox":[-10.87,54.21,-6.49,54.29],"area_code":"IE-05"},"fr-01":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"La Manche","min_lon":-4.21902,"min_lat":48.44612,"max_lon":4.76989,"max_lat":51.32936,"slug":"/eu/fr/la-manche","bbox":[-4.21902,48.44612,4.76989,51.32936],"area_code":"FR-01"},"fr-02":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Bretagne","min_lon":-5.74759,"min_lat":47.2598,"max_lon":-0.44871,"max_lat":49.02065,"slug":"/eu/fr/bretagne","bbox":[-5.74759,47.2598,-0.44871,49.02065],"area_code":"FR-02"},"fr-03":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Vend\u00e9e","min_lon":-3.67731,"min_lat":46.22025,"max_lon":-0.17962,"max_lat":47.41231,"slug":"/eu/fr/vendee","bbox":[-3.67731,46.22025,-0.17962,47.41231],"area_code":"FR-03"},"fr-04":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Charentes et \u00celes","min_lon":-4.17894,"min_lat":45.33114,"max_lon":0.7531,"max_lat":47.03169,"slug":"/eu/fr/charentes-et-iles","bbox":[-4.17894,45.33114,0.7531,47.03169],"area_code":"FR-04"},"fr-05":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Gironde","min_lon":-2.79361,"min_lat":44.58139,"max_lon":0.08857,"max_lat":45.59481,"slug":"/eu/fr/gironde","bbox":[-2.79361,44.58139,0.08857,45.59481],"area_code":"FR-05"},"fr-06":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Landes","min_lon":-4.12366,"min_lat":43.31241,"max_lon":0.32685,"max_lat":44.90382,"slug":"/eu/fr/landes","bbox":[-4.12366,43.31241,0.32685,44.90382],"area_code":"FR-06"},"fr-07":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Hossegor","min_lon":-1.51549,"min_lat":43.6374,"max_lon":-1.37995,"max_lat":43.68624,"slug":"/eu/fr/hossegor","bbox":[-1.51549,43.6374,-1.37995,43.68624],"area_code":"FR-07"},"fr-08":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"Biarritz","min_lon":-1.84238,"min_lat":43.37864,"max_lon":-1.41503,"max_lat":43.53314,"slug":"/eu/fr/biarritz","bbox":[-1.84238,43.37864,-1.41503,43.53314],"area_code":"FR-08"},"fr-09":{"layer":"area_layer","continent_code":"EU","country_code":"FR","country_name":"France","area":"C\u00f4te Basque","min_lon":-1.8204,"min_lat":43.34713,"max_lon":-1.58951,"max_lat":43.4307,"slug":"/eu/fr/cote-basque","bbox":[-1.8204,43.34713,-1.58951,43.4307],"area_code":"FR-09"},"es-01":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Cantabria","min_lon":-5.90522,"min_lat":42.86,"max_lon":-3.18452,"max_lat":43.84527,"slug":"/eu/es/cantabria","bbox":[-5.90522,42.86,-3.18452,43.84527],"area_code":"ES-01"},"es-02":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Asturias","min_lon":-7.07532,"min_lat":43.00823,"max_lon":-4.78789,"max_lat":43.83566,"slug":"/eu/es/asturias","bbox":[-7.07532,43.00823,-4.78789,43.83566],"area_code":"ES-02"},"es-03":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Galicia","min_lon":-10.80027,"min_lat":41.8692,"max_lon":-5.11763,"max_lat":43.94196,"slug":"/eu/es/galicia","bbox":[-10.80027,41.8692,-5.11763,43.94196],"area_code":"ES-03"},"es-04":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Andaluc\u00eda","min_lon":-6.66457,"min_lat":35.91454,"max_lon":-4.83656,"max_lat":36.64845,"slug":"/eu/es/andalucia","bbox":[-6.66457,35.91454,-4.83656,36.64845],"area_code":"ES-04"},"es-05":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Pa\u00eds Vasco","min_lon":-3.21492,"min_lat":43.01859,"max_lon":-1.75754,"max_lat":43.54698,"slug":"/eu/es/pais-vasco","bbox":[-3.21492,43.01859,-1.75754,43.54698],"area_code":"ES-05"},"pt-01":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Minho and Douro","min_lon":-12.07765,"min_lat":40.36537,"max_lon":-7.00524,"max_lat":42.26266,"slug":"/eu/pt/minho-and-douro","bbox":[-12.07765,40.36537,-7.00524,42.26266],"area_code":"PT-01"},"pt-02":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Beira Litoral","min_lon":-11.43115,"min_lat":39.34048,"max_lon":-7.68287,"max_lat":40.7693,"slug":"/eu/pt/beira-litoral","bbox":[-11.43115,39.34048,-7.68287,40.7693],"area_code":"PT-02"},"pt-03":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Peniche","min_lon":-10.23197,"min_lat":39.09779,"max_lon":-8.80765,"max_lat":39.64616,"slug":"/eu/pt/peniche","bbox":[-10.23197,39.09779,-8.80765,39.64616],"area_code":"PT-03"},"pt-04":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Ericeira","min_lon":-9.54955,"min_lat":38.9361,"max_lon":-9.34303,"max_lat":39.01606,"slug":"/eu/pt/ericeira","bbox":[-9.54955,38.9361,-9.34303,39.01606],"area_code":"PT-04"},"pt-05":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Lisbon","min_lon":-9.97214,"min_lat":38.35114,"max_lon":-8.5737,"max_lat":38.89528,"slug":"/eu/pt/lisbon","bbox":[-9.97214,38.35114,-8.5737,38.89528],"area_code":"PT-05"},"pt-06":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Southern Portugal","min_lon":-10.6298,"min_lat":36.91214,"max_lon":-7.61894,"max_lat":38.10166,"slug":"/eu/pt/southern-portugal","bbox":[-10.6298,36.91214,-7.61894,38.10166],"area_code":"PT-06"},"is-01":{"layer":"area_layer","continent_code":"EU","country_code":"IS","country_name":"Iceland","area":"Reykjanes","min_lon":-23.05549,"min_lat":63.7965,"max_lon":-21.59133,"max_lat":64.11666,"slug":"/eu/is/reykjanes","bbox":[-23.05549,63.7965,-21.59133,64.11666],"area_code":"IS-01"},"no-01":{"layer":"area_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"Southern Norway","min_lon":-5.42354,"min_lat":57.79727,"max_lon":20.50681,"max_lat":64.05006,"slug":"/eu/no/southern-norway","bbox":[-5.42354,57.79727,20.50681,64.05006],"area_code":"NO-01"},"no-02":{"layer":"area_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"J\u00e6ren","min_lon":4.0852,"min_lat":57.91828,"max_lon":8.74011,"max_lat":59.12867,"slug":"/eu/no/jaeren","bbox":[4.0852,57.91828,8.74011,59.12867],"area_code":"NO-02"},"no-03":{"layer":"area_layer","continent_code":"EU","country_code":"NO","country_name":"Norway","area":"Lofoten","min_lon":13.48027,"min_lat":68.25777,"max_lon":13.66708,"max_lat":68.29221,"slug":"/eu/no/lofoten","bbox":[13.48027,68.25777,13.66708,68.29221],"area_code":"NO-03"},"pt-07":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Azores","min_lon":-32.37373,"min_lat":37.1622,"max_lon":-23.741,"max_lat":40.3895,"slug":"/eu/pt/azores","bbox":[-32.37373,37.1622,-23.741,40.3895],"area_code":"PT-07"},"pt-08":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"S\u00e3o Miguel","min_lon":-26.02414,"min_lat":37.61961,"max_lon":-24.99271,"max_lat":38.01047,"slug":"/eu/pt/sao-miguel","bbox":[-26.02414,37.61961,-24.99271,38.01047],"area_code":"PT-08"},"pt-09":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Terceira","min_lon":-27.5276,"min_lat":38.6021,"max_lon":-26.88786,"max_lat":38.84152,"slug":"/eu/pt/terceira","bbox":[-27.5276,38.6021,-26.88786,38.84152],"area_code":"PT-09"},"pt-10":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"S\u00e3o Jorge","min_lon":-28.42662,"min_lat":38.50657,"max_lon":-27.62704,"max_lat":38.80608,"slug":"/eu/pt/sao-jorge","bbox":[-28.42662,38.50657,-27.62704,38.80608],"area_code":"PT-10"},"pt-11":{"layer":"area_layer","continent_code":"EU","country_code":"PT","country_name":"Portugal","area":"Madeira","min_lon":-17.39369,"min_lat":32.57495,"max_lon":-16.51485,"max_lat":32.92949,"slug":"/eu/pt/madeira","bbox":[-17.39369,32.57495,-16.51485,32.92949],"area_code":"PT-11"},"es-06":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Canary Islands","min_lon":-19.27873,"min_lat":27.11726,"max_lon":-12.91528,"max_lat":29.80043,"slug":"/eu/es/canary-islands","bbox":[-19.27873,27.11726,-12.91528,29.80043],"area_code":"ES-06"},"es-07":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Tenerife","min_lon":-17.62319,"min_lat":27.94531,"max_lon":-15.81437,"max_lat":28.70905,"slug":"/eu/es/tenerife","bbox":[-17.62319,27.94531,-15.81437,28.70905],"area_code":"ES-07"},"es-08":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Gran Canaria","min_lon":-16.24904,"min_lat":27.68159,"max_lon":-14.9082,"max_lat":28.24966,"slug":"/eu/es/gran-canaria","bbox":[-16.24904,27.68159,-14.9082,28.24966],"area_code":"ES-08"},"es-09":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Lanzarote","min_lon":-14.38581,"min_lat":28.81558,"max_lon":-13.08006,"max_lat":29.36291,"slug":"/eu/es/lanzarote","bbox":[-14.38581,28.81558,-13.08006,29.36291],"area_code":"ES-09"},"es-10":{"layer":"area_layer","continent_code":"EU","country_code":"ES","country_name":"Spain","area":"Fuerteventura","min_lon":-15.29579,"min_lat":27.97139,"max_lon":-13.29153,"max_lat":28.84938,"slug":"/eu/es/fuerteventura","bbox":[-15.29579,27.97139,-13.29153,28.84938],"area_code":"ES-10"},"se-01":{"layer":"area_layer","continent_code":"EU","country_code":"SE","country_name":"Sweden","area":"Sweden West","min_lon":7.23909,"min_lat":55.64705,"max_lon":15.41596,"max_lat":57.87841,"slug":"/eu/se/sweden-west","bbox":[7.23909,55.64705,15.41596,57.87841],"area_code":"SE-01"}}};</script>
</head>
<body>
    <header class="mbar mbar--compact">
    <div class="mrow mrow--compact">

        <select id="mob-country" class="chip-select" aria-label="Country"></select>
        <select id="mob-area" class="chip-select" aria-label="Area" disabled></select>

        <!-- back-to-region chip -->
        <button
          id="mob-reset-region"
          class="chip chip-action chip--compact"
          title="Back to current region"
        >
          &lt;
        </button>



        <button id="mob-date" class="chip chip-action chip--compact" title="Change day">â€”</button>

        <button
        id="mob-filter"
        class="chip chip-action chip--compact"
        aria-haspopup="menu"
        aria-expanded="false"
        title="Filter spots"
        >
        <span id="mob-filter-label">All</span>
        </button>

        <!-- menu (unchanged) -->
        <div id="mob-filter-menu" role="menu" tabindex="-1" aria-hidden="true" inert>

            <button data-mode="ALL" role="menuitem">SpotsOn</button>
            <button data-mode="FUN" role="menuitem">Fun</button>
            <button data-mode="SOLID" role="menuitem">Solid</button>
            <button data-mode="CONSEQUENCE" role="menuitem">Big</button>
            <hr>
        <hr>
        <label class="menu-check"><input id="mob-green-only" type="checkbox"> Working only</label>
        <hr>
            <button id="mob-edit-scale" role="menuitem">
              <span class="blue-arrow">&gt;</span> Edge
            </button>
        </div>
    </div>
    </header>



    <main class="mpage">
    <section id="tips" class="panel">
        <h2>Plan your session</h2>
        <p class="muted">Pick a country and (optionally) an area, then tap <b>View map</b>.
        The map loads only when needed to keep things fast on phones.</p>
    </section>

    <section id="mapwrap" class="panel mapwrap hidden">
        <div class="maphead">
        <div>
            <strong id="mapTitle">Map</strong>
            <span id="mapStatus" class="muted">waitingâ€¦</span>
        </div>
        <button id="mob-close" class="ghost">Close</button>
        </div>
        <!-- Lazy iframe: we donâ€™t set src until first open -->
        <iframe id="mob-map" title="Map" loading="lazy" referrerpolicy="no-referrer"></iframe>
    </section>
    </main>
    <!-- Compact hover card for mobile -->
    <div id="hoverCard" aria-hidden="true">
    <div class="tt-bar">

        <div class="tt-mid">
        <!-- 1) Dial (fixed column) -->
        <svg id="hcDial" class="tt-dial" viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
            <circle cx="100" cy="100" r="92" fill="none" stroke="var(--ring)" stroke-width="3"/>
            <text class="cardinal" x="100" y="16">N</text>
            <text class="cardinal" x="184" y="100">E</text>
            <text class="cardinal" x="100" y="184">S</text>
            <text class="cardinal" x="16"  y="100">W</text>
            <text id="hcFaceNum"  x="100" y="100">â€“</text>
            <text id="hcFaceUnit" x="100" y="100">ft</text>
            <g id="dialRoot" transform="translate(100,100)">
            <g id="hcWindArrow" class="chev chev--wind"><path d="M -6 -3 L 0 -22 L 6 -3"/></g>
            <g id="hcSwellArrow" class="chev chev--swell" opacity="0.95"><path d="M -5 -2 L 0 -18 L 5 -2"/></g>
            </g>
        </svg>

        <!-- 2) Tide (flex middle column) -->
        <div id="tide-card" class="tide-card" style="min-width:0;">
            <svg id="tide-svg" width="100%" viewBox="0 0 600 140" preserveAspectRatio="none"></svg>
        </div>

        <!-- 3) Chips (stacked, right column) -->
        <div class="tt-chips column">
            <!-- Wind chip -->
                <span class="chip chip--wind" id="hcWind">
                    <svg class="chip-icon chip-icon--wind" id="chipWind" viewBox="0 0 20 20" aria-hidden="true">
                        <g class="chip-rotor">
                        <!-- Up-pointing caret (â–²) so 0Â° = â€œfrom Northâ€ shows pointing up -->
                            <path d="M6 14 L10 6 L14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square"/>
                        </g>
                    </svg>
                <span id="hcWindText">Wind â€”</span>
            </span>

            <!-- Period (swell) chip -->
            <span class="chip" id="hcPeriod">
                <svg class="chip-icon chip-icon--swell" id="chipSwell" viewBox="0 0 20 20" aria-hidden="true">
                    <g class="chip-rotor">
                        <path d="M6 14 L10 6 L14 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square"/>
                    </g>
                </svg>
            <span id="hcPeriodText">Period â€”</span>
            </span>

            <span class="chip" id="hcTidePref">Tide pref: ALL</span>
            <span class="chip" id="hcMoon">Waning Crescent</span>
        </div>


        </div>


    </div><!-- /#hoverCard -->

<script src="js/tides_mobile.js?v=1766898113"></script>

<script>
// --- Map CURRENT_OFFSET (0/1/2) -> file index (0/1/2) ---
function dayFileIndexFromOffset(off) {
  const o = Number(off) || 0;
  return Math.max(0, Math.min(2, o));
}

// --- Safe JSON (NaN/Â±Infinity â†’ null) ---

window.safeFetchJson ??= async function safeFetchJson(url) {
  const res = await fetch(url, { cache: 'no-store' });
  if (!res.ok) throw new Error(`Failed to load ${url} (${res.status})`);
  const txt = await res.text();
  const safe = txt.replace(/\bNaN\b/g,'null').replace(/\bInfinity\b/g,'null').replace(/\b-Infinity\b/g,'null');
  return JSON.parse(safe);
};

// --- Region filter (uses your globals if present) ---

function resolveCountryCode(nameOrCode) {
  const s = String(nameOrCode || 'ALL').trim();
  if (!s || s === 'ALL') return 'ALL';
  if (window.NAME_TO_CC && window.NAME_TO_CC[s]) return window.NAME_TO_CC[s];
  if (window.CC_TO_NAME && window.CC_TO_NAME[s]) return s; // already a code
  if (s === 'UK' || s === 'United Kingdom') return 'GB';
  return s; // last resort
}

function displayNameFor(nameOrCode) {
  const s = String(nameOrCode || 'ALL').trim();
  if (!s || s === 'ALL') return 'ALL';
  if (window.CC_TO_NAME && window.CC_TO_NAME[s]) return window.CC_TO_NAME[s]; // code -> name
  return s; // already a name
}


// === Drop-in replacement ===
async function fetchSpotsForCurrentDay() {
  try {
    const idx = (typeof dayFileIndexFromOffset === 'function')
      ? dayFileIndexFromOffset(window.CURRENT_OFFSET ?? 0)
      : (window.CURRENT_OFFSET ?? 0);

    const url = `../rag_lab/output/spots_day${idx}.json`;
    console.log('[fetch] start', { idx, url, offset: window.CURRENT_OFFSET });

    // 1) Load & sanitise
    const rows = await safeFetchJson(url);
    const safeRows = Array.isArray(rows) ? rows : [];


    // ðŸ”¹ NEW: canonicalise wave height in feet
    safeRows.forEach((r) => {
      if (typeof r.size_ft === 'number' && isFinite(r.size_ft)) return;

      if (typeof r.size === 'number' && isFinite(r.size)) {
        r.size_ft = r.size;
      } else if (typeof r.swell_height_m === 'number' && isFinite(r.swell_height_m)) {
        r.size_ft = r.swell_height_m * 3.28084;
      } else {
        r.size_ft = undefined;
      }
    });


    // 2) Use canonical region ONLY (set by the bus) â€” do NOT read selects here
    const REG = window.REGION || { country: 'ALL', area: 'ALL' };

    // 3) Filter via the canonical filter
    // After loading/sanitising `safeRows`:
    const choose = window.filterRowsByRegion || window.canonicalFilterRowsByRegionImpl;
    const filtered = (typeof choose === 'function') ? choose(safeRows) : safeRows;




    // 4) Feed donut (never remount here)

    if (window.SunburstAPI && typeof window.SunburstAPI.setData === 'function') {
      try { window.d3 && d3.select('#sunburst-mount').selectAll('*').interrupt(); } catch {}

      // Keep the sunburst's internal REGION in lock-step with the shell/map
      try {
        if (typeof window.SunburstAPI.setRegion === 'function') {
          const reg = window.REGION || { country: 'ALL', area: 'ALL' };
          const rawCode = String(reg.country || 'ALL').toUpperCase();

          // Translate the stored COUNTRY CODE into the display NAME
          let displayCountry;
          if (rawCode === 'ALL') {
            displayCountry = 'ALL';
          } else if (window.CC_TO_NAME && window.CC_TO_NAME[rawCode]) {
            displayCountry = window.CC_TO_NAME[rawCode];
          } else {
            // Fallback: use whatever is stored
            displayCountry = reg.country || 'ALL';
          }

          const areaLabel = reg.area || 'ALL';

          // Silent: only update the internal region used by filters,
          // do not disturb the current drill/view state.
          window.SunburstAPI.setRegion(
            { country: displayCountry, area: areaLabel },
            { silent: true }
          );

          console.log('[fetch] primed sunburst region from REG', {
            code: rawCode,
            displayCountry,
            area: areaLabel
          });
        }
      } catch (e) {
        console.warn('[fetch] prime sunburst region failed', e);
      }

      // â¬‡ï¸ use enriched here
      window.SunburstAPI.setData(filtered);
      console.log('[fetch] setData', { rows: filtered.length, REG });
    } else {
      // first boot: store rows and let the *single* mount consume them
      // â¬‡ï¸ and here
      window.LATEST_SPOT_ROWS = filtered.slice();
      console.log('[fetch] renderer not ready; cached rows', { rows: filtered.length, REG });
    }

    setUIFromRegion();
    // 5) Debug counts
    const working = filtered.filter(r => {
      const b = (r.bucket || r.colour || r.color || '').toString();
      return b.toUpperCase() === 'WORKING' || b.toLowerCase() === 'green';
    }).length;
    console.log('[fetch] done', {
      unfiltered: safeRows.length, filtered: filtered.length, working, REG
    });

  } catch (e) {
    console.error('[fetch] failed:', e);
  }
}


// Make it callable from anywhere (mapReady, dayChange, etc.)
window.fetchSpotsForCurrentDay = fetchSpotsForCurrentDay;

</script>
<script>
  window.setUIFromRegion = function setUIFromRegion() {
    try {
      if (typeof window.getRegionDisplayLabels !== 'function') return;

      // Single source of truth for display labels
      const reg = window.getRegionDisplayLabels();
      const displayCountry = reg.displayCountry || reg.country || 'ALL';
      const areaLabel      = reg.area || 'ALL';

      console.log('[setUIFromRegion]', reg);

      // 1) Keep the MOBILE dropdowns in sync (safe / tolerant helper)
      if (typeof window.ensureMobDropdownsReady === 'function') {
        window.ensureMobDropdownsReady(() => {
          if (typeof window.syncSelectsSafe === 'function') {
            window.syncSelectsSafe(displayCountry, areaLabel);
          }
        });
      }

      // 2) Keep the SUNBURST <select>s in sync, if theyâ€™re present in this DOM
      const selC = document.getElementById('country'); // donut country
      const selA = document.getElementById('area');    // donut area

      if (selC) {
        const hasC = Array.from(selC.options).some(o => o.value === displayCountry);
        if (hasC && selC.value !== displayCountry) {
          selC.value = displayCountry;
        }
      }

      if (selA) {
        const hasA = Array.from(selA.options).some(o => o.value === areaLabel);
        if (hasA && selA.value !== areaLabel) {
          selA.value = areaLabel;
        }
      }
    } catch (e) {
      console.warn('[setUIFromRegion] failed', e);
    }
  };
</script>


<script>
window.forceSyncSelects = (countryLike, areaLike) => {
  try {
    // Resolve a CODE from whatever we received ("United Kingdom", "GB", "ALL", etc.)
    const cc = (window.resolveCC ? window.resolveCC(countryLike) : String(countryLike||'ALL')).toUpperCase();

    const selC = document.getElementById('mob-country');
    const selA = document.getElementById('mob-area');
    if (!selC || !selA) return;

    // --- Country select uses CODE as value (GB, FR, â€¦, ALL)
    if (selC.value !== cc) selC.value = cc;

    // --- Area select: show only areas that belong to this country code
    [...selA.options].forEach(opt => {
      if (opt.value === 'ALL') { opt.hidden = false; return; }
      const belongs = (cc === 'ALL') || (String(opt.dataset.country||'').toUpperCase() === cc);
      opt.hidden = !belongs;
    });

    // Set area if itâ€™s visible, else fall back to ALL
    const wantedArea = String(areaLike || 'ALL');
    const areaIsVisible = [...selA.options].some(o => !o.hidden && o.value === wantedArea);

    console.log('[forceSyncSelects] want', countryLike, areaLike, 'â†’ cc=', cc, 
                'before=', {c: selC.value, a: selA.value});

    selA.value = areaIsVisible ? wantedArea : 'ALL';
  } catch (e) {
    console.warn('[forceSyncSelects] failed', e);
  }
};
</script>

<script>

  (function () {
    const btn  = document.getElementById('mob-reset-region');
    const selC = document.getElementById('mob-country');
    const selA = document.getElementById('mob-area');

    if (!btn || !selC || !selA) return;

    btn.addEventListener('click', (e) => {
      const wsCard = document.getElementById('wsCard');

      // 1ï¸âƒ£ If wave drawer open â†’ close it, swallow the click
      if (wsCard && wsCard.classList.contains('is-open')) {
        e.preventDefault();
        e.stopPropagation();
        try { window.UI?.closeWS(); } catch (_) {}
        return;
      }

      // 2ï¸âƒ£ Drawer is closed â†’ run original behaviour
      const cc   = selC.value;
      const area = selA.value;

      if (window.forceSyncSelects) {
        window.forceSyncSelects(cc, area);
      }

      const ev = new Event('change', { bubbles: true });
      selA.dispatchEvent(ev);
    });
  })();
</script>
<script>
/* --- canonical name<->code helpers (case-insensitive) --- */
(function(){
  // Build NAME_TO_CC from CC_TO_NAME if needed (case-insensitive keys)
  function buildNameToCode(){
    if (!window.CC_TO_NAME || typeof window.CC_TO_NAME !== 'object') return;
    const m = {};
    for (const [cc, nm] of Object.entries(window.CC_TO_NAME)) {
      if (!nm) continue;
      m[String(nm).trim().toLowerCase()] = cc;        // "united kingdom" -> "GB"
    }
    // a few conveniences
    m['uk'] = 'GB';
    m['gb'] = 'GB';
    window.NAME_TO_CC = m;
  }
  if (!window.NAME_TO_CC) buildNameToCode();

  // Resolve possibly uppercased or mixed-case names to a CODE
  window.resolveCountryCode = function(nameOrCode){
    const s = String(nameOrCode || 'ALL').trim();
    if (!s || s === 'ALL') return 'ALL';
    // If it's already a known code, keep it
    if (window.CC_TO_NAME && window.CC_TO_NAME[s]) return s;
    // Try name -> code, case-insensitive
    const lc = s.toLowerCase();
    if (window.NAME_TO_CC && window.NAME_TO_CC[lc]) return window.NAME_TO_CC[lc];
    return s; // last resort: pass through unchanged
  };
})();
</script>




<script>
// --- Helpers: resolve country to a display NAME (no hard-coded lists)
function countryNameOf(c) {
  const s = String(c || 'ALL');
  if (s === 'ALL') return 'ALL';
  // If it's already a known code, map to name
  if (window.CC_TO_NAME && window.CC_TO_NAME[s]) return window.CC_TO_NAME[s];
  // Otherwise assume it's a name already
  return s;
}

// --- country/name helpers (global, single source of truth) ---
window.ensureNameToCode = window.ensureNameToCode || function ensureNameToCode() {
  if (!window.NAME_TO_CC && window.CC_TO_NAME && typeof window.CC_TO_NAME === 'object') {
    const map = {};
    for (const [cc, nm] of Object.entries(window.CC_TO_NAME)) {
      if (nm) map[String(nm).trim()] = cc; // "United Kingdom" -> "GB"
    }
    window.NAME_TO_CC = map;
  }
};

window.resolveCC = function resolveCC(nameOrCode) {
  const raw = String(nameOrCode || 'ALL').trim();
  if (!raw) return 'ALL';

  const U = raw.toUpperCase();
  if (U === 'ALL') return 'ALL';
  if (window.CC_TO_NAME && window.CC_TO_NAME[U]) return U;

  const key = raw.toLowerCase();
  const cc =
    (window.NAME_TO_CC && window.NAME_TO_CC[key]) ||
    ({
      'united kingdom': 'GB',
      'uk': 'GB',
      'gb': 'GB',
      'scotland': 'SCT',
      'wales': 'CYM',
      'england': 'ENG',
      'northern ireland': 'NIR'
    }[key]);

  return cc || raw;
};
window.syncSelects = function syncSelects(displayCountryName, areaLabel) {
  try {
    const cSel = document.getElementById('mob-country');
    const aSel = document.getElementById('mob-area');
    if (!cSel && !aSel) return;

    window.__settingDropdowns = true;
    const code = window.resolveCC(displayCountryName);

    if (cSel) {
      const has = Array.from(cSel.options).some(o => o.value === code);
      if (has && cSel.value !== code) cSel.value = code;
    }
    if (aSel) {
      const want = String(areaLabel || 'ALL').trim();
      const has = Array.from(aSel.options).some(o => o.value === want);
      if (has && aSel.value !== want) aSel.value = want;
    }
  } catch (e) {
    console.warn('[syncSelects] failed', e);
  } finally {
    window.__settingDropdowns = false;
  }
};
/**
 * Filter rows by REGION using names from BOUNDARIES.
 * - If area is selected => filter by area name directly
 * - Else if country selected => collect that country's areas from BOUNDARIES.by_area and filter by those
 * - Else (ALL) => pass through
 */
function canonicalFilterRowsByRegionImpl(rows) {
  const list = Array.isArray(rows) ? rows : [];
  const REG  = window.REGION || { country: 'ALL', area: 'ALL' };



  const rawArea = String(REG.area || 'ALL').trim();
  const cc      = resolveCC(REG.country);            // <- prefer CODE in REGION, but robust if a name arrives
  const byArea  = window.BOUNDARIES && window.BOUNDARIES.by_area;

  // 0) Meta / top-level (treat like ALL)
  const META = new Set(['ALL', 'NEA', 'NE ATLANTIC', 'NE Atlantic']);
  if (META.has(cc) || META.has(String(REG.country || '').toUpperCase())) {
    return list;
  }

  // 1) Area explicitly chosen â†’ exact match on the label used in spots JSON
  if (rawArea !== 'ALL') {
    const out = list.filter(r => String(r.area || r.group || '').trim() === rawArea);
    if (!out.length && list.length) {
      console.warn('[filterRowsByRegionImpl] area produced 0; fallback', { area: rawArea });
      return list;
    }
    return out;
  }

  // 2) Country chosen (and not meta)
  if (cc !== 'ALL') {
    if (!byArea) {
      console.warn('[filterRowsByRegionImpl] BOUNDARIES not ready; pass-through', { cc, REG });
      return list;
    }

    // Build wanted area names by matching country_code (primary) or country name (fallback)
    const wantedAreas = [];
    for (const r of Object.values(byArea)) {
      const areaName = String(r.area || '').trim();
      if (!areaName) continue;
      const rCode = String(r.country_code || '').trim();
      const rName = String(r.country || '').trim();

      if (rCode.toUpperCase() === cc.toUpperCase()) {
        wantedAreas.push(areaName);
      } else {
        // If a name slipped into REGION.country, this fallback still works
        // (resolveCC(name) == cc means rName corresponds to the same country)
        if (resolveCC(rName).toUpperCase() === cc.toUpperCase()) {
          wantedAreas.push(areaName);
        }
      }
    }

    const wanted = new Set(wantedAreas);
    const out = list.filter(r => wanted.has(String(r.area || r.group || '').trim()));
    if (!out.length && list.length) {
      console.warn('[filterRowsByRegionImpl] country produced 0; fallback', { cc, wantedAreas });
      return list;
    }
    return out;
  }

  // 3) Top-level ALL
  return list;
}
// Expose a single, canonical entry point that old call-sites already use
window.filterRowsByRegion = canonicalFilterRowsByRegionImpl;
</script>

<script>
(() => {
  // --- simple signature helper to avoid dumb loops ---
  const regionSig = (country, area) =>
    `${String(country || 'ALL')}|${String(area || 'ALL')}`;

  // --- syncSelects: mobile dropdowns (country = CODE, area = LABEL) ---
  (function () {
    // syncSelects v3: country select uses CODE in .value; area select uses LABEL in .value
    window.syncSelects = function syncSelects(countryNameOrCode, areaName) {
      const elCountry = document.getElementById('mob-country');
      const elArea    = document.getElementById('mob-area');
      if (!elCountry || !elArea) return;

      // Use the same helper as the rest of the code
      const cc = window.resolveCC
        ? window.resolveCC(countryNameOrCode)
        : String(countryNameOrCode || 'ALL').toUpperCase();

      // NEW: remember last non-ALL country code for UI purposes
      if (cc !== 'ALL') {
        window.__lastNonAllCountry = cc;
      }

      // NEW: when cc === 'ALL', keep showing the last real country in the dropdown
      const effectiveCountryValue =
        cc === 'ALL'
          ? (window.__lastNonAllCountry || 'ALL')
          : cc;

      const countryValue = effectiveCountryValue;
      const targetArea =
        areaName && areaName !== 'ALL' ? String(areaName) : 'ALL';

      // Step 1: set country value if different
      const needCountrySet = elCountry.value !== countryValue;
      if (needCountrySet) elCountry.value = countryValue;

      // Step 2: (re)populate the areas if country changed
      if (needCountrySet) {
        try {
          if (countryValue !== 'ALL' && typeof window.populateAreas === 'function') {
            window.populateAreas(countryValue);
            elArea.disabled = false;
          } else {
            elArea.innerHTML = '';
            elArea.disabled = true;
          }
        } catch (e) {
          console.warn('[syncSelects] populateAreas failed', e);
        }
      }

      // Step 3: set the area value *after* options exist
      requestAnimationFrame(() => {
        let opts = Array.from(elArea.options);

        // 3a) If there are no options yet but we have a country, try a "late" populate
        if (
          !opts.length &&
          elCountry.value &&
          elCountry.value !== 'ALL' &&
          typeof window.populateAreas === 'function'
        ) {
          try {
            window.populateAreas(elCountry.value);
            elArea.disabled = false;
            opts = Array.from(elArea.options);
            console.debug('[syncSelects] late populateAreas for', elCountry.value, {
              options: opts.map((o) => o.value),
            });
          } catch (e) {
            console.warn('[syncSelects] late populateAreas failed', e);
          }
        }

        // 3b) If we *still* have no options, fall back to BOUNDARIES (belt-and-braces)
        if (!opts.length &&
            window.BOUNDARIES &&
            window.BOUNDARIES.by_area &&
            elCountry.value &&
            elCountry.value !== 'ALL') {
          try {
            const ccNow = elCountry.value.toUpperCase();
            const rows = Object.values(window.BOUNDARIES.by_area)
              .filter((b) => b && b.country_code === ccNow)
              .sort((a, b) => (a.area || '').localeCompare(b.area || ''));

            elArea.innerHTML = '';

            // Add ALL at the top
            const optAll = document.createElement('option');
            optAll.value = 'ALL';
            optAll.text = 'ALL';
            elArea.appendChild(optAll);

            rows.forEach((b) => {
              const opt = document.createElement('option');
              opt.value = b.area;
              opt.text = b.area;
              elArea.appendChild(opt);
            });

            elArea.disabled = false;
            opts = Array.from(elArea.options);

            console.debug('[syncSelects] populated from BOUNDARIES for', ccNow, {
              options: opts.map((o) => o.value),
            });
          } catch (e) {
            console.warn('[syncSelects] BOUNDARIES populate failed', e);
          }
        }

        // 3c) Apply targetArea: handle ALL vs specific area
        const isAllTarget = !targetArea || targetArea === 'ALL';

        if (isAllTarget) {
          // If we have 'ALL' in the list, select it; otherwise leave current value
          const allOpt = opts.find((o) => o.value === 'ALL');
          if (allOpt && elArea.value !== 'ALL') {
            elArea.value = 'ALL';
          }
        } else {
          const exists = opts.some((o) => o.value === targetArea);
          if (exists) {
            if (elArea.value !== targetArea) elArea.value = targetArea;
          } else {
            console.warn('[syncSelects] target area not found in options', {
              targetArea,
              options: opts.map((o) => o.value),
            });
          }
        }

        console.log('[syncSelects]', {
          countryValueNow: elCountry.value,
          areaValueNow: elArea.value,
        });
      });

    };
  })();

  // --- map driver: sends navGo into the iframe ---
  const sendToMap = (country, area) => {
    try {
      const pl = {
        country: country === 'ALL' ? null : country,
        area: area === 'ALL' ? null : area,
        cont: null,
      };
      console.debug('[sendToMap] mapLoaded=', mapLoaded, 'payload=', pl);
      pendingNav = pl;
      if (mapLoaded && iframe && iframe.contentWindow) {
        // Map is ready â€“ push immediately
        console.debug('[sendToMap] POST navGo', pl);
        iframe.contentWindow.postMessage({ type: 'navGo', payload: pl }, '*');
      } else {
        console.debug('[sendToMap] SKIP post (mapLoaded=false)');
      }
    } catch (e) {
      console.warn('[sendToMap] failed', e);
    }
  };


  function computeZoomOutRegion() {
    const reg = window.REGION || { country: 'ALL', area: 'ALL' };
    const country = reg.country || 'ALL';
    const area    = reg.area    || 'ALL';

    // If weâ€™re at AREA level â†’ zoom out to whole country
    if (area !== 'ALL') {
      return { country, area: 'ALL' };
    }

    // If weâ€™re at COUNTRY level â†’ zoom out to global/all
    if (country !== 'ALL') {
      return { country: 'ALL', area: 'ALL' };
    }

    // Already fully zoomed out
    return { country: 'ALL', area: 'ALL' };
  }


  // --- donut refresh helper ---
  function refreshDonutForRegion() {
    try {
      if (typeof window.fetchSpotsForCurrentDay === 'function') {
        (typeof queueMicrotask === 'function'
          ? queueMicrotask
          : (fn) => setTimeout(fn, 0))(() => {
          console.log(
            '[flow] regionChange â†’ fetchSpotsForCurrentDay with',
            window.REGION
          );
          window.fetchSpotsForCurrentDay();
        });
      }
    } catch (e) {
      console.warn('[bus] refreshDonutForRegion failed', e);
    }
  }
  bus.on('regionChange', (e) => {
    const d = e?.detail || {};
    const from = d.from || 'unknown';

    // Canonical state: always read from window.REGION
    const REG = window.REGION || { country: 'ALL', area: 'ALL', areaCode: 'ALL' };

    const code      = String(REG.country  || 'ALL').toUpperCase();  // country CODE (GB, FR, â€¦)
    const areaCode  = String(REG.areaCode || 'ALL').toUpperCase();  // canonical area code (GB-02, ES-05, â€¦)
    const areaLabel = String(REG.area     || 'ALL');                // human label ("The North East")

    // What we *show* in the UI when we talk about the country
    const displayCountry =
      code === 'ALL'
        ? 'ALL'
        : (window.CC_TO_NAME && window.CC_TO_NAME[code]) || code;

    // Signature to avoid pointless re-runs (still based on NAME + LABEL for now)
    const sig = regionSig(displayCountry, areaLabel);
    if (sig === window.__lastRegionSig && from !== 'sunburst-applied') {
      return;
    }
    window.__lastRegionSig = sig;

    console.debug('[regionChange]', {
      from,
      REG,
      code,
      areaCode,
      areaLabel,
      displayCountry,
    });

    // 1) Keep mobile dropdowns visually synced (but do NOT re-fire change)
    if (typeof window.syncSelects === 'function') {
      window.syncSelects(displayCountry, areaLabel);
    }

    // 2) Drive the map, unless the map itself triggered this
    if (from !== 'map') {
      try {
        console.debug('[regionChangeâ†’map]', { from, code, areaLabel, areaCode });
        // Map still expects country CODE + area LABEL
        sendToMap(code, areaLabel);
      } catch (err) {
        console.warn('[regionChange] map nav failed', err);
      }
    }

    // 3) Refresh donut data *unless* the sunburst is already applying it
    if (from !== 'sunburst' && from !== 'sunburst-applied') {
      refreshDonutForRegion();
    }

    // 4) Any other UI bits (titles, chips, etc.)
    try {
      if (typeof window.setUIFromRegion === 'function') {
        window.setUIFromRegion();
      }
    } catch (err) {
      console.warn('[regionChange] setUIFromRegion failed', err);
    }
  });

})();
</script>



<script>
(function () {
  // --- helpers / DOM refs
  const $ = (sel) => document.querySelector(sel);
  const elCountry = $('#mob-country');
  const elArea    = $('#mob-area');
  const btnClose  = $('#mob-close');
  const wrapMap   = $('#mapwrap');
  const iframe    = $('#mob-map');
  const mapTitle  = $('#mapTitle');
  const mapStatus = $('#mapStatus');

/* ===== Drawer Controller: one source of truth ===== */
const UI = (() => {
  const hc  = () => document.getElementById('hoverCard');
  const ws  = () => document.getElementById('wsCard');

  let state = 'IDLE';                 // IDLE | HOVER | WS
  let hoverPayload = null;
  let suppressHoverUntil = 0;

  const now = () => performance.now();
  const inAnim = 260; // ms â€“ matches your transition fallback

  function closeWaveSelectorSync(){
    const wsCard = ws();
    if (!wsCard) return;
    wsCard.classList.remove('is-open');
    wsCard.style.display = 'none';
    wsCard.setAttribute('aria-hidden','true');
    state = 'IDLE';
  }

  function openHover(p){
    // If WS is visible or weâ€™re within the suppression window, ignore hover
    if (state === 'WS' || now() < suppressHoverUntil) return;

    hoverPayload = p || hoverPayload;
    if (!hoverPayload) return;

    // ensure WS is shut before opening hover
    closeWS(true);
    showHoverCard(hoverPayload);
    state = 'HOVER';
  }

  function closeHover(immediate = false){
    const card = hc();
    if (!card) return;
    if (immediate){
      card.classList.remove('is-open');
      card.style.display = 'none';
      card.setAttribute('aria-hidden','true');
    } else {
      hideHoverCard();
    }
    state = 'IDLE';
  }

  function openWS(){
    // prevent late hover opens while the sheet animates
    suppressHoverUntil = now() + inAnim + 80;

    // close hover immediately to avoid transform conflicts
    closeHover(true);

    if (typeof window.openWaveSelector === 'function') {
      window.openWaveSelector();
      state = 'WS';
    }
  }

  function closeWS(immediate = false){
    const card = ws();
    detachDonutResizer();
    if (!card) return;
    if (immediate){
      card.classList.remove('is-open');
      card.style.display = 'none';
      card.setAttribute('aria-hidden','true');
    } else {
      hideCard(card);
    }
    // tiny suppression so late spotHover messages donâ€™t pop the drawer
    suppressHoverUntil = now() + 120;
    state = 'IDLE';
  }

  // expose the API
  return {
    openHover,
    closeHover,
    openWS,
    closeWS,
    get state(){ return state; },
    closeWaveSelectorSync, // optional, if you use it elsewhere
  };
})();

// make it globally reachable (after it exists)
window.UI = UI;

// === Donut sizing (single source of truth) ====================


function applySunburstNarrowMode() {
  const m = document.getElementById('sunburst-mount');
  if (!m) return;
  if (window.innerWidth <= 400) m.classList.add('narrow');
  else m.classList.remove('narrow');
}

// call after the sunburst renders and on resize
window.addEventListener('resize', applySunburstNarrowMode);

// if you wrapped openWaveSelector, plug it in there too:
const _openWS = window.openWaveSelector;
window.openWaveSelector = function () {
  _openWS && _openWS();
  // ensure donut is sized first, then apply label mode
  requestAnimationFrame(() => {
    if (typeof sizeDonut === 'function') sizeDonut();
    applySunburstNarrowMode();
  });
};

function sizeDonut(){
  const wsCard = document.getElementById('wsCard');
  const host   = document.getElementById('wave-selector');
  const left   = document.getElementById('ws-left');
  const mount  = document.getElementById('sunburst-mount');
  if (!wsCard || !host || !left || !mount) return;

  const cardRect = wsCard.getBoundingClientRect();
  const leftRect = left.getBoundingClientRect();

  const GAP     = 12;   // keep in sync with CSS
  const PADDING = 24;

  // ---- phone vs tablet/desktop behaviour -------------------------------
  const smallScreen = window.innerWidth <= 430;

  // phones: noticeably smaller donut
  const MIN  = smallScreen ? 150 : 180;
  const MAX  = smallScreen ? 220 : 320;
  const FACTOR = smallScreen ? 0.50 : 0.70;   // % of viewport width

  // how much horizontal room is actually left for the donut column?
  const available =
    Math.max(0, cardRect.width - leftRect.width - GAP - PADDING);

  const maxByViewport = window.innerWidth * FACTOR;

  const px = Math.max(
    MIN,
    Math.min(available, maxByViewport, MAX)
  );

  mount.style.width  = Math.round(px) + 'px';
  mount.style.height = 'auto';

  try { window.Sunburst?.resize?.(); } catch (_) {}
}

function attachDonutResizer(){
  const wsCard = document.getElementById('wsCard');
  if (!wsCard) return;

  if (_donutRO) {
    try { _donutRO.disconnect(); } catch (_) {}
  }
  _donutRO = new ResizeObserver(() => sizeDonut());
  _donutRO.observe(wsCard);

  window.addEventListener('resize', sizeDonut);
}

function detachDonutResizer(){
  if (_donutRO) {
    try { _donutRO.disconnect(); } catch (_) {}
    _donutRO = null;
  }
  window.removeEventListener('resize', sizeDonut);
}






  // Hover card bits
  const hoverCard = document.getElementById('hoverCard');
  const hcWind    = document.getElementById('hcWind');
  const hcPeriod  = document.getElementById('hcPeriod');

  // --- globals
  let CURRENT_OFFSET = 0;
  window.CURRENT_OFFSET = CURRENT_OFFSET;
  let mapLoaded      = false;
  let pendingNav     = null;
  let navTimerId   = null;

  // Use station-first if available
  const TIDE_SRC = window.TIDES_STATIONS || window.TIDES || {};

  let LAST_TIDE_PORT = null;   // remember which station to render
  window.LAST_TIDE_PREF = null;

  // === Date chip (same logic as TV) ===========================
    function setMobileDate(offset) {
    const base = new Date();
    base.setDate(base.getDate() + offset);

    const wd  = base.toLocaleDateString('en-GB', { weekday: 'short', timeZone: 'Europe/London' }); // Wed
    const mon = base.toLocaleDateString('en-GB', { month: 'short',   timeZone: 'Europe/London' }); // Oct
    const day = Number(base.toLocaleDateString('en-GB', { day: '2-digit', timeZone: 'Europe/London' }));

    const suf = (n) => (n >= 11 && n <= 13) ? 'th' : ({1:'st',2:'nd',3:'rd'}[n % 10] || 'th');

    const btn = document.getElementById('mob-date');
    if (btn) btn.textContent = `${wd} ${day}${suf(day)}`;
    }





    function switchDay(offset) {
      CURRENT_OFFSET = offset;
      window.CURRENT_OFFSET = CURRENT_OFFSET;
      setMobileDate(offset);
      mapLoaded = false;
      iframe.src = `map_day${offset}.html?mob=1&v=` + Date.now();
      scheduleNavGo(300);
      // ðŸ”„ also refresh the donut's rows for this day (module function)
      try { window.fetchSpotsForCurrentDay?.(); } catch (_) {}
      // NEW: tell everyone the reporting day changed
      try {
        const iso = (window.TideMobile?.dayISO?.(CURRENT_OFFSET))
                || new Date(Date.now() + CURRENT_OFFSET*864e5).toISOString().slice(0,10);
        window.bus?.emit('dayChange', { offset: CURRENT_OFFSET, iso, from: 'mobile' });
      } catch {}

    }


  // === Map wiring (persistent, queue-safe) ====================

    function scheduleNavGo(delayMs = 150) {
    pendingNav = currentPayload();
    console.debug('[mobileâ†’map] queue navGo', pendingNav, 'mapLoaded=', mapLoaded);
    if (navTimerId) clearTimeout(navTimerId);
    navTimerId = setTimeout(() => {
        if (!mapLoaded) { console.debug('[mobileâ†’map] skipped send (mapLoaded=false)'); return; }
        try {
        wrapMap.classList.add('ready');
        console.debug('[mobileâ†’map] SEND (debounced) navGo', pendingNav);
        iframe.contentWindow.postMessage({ type: 'navGo', payload: pendingNav }, '*');
        } catch (e) { console.warn('[mobileâ†’map] postMessage failed', e); }
        pendingNav = null;
        navTimerId = null;
    }, delayMs);
    }



    // helpers so we don't crash if wrapper spans aren't present yet
    function setChipText(containerId, innerSpanId, text) {
    const container = document.getElementById(containerId);
    if (!container) return;
    const inner = document.getElementById(innerSpanId);

    if (inner) {
        inner.textContent = text;                     // new markup path
    } else {
        // legacy markup path: no inner span; just set the chip's text
        // (this will not remove an icon because legacy had no icon)
        container.textContent = text;
    }
    }

    // Single source of truth: rotate chip chevrons to show a "FROM" bearing (match the dial)
    function setChipChevron(iconId, deg) {
        const svg = document.getElementById(iconId);
        if (!svg) return;

        const n = Number(String(deg).replace(/[^\d.-]/g, ''));
        if (!Number.isFinite(n)) { svg.style.display = 'none'; return; }
        svg.style.display = '';

        const a = ((n % 360) + 360) % 360;        // normalize 0..359

        // Our caret points UP by default (north). The dial shows a "from" vector.
        // To match the dial's semantics: rotate by (a + 180) so the caret points
        // back along the incoming direction (i.e., â€œfromâ€).
        const rotor = svg.querySelector('.chip-rotor') || svg;
        rotor.style.transform = `rotate(${(a + 180) % 360}deg)`;
    }

// ====== Filter state & helpers (mobile â†’ map) =========================
const FILTER_STORE_KEY = 'spotonFilters_v1';
const defaultEdges = { flat:[0,2], fun:[2,4], solid:[4,8], consequence:[8,Infinity] };
let filterState = { mode:'ALL', requireGreen:false, edges: { ...defaultEdges } };


// Allow other components (like the sunburst) to drive the wave filter
window.setWaveFilters = function (payload) {
  const { mode: rawMode, edges } = payload || {};

  // 1ï¸âƒ£ Normalise the requested mode into a UI-friendly value
  //    - Map CONSEQUENCE â†’ BIG so the chip/menu can say "Big"
  let requested = (rawMode || 'ALL').toUpperCase();
  if (requested === 'CONSEQUENCE') requested = 'BIG';

  const isWaveBand =
    requested === 'FUN' ||
    requested === 'SOLID' ||
    requested === 'BIG';

  // 2ï¸âƒ£ TOGGLE BEHAVIOUR
  //    Clicking the same wave band again while it's active
  //    (and currently working-only) â†’ reset back to ALL, no green-only.
  if (
    isWaveBand &&
    requested === filterState.mode &&
    filterState.requireGreen
  ) {
    filterState.mode = 'ALL';
    filterState.requireGreen = false;
  } else {
    // 3ï¸âƒ£ Normal path: apply the incoming band
    filterState.mode = requested;
    // Any wave band => working only; ALL (or anything else) => not forced green
    filterState.requireGreen = isWaveBand ? true : false;
  }

  // 4ï¸âƒ£ Carry across any updated slider edges
  if (edges) {
    filterState.edges = edges;
  }

  // 5ï¸âƒ£ Update the chip + send the filter to the map
  syncFilterUI();
  applyFilterToMap();   // <- this is where you do BIG â†’ CONSEQUENCE for the MAP
};




function loadFilterState(){
  try {
    const raw = localStorage.getItem(FILTER_STORE_KEY);
    if (!raw) return;
    const saved = JSON.parse(raw);
    if (saved && typeof saved === 'object') {
      filterState.mode = (saved.mode || 'ALL').toUpperCase();
      filterState.requireGreen = !!saved.requireGreen;

      // ðŸ”’ ensure bands are always â€œworking onlyâ€
      if (filterState.mode !== 'ALL' && !filterState.requireGreen) {
        filterState.requireGreen = true;
      }

      if (saved.edges && typeof saved.edges === 'object') {
        filterState.edges = {
          flat:        saved.edges.flat        || defaultEdges.flat,
          fun:         saved.edges.fun         || defaultEdges.fun,
          solid:       saved.edges.solid       || defaultEdges.solid,
          consequence: saved.edges.consequence || defaultEdges.consequence,
        };
      }
    }
  } catch(_) {}
}
function saveFilterState(){
  try { localStorage.setItem(FILTER_STORE_KEY, JSON.stringify(filterState)); } catch(_) {}
}
function postToMap(type, payload){
  try { iframe.contentWindow.postMessage({ type, payload }, '*'); } catch(e) { /* noop */ }
}

    function syncFilterUI(){
      const chip  = document.getElementById('mob-filter');        // the pill button
      const label = document.getElementById('mob-filter-label');  // inner span
      const menu  = document.getElementById('mob-filter-menu');
      const green = document.getElementById('mob-green-only');

      if (chip && label) {
        // normalise mode so we can compare safely
        const mode = String(filterState.mode || 'ALL').toUpperCase();
        let text = 'SpotsOn';

        if (mode === 'ALL' && filterState.requireGreen) {
          text = 'Working only';
        } else if (mode !== 'ALL') {
          if (mode === 'CONSEQUENCE') {
            text = 'Big';           // UI label for the CONSEQUENCE band
          } else {
            // FUN â†’ Fun, SOLID â†’ Solid
            text = mode[0] + mode.slice(1).toLowerCase();
          }
        }

        label.textContent = text;

        // colour state goes on the chip element
        chip.classList.remove(
          'chip--wave-all',
          'chip--wave-fun',
          'chip--wave-solid',
          'chip--wave-big'
        );

        if (mode === 'FUN') {
          chip.classList.add('chip--wave-fun');
        } else if (mode === 'SOLID') {
          chip.classList.add('chip--wave-solid');
        } else if (mode === 'CONSEQUENCE') {
          chip.classList.add('chip--wave-big');
        } else {
          // ALL (with or without green-only)
          chip.classList.add('chip--wave-all');
        }
      }

      if (green) green.checked = !!filterState.requireGreen;
      // any menu highlighting stays as-is
    }

    function applyFilterToMap() {
      let modeUI = String(filterState.mode || 'ALL').toUpperCase();

      // MAP buckets: BIG in UI corresponds to CONSEQUENCE in the map filter
      let modeForMap =
        modeUI === 'BIG' ? 'CONSEQUENCE' : modeUI;

      const requireGreen =
        modeForMap === 'ALL'
          ? !!filterState.requireGreen        // ALL can be with/without green
          : true;                             // any wave band â‡’ working only

      const effective = {
        ...filterState,
        mode: modeForMap,
        requireGreen,
      };

      postToMap('setFilterScale', effective.edges);

      const noFilter =
        effective.mode === 'ALL' && !effective.requireGreen;

      postToMap(
        'setFilter',
        noFilter
          ? { mode: 'ALL', requireGreen: false }
          : { mode: effective.mode, requireGreen: effective.requireGreen }
      );

      try {
        window.bus?.emit('filterChange', { ...effective, from: 'mobile' });
      } catch {}
    }

    // ====== UI events for the chip/menu ===================================
    function initFilterUI(){
        loadFilterState();
        syncFilterUI();

        const chip = document.getElementById('mob-filter');
        const menu = document.getElementById('mob-filter-menu');
        const greenOnly = document.getElementById('mob-green-only');
        const editBtn = document.getElementById('mob-edit-scale');

        function firstFocusable(root) {
        return root?.querySelector(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
    }

    function onMenuKeydown(e){
    if (e.key === 'Escape' || e.key === 'Esc') {
        e.stopPropagation();
        closeMenu();
    }
    }

    function onDocPointerDown(e){
    if (!menu) return;
    if (menu.contains(e.target) || chip?.contains(e.target)) return;
    closeMenu();
    }

    function openMenu(){
    if (!menu) return;
    // make interactive BEFORE focusing
    menu.removeAttribute('inert');
    menu.setAttribute('aria-hidden','false');
    chip?.setAttribute('aria-expanded','true');

    // move focus inside
    (firstFocusable(menu) || menu).focus({ preventScroll: true });

    // listeners while open
    menu.addEventListener('keydown', onMenuKeydown);
    document.addEventListener('pointerdown', onDocPointerDown);
    }

    function closeMenu(){
    if (!menu) return;

    // move focus OUT before hiding (prevents aria-hidden-on-focused-descendant warning)
    if (menu.contains(document.activeElement)) {
        chip?.focus({ preventScroll: true });
    }

    // now hide and inert
    menu.setAttribute('aria-hidden','true');
    menu.setAttribute('inert','');
    chip?.setAttribute('aria-expanded','false');

    menu.removeEventListener('keydown', onMenuKeydown);
    document.removeEventListener('pointerdown', onDocPointerDown);
    }

    chip?.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    const isOpen = menu?.getAttribute('aria-hidden') === 'false';
    isOpen ? closeMenu() : openMenu();
    });

    // (No global document 'click' listener anymore; pointerdown handles outside-click)

    menu?.querySelectorAll('button[data-mode]').forEach(btn => {
      btn.addEventListener('click', () => {
        const raw  = btn.getAttribute('data-mode') || 'ALL';
        const mode = String(raw).toUpperCase();

        if (mode === 'ALL') {
          // User explicitly chose â€œAll spotsâ€ â†’ clear working-only
          filterState.mode         = 'ALL';
          filterState.requireGreen = false;
        } else if (mode === 'WORKING') {
          // Only if you ever add a dedicated â€œWorking onlyâ€ menu item
          filterState.mode         = 'ALL';
          filterState.requireGreen = true;
        } else {
          // FUN / SOLID / BIG / CONSEQUENCE â†’ wave bands = always working-only
          filterState.mode         = mode;
          filterState.requireGreen = true;
        }

        saveFilterState();
        syncFilterUI();
        applyFilterToMap();
        closeMenu();
      });
    });

    greenOnly?.addEventListener('change', () => {
      const mode = String(filterState.mode || 'ALL').toUpperCase();

      if (mode === 'ALL') {
        // Only allow manual working-only in ALL mode
        filterState.requireGreen = !!greenOnly.checked;
      } else {
        // In wave modes, they are implicitly â€œworking onlyâ€ anyway
        filterState.requireGreen = true;
        greenOnly.checked = true;   // snap UI back into sync
      }

      saveFilterState();
      syncFilterUI();
      applyFilterToMap();
    });



    // 1) Delegated: works even if the menu re-renders or toggles inert/focus
    menu?.addEventListener('click', (e) => {
    console.log('edit clicked');
    // after: console.log('edit clicked');
    if (typeof window.renderSunburstInWsCard === 'function') {
      console.log('[mobileâ†’sunburst] invoking render after edit click');
      window.renderSunburstInWsCard();
    } else {
      console.warn('[mobileâ†’sunburst] renderSunburstInWsCard not available yet');
    }
    const edit = e.target?.closest('#mob-edit-scale');
    if (!edit) return;
    e.preventDefault();
    e.stopPropagation();
    closeMenu();
    UI.openWS();
    });

    // 2) Direct fallback: in case the delegated one is skipped by the UA/event order
    document.getElementById('mob-edit-scale')?.addEventListener('click', (e) => {
      if (window.__settingDropdowns) return; 
      console.log('edit clicked');
      e.preventDefault();
      e.stopPropagation();
      closeMenu();
      UI.openWS(); // single source of truth
    });

    }
    function fixHoverCardPosition(card){
    if (!card) return;
    Object.assign(card.style, {
        position: 'fixed',
        top: 'auto',
        bottom: '0',
        left: '0',
        right: '0',
        margin: '0 auto',
        maxWidth: '520px',
        width: 'auto',
        transform: '',   // let the CSS class control animation
        opacity: '',     // let the CSS class control opacity
        paddingBottom: `max(10px, env(safe-area-inset-bottom))`,
        display: 'block' // ensure it's paintable before adding .is-open
    });
    }
    // --- Wave Selector (slider UI) -------------------------------------------

// --- Wave Selector (slider UI) -------------------------------------------

// --- mountHoverCard: keep the drawer mounted safely at top level ---
function mountHoverCard() {
  const card = document.getElementById('hoverCard');
  if (!card) return;

  // Ensure a stable top-level mount point
  let root = document.getElementById('hc-root');
  if (!root) {
    root = document.createElement('div');
    root.id = 'hc-root';
    root.style.cssText = 'position:fixed;inset:0;pointer-events:none;z-index:9999';
    document.body.appendChild(root);
  }

  // If root ever ended up inside the card, move it back out first
  if (card.contains(root)) document.body.appendChild(root);

  // Only move the card if needed
  if (card.parentElement !== root) root.appendChild(card);

  // Allow interaction with the card, but not the overlay
  root.style.pointerEvents = 'none';
  card.style.pointerEvents = 'auto';
}

function mountWsCard() {
  let root = document.getElementById('ws-root');
  if (!root) {
    root = document.createElement('div');
    root.id = 'ws-root';
    root.style.cssText = 'position:fixed;inset:0;pointer-events:none;z-index:2147483646';
    document.body.appendChild(root);
  }
  const wsCard = document.getElementById('wsCard');
  if (wsCard && wsCard.parentElement !== root) {
    root.appendChild(wsCard);
  }
  // allow clicks on the sheet itself
  root.style.pointerEvents = 'none';
  wsCard.style.pointerEvents = 'auto';
}



// === Wave Selector layout helpers (clean version) =======================
let _donutRO = null;

function openWaveSelector(){
  mountWsCard();
  const wsCard = document.getElementById('wsCard');
  const host   = document.getElementById('wave-selector');
  if (!wsCard || !host) return;

  // Make sure weâ€™re in two-column â€œhas donutâ€ mode
  host.classList.add('ws-two-col', 'has-donut');

  // Close hoverCard if open
  const hover = document.getElementById('hoverCard');
  if (hover && hover.classList.contains('is-open')) {
    hover.classList.remove('is-open');
    hover.style.display = 'none';
    hover.setAttribute('aria-hidden', 'true');
  }

  // Seed edges for the sliders
  if (window.WaveSelector?.setEdges) {
    window.WaveSelector.setEdges(filterState.edges);
  }
  window.SB_WAVE_EDGES = { ...filterState.edges };

  // Show / animate the bottom sheet
  wsCard.style.display = 'block';
  wsCard.setAttribute('aria-hidden', 'false');
  void wsCard.offsetHeight;                // force reflow for transition
  wsCard.classList.add('is-open');
  window.UI.state = 'WS';

  // ---------- LEFT COLUMN: bands + sliders ------------------------------
  let left = document.getElementById('ws-left');
  if (!left) {
    left = document.createElement('div');
    left.id = 'ws-left';
    left.className = 'ws-left';
  }

  // Move everything except donut/Set into the left column
  const keepIds = new Set(['donut-col', 'ws-set-slot']);
  Array.from(host.children).forEach(node => {
    if (node === left) return;
    if (keepIds.has(node.id)) return;
    left.appendChild(node);
  });
  if (left.parentElement !== host) host.prepend(left);

  // ðŸ”’ Lock left-column width so CSS & JS agree
  const LEFT_W = 150; // tweak this number to taste
  left.style.width    = LEFT_W + 'px';
  left.style.minWidth = LEFT_W + 'px';
  left.style.maxWidth = LEFT_W + 'px';

  // ---------- RIGHT COLUMN: donut + legend ------------------------------
  let donutCol = document.getElementById('donut-col');
  if (!donutCol) {
    donutCol = document.createElement('div');
    donutCol.id = 'donut-col';
  }
  if (donutCol.parentElement !== host) host.appendChild(donutCol);

  // Donut mount
  let mount = document.getElementById('sunburst-mount');
  if (!mount) {
    mount = document.createElement('div');
    mount.id = 'sunburst-mount';
  }
  if (mount.parentElement !== donutCol) donutCol.appendChild(mount);

    // Legend container (JS injector will fill this)
  let legend = document.getElementById('sunburst-legend');
  if (!legend) {
    legend = document.createElement('div');
    legend.id = 'sunburst-legend';
  }
  if (legend.parentElement !== donutCol) donutCol.appendChild(legend);




  // ---------- Size & render donut ---------------------------------------
  sizeDonut();
  attachDonutResizer();

  try { window.fetchSpotsForCurrentDay?.(); } catch (_) {}
  window.renderSunburstInWsCard?.();



  // Escape to close
  wsCard.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      e.preventDefault();
      UI.closeWS();
    }
  }, { once: true });
}
  window.openWaveSelector = openWaveSelector;

    // finally, boot the UI on DOM ready (your page already has a DOMContentLoaded â€” just add:)
    document.addEventListener('DOMContentLoaded', () => {
    // existing call
    initFilterUI();

    // NEW: Wave Selector setup
    const edges = (window.filterState && filterState.edges) || {
        flat: [0, 1],
        fun: [1, 3],
        solid: [3, 6],
        consequence: [6, Infinity],
    };

    window.WaveSelector?.init({

        hostId: 'ws-left',
        step: 1,                 // 1 ft increments
        liveSnap: true,          // snap cleanly while dragging
        edges,
        onChange: (newEdges) => {
          // update your pageâ€™s source of truth
          filterState.edges = newEdges;

          // keep the diagnostic global in sync
          window.SB_WAVE_EDGES = { ...newEdges };

          saveFilterState();
          postToMap('setFilterScale', newEdges);
          // NEW: consumers can react to scale edits distinctly
          try { window.bus?.emit('filterScaleChange', { edges: newEdges, from: 'mobile' }); } catch {}
        },
        onClose: () => UI.closeWS(),
    });
  });



  // --- Helper: get NE Atlantic bbox from existing BOUNDARIES ---
  function getNEAtlanticBBox() {
    const B = window.BOUNDARIES || {};
    if (B.by_region && B.by_region.nea && Array.isArray(B.by_region.nea.bbox)) {
      return B.by_region.nea.bbox;
    }
    const nodes = Array.isArray(B.nodes) ? B.nodes : [];
    const n = nodes.find(x => {
      const slug = String(x.slug || '').toLowerCase();
      const code = String(x.region_code || '').toLowerCase();
      const name = String(x.name || '').toLowerCase();
      return slug.endsWith('/nea') || code === 'nea' || name === 'ne atlantic';
    });
    return (n && Array.isArray(n.bbox)) ? n.bbox : null;
  }

  function ensureMapLoaded() {
    // If not yet loaded, set initial src using CURRENT_OFFSET
    if (!iframe.src) {
      iframe.src = `map_day${CURRENT_OFFSET}.html?mob=1&v=` + Date.now();
      if (mapStatus) mapStatus.textContent = 'loadingâ€¦';
    }
    wrapMap.classList.remove('hidden'); // show immediately
    // Optional: tidy the panel title
    if (mapTitle)  mapTitle.textContent  = `Map${elCountry.value ? `: ${elCountry.options[elCountry.selectedIndex].text}` : ''}`;
  }

  // build the latest nav payload; send immediately if ready, else queue
    function sendNavGoNowOrQueue() {
    const pl = currentPayload();
    // If user selects â€œALL / NE Atlanticâ€, attach bbox from existing BOUNDARIES
    if (pl.country_code === 'ALL' && !pl.area && !pl.bbox) {
      const bb = getNEAtlanticBBox();
      if (bb) {
        console.log('[NEA bbox] Found NE Atlantic bbox:', bb);
        pl.bbox = bb;
        pl.context = 'continent'; // ensures correct framing on map
      } else {
        console.warn('[NEA bbox] âš ï¸ No NE Atlantic bbox found in BOUNDARIES');
      }
    }
    pendingNav = pl;
    if (mapLoaded) {
        try {
        if (mapStatus) mapStatus.textContent = 'sendingâ€¦';
        wrapMap.classList.add('ready');
        console.log('[mobileâ†’map] SEND (immediate) navGo', pl);
        iframe.contentWindow.postMessage({ type: 'navGo', payload: pl }, '*');
        if (mapStatus) mapStatus.textContent = 'sent âœ“';    // ðŸ‘ˆ confirm send
        } catch (e) {
        console.warn('[mobileâ†’map] postMessage failed', e);
        if (mapStatus) mapStatus.textContent = 'send failed';
        }
        pendingNav = null;
    } else {
        console.log('[mobileâ†’map] queued (mapLoaded=false)', pl);
    }
    }
    function rerenderTideForCurrentDay() {
        if (!window.TideMobile) return;

        // update chips first
        TideMobile.setMoonPhaseChip(CURRENT_OFFSET);
        TideMobile.setTidePrefChip(window.LAST_TIDE_PREF || null);

        // render chart if we know which station to use
        if (!LAST_TIDE_PORT) return;
        window.TideMobile.renderTideForDay(
            TideMobile.dayISO(CURRENT_OFFSET),
            {
            showNow: (CURRENT_OFFSET === 0),
            tidePref: window.LAST_TIDE_PREF || null,
            station: LAST_TIDE_PORT
            }
        );
    }

    // One persistent listener for ALL messages from the map
    window.addEventListener('message', (ev) => {
      const msg = ev.data || {};
      if (!msg || !msg.type) return;

      // --- mapReady â†’ first-time wiring for this map instance ---
      if (msg.type === 'mapReady') {
        mapLoaded = true;

        if (mapStatus) {
          mapStatus.textContent = 'ready';
        }

        // Keep the map's wave filter in sync immediately
        try { applyFilterToMap(); } catch (_) {}

        // Make sure the mobile date label matches CURRENT_OFFSET
        try { setMobileDate(CURRENT_OFFSET); } catch (_) {}

        // Kick off the first navGo for this map (with a tiny delay for style)
        try { scheduleNavGo(250); } catch (_) {}

        // And ensure spots for the current day are loaded once
        try { window.fetchSpotsForCurrentDay?.(); } catch (_) {}

        return;
      }


      if (msg.type === 'mapZoomOut') {
        try {
          // Current logical region (codes, not labels)
          const reg = window.REGION || { country: 'ALL', area: 'ALL' };
          let country = (reg.country || 'ALL').toUpperCase();
          let area    = reg.area || 'ALL';

          // Hierarchy:
          //   AREA â†’ COUNTRY
          //   COUNTRY â†’ ALL
          if (area && area !== 'ALL') {
            // At area level: go up to country
            area = 'ALL';
          } else if (country && country !== 'ALL') {
            // At country level: go up to "ALL"
            country = 'ALL';
          } else {
            // Already at the top â€“ nothing to do (or you could pick a world/NEA view)
            return;
          }

          // Use your canonical path: setRegion drives bus + map + dropdowns
          if (typeof window.setRegion === 'function') {
            window.setRegion({
              country,
              area,
              from: 'mapZoomOut',
            });
          } else {
            // Fallback: talk directly to the map iframe
            const payload = {
              country: country === 'ALL' ? null : country,
              area:    area    === 'ALL' ? null : area,
              cont:    null,
            };
            document
              .getElementById('mob-map')
              ?.contentWindow
              ?.postMessage({ type: 'navGo', payload }, '*');
          }
        } catch (e) {
          console.warn('[mobile] mapZoomOut handler failed', e);
        }
        return;
      }




      // --- navGo with offset (map changed day) ---
      if (msg.type === 'navGo' && typeof msg.offset !== 'undefined') {
        try {
          CURRENT_OFFSET = Number(msg.offset) || 0;
        } catch (_) {}

        try { setMobileDate(CURRENT_OFFSET); } catch (_) {}
        try { window.fetchSpotsForCurrentDay?.(); } catch (_) {}

        return;
      }

      // --- Hover-card updates ---
      const payload = msg.payload || msg.detail || msg.data || null;

      if (msg.type === 'spotHover' && payload) {
        UI.openHover(payload);
        return;
      }

      if (msg.type === 'spotUnhover') {
        hideHoverCard();
        return;
      }

      // --- Click-ish events ---
      const CLICK_TYPES = new Set([
        'spotClick',
        'spotSelect',
        'spotFocus',
        'spotChosen',
        'spotLock'
      ]);

      const clicked =
        CLICK_TYPES.has(msg.type) ||
        msg.clicked === true ||
        (payload && (payload.clicked || payload.lock || payload.select)) ||
        (msg.action === 'click');

      if (clicked && payload) {
        UI.closeWS(); // always hard-close first (no condition)

        wrapMap.classList.remove('hidden');
        if (mapStatus) {
          mapStatus.textContent = payload.name || payload.id || 'spot selected';
        }
        UI.openHover(payload);

        try {
          wrapMap.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } catch (e) {}
      }
    });

    // Handle explicit reset from the map (e.g., double-click inside map iframe)
    window.addEventListener('message', (ev) => {
      const msg = ev.data || {};
      if (msg.type !== 'mapResetNEA') return;

      // Make sure the map iframe is visible/loaded
      ensureMapLoaded();

      // Try to use our existing NE Atlantic bbox from BOUNDARIES
      const bb = getNEAtlanticBBox();

      // Build a direct navGo payload â€” we donâ€™t need to touch the dropdowns here
      const pl = {
        country: null,
        area: null,
        cont: 'eu',             // helps the map choose framing if bbox is missing
        bbox: bb || undefined,  // prefer real NEA bbox if we found it
        context: 'continent'
      };

      // Send immediately if the map has fired mapReady; else queue it
      if (mapLoaded) {
        try { iframe.contentWindow.postMessage({ type: 'navGo', payload: pl }, '*'); }
        catch (e) { console.warn('[mobileâ†’map] reset send failed', e); }
      } else {
        // Reuse the same queueing approach used elsewhere
        pendingNav = pl;
      }
    });



    window.addEventListener('message', (ev) => {
      const msg = ev.data || {};
      if (msg.type !== 'navSync') return;
      const p = msg.payload || {};

      if (p.country_code) {
        const cc = String(p.country_code).toUpperCase();
        if (elCountry.value !== cc) {
          elCountry.value = cc;
          populateAreas(cc);
          elArea.value = '';      // default to â€œAllâ€ when country changes via map
          elArea.disabled = false;
        }
      }

      if (typeof p.area === 'string') {
        const want = p.area;
        const exists = Array.from(elArea.options).some(o => o.value === want);
        if (exists) elArea.value = want;
      }


      // Use canonical setter so window.REGION stays as codes for filtering
      const cc   = (elCountry?.value || 'ALL').toUpperCase();
      const area = (elArea?.value || 'ALL');
      window.setRegion({ country: cc, area, from: 'map' });

    });


  // Country/Area changes: load/show map and send nav immediately
  elCountry.addEventListener('change', () => {

    if (window.__settingDropdowns) {
      console.debug('[mobile UI] country change ignored (programmatic)');
      return;
    }

    console.log('[mobile UI] country change â†’', elCountry.value);

    // Normalise to an upper-case country code; blank => 'ALL'
    const cc = ((elCountry.value || '').toUpperCase()) || 'ALL';

    // Rebuild areas for the chosen country and reset to "ALL"
    if (cc !== 'ALL') {
      populateAreas(cc);
      elArea.value = '';          // '' = ALL in your UI
      elArea.disabled = false;
    } else {
      elArea.innerHTML = '';
      elArea.disabled  = true;
    }

    ensureMapLoaded();

    // Preserve your existing map title behaviour
    const cText = elCountry.value
      ? elCountry.options[elCountry.selectedIndex].text
      : '';
    if (mapTitle) {
      mapTitle.textContent = `Map${cText ? `: ${cText}` : ''}${elArea.value ? ` â€” ${elArea.value}` : ''}`;
    }

    // NEW: keep REGION + donut in sync
    if (window.setRegion) window.setRegion({ country: cc, area: 'ALL', from: 'dropdown-country' });


    // Push to map immediately
    sendNavGoNowOrQueue();
  });

  elArea.addEventListener('change', () => {

   if (window.__settingDropdowns) {
      console.debug('[mobile UI] area change ignored (programmatic)');
      return;
    } 

    console.log('[mobile UI] area change â†’', elArea.value);

    ensureMapLoaded();

    // Preserve your existing map title behaviour
    const cText = elCountry.value
      ? elCountry.options[elCountry.selectedIndex].text
      : '';
    if (mapTitle) {
      mapTitle.textContent = `Map${cText ? `: ${cText}` : ''}${elArea.value ? ` â€” ${elArea.value}` : ''}`;
    }

    // Normalise region and sync donut
    const cc   = ((elCountry.value || '').toUpperCase()) || 'ALL';
    const area = (elArea.value || 'ALL');
    if (window.setRegion) window.setRegion({ country: cc, area, from: 'dropdown-area' });


    // Push to map immediately
    sendNavGoNowOrQueue();
  });

  // Close button (if present)
  if (btnClose) btnClose.addEventListener('click', () => wrapMap.classList.add('hidden'));

    document.addEventListener('DOMContentLoaded', () => {
    // 1) Initialise the tide module (IDs match your DOM)
    if (window.TideMobile && typeof TideMobile.init === 'function') {
        TideMobile.init({
        svgId: 'tide-svg',
        labels: {
            port:  'tide-port-name',
            date:  'tide-date',
            highs: 'tide-highs',
            lows:  'tide-lows',
            moon:  'tide-moon'
        },
        chips: {
            tidePrefId: 'hcTidePref',
            moonId:     'hcMoon'
        }
        });
    }

    // 2) Initialise day chip to â€œtodayâ€
    setMobileDate(0);

    // 3) Hook up the day toggle (Today â†’ Tomorrow â†’ Day 3)
    const dateBtn = document.getElementById('mob-date');
    dateBtn?.addEventListener('click', () => {
        CURRENT_OFFSET = (CURRENT_OFFSET + 1) % 3;
        window.CURRENT_OFFSET = CURRENT_OFFSET;
        switchDay(CURRENT_OFFSET);
        rerenderTideForCurrentDay(); // re-draw tide for new day (uses LAST_TIDE_PORT if set)
    });

    // 4) If a spot was already selected (rare on first load), render tides now
    rerenderTideForCurrentDay();
    });




  // === Units / dial helpers ==================================
  function toMPH(ms)      { return Math.round((Number(ms) || 0) * 2.236936); }
  function toFaceFeet(m)  { return Math.round(((Number(m) || 0) * 3.28084) / 1.5); }
  function normDegMobile(d){
    const n = Number(String(d).replace(/[^\d.-]/g, ''));
    return Number.isFinite(n) ? ((n % 360) + 360) % 360 : null;
  }

  function placeChevron(id, deg, radius) {
    const g = document.getElementById(id);
    const a = normDegMobile(deg);
    if (!g) return;
    if (a == null) { g.setAttribute('display', 'none'); return; }
    g.removeAttribute('display');
    g.setAttribute('transform', `rotate(${a}) translate(0,-${radius}) rotate(180)`);
  }

    function pickStationFromPayload(p){
        // Prefer the human tide_port (e.g. "North Shields")
        if (p && p.tide_port) return String(p.tide_port).trim();
        if (p && p.tide_port_code) return String(p.tide_port_code).trim();
        return null;
    }

  

    function showHoverCard(p){
    if (window.UI?.state === 'WS') closeWaveSelectorSync();  // hard close if open
    mountHoverCard();
    const card     = document.getElementById('hoverCard');
    const faceNum  = document.getElementById('hcFaceNum');
    const faceUnit = document.getElementById('hcFaceUnit');
    if (!card || !hcWind || !hcPeriod || !faceNum || !faceUnit) return;

    // --- numbers for dial
    const windMPH = toMPH(p.wind_speed);
    const periodS = Math.round(Number(p.swell_period)||0);
    const faceFt  = toFaceFeet(p.swell_height);

    setChipText('hcWind',   'hcWindText',   `Wind ${Number.isFinite(windMPH)?windMPH:'â€“'} mph`);
    setChipChevron('chipWind', p.wind_dir);          // no-op if icon not present

    setChipText('hcPeriod', 'hcPeriodText', `Period ${Number.isFinite(periodS)?periodS:'â€“'} s`);
    setChipChevron('chipSwell', p.swell_dir);        // no-op if icon not present


    // --- station + iso
    const humanStation = (p.tide_port || p.tide_port_code) || null;
    const iso = TideMobile.dayISO(CURRENT_OFFSET);

    // Resolve the key once; if resolve fails, fall back to human name
    const stationKey = humanStation
        ? (TideMobile.resolveStation(humanStation, iso) || humanStation)
        : null;

    // Remember last selections for day switching etc.
    window.LAST_TIDE_PORT = humanStation || window.LAST_TIDE_PORT || null;
    window.LAST_TIDE_PREF = p.tide_pref || null;

    // ---- Render tide ONCE
    if (stationKey) {
        TideMobile.renderTideForDay(iso, {
        showNow: CURRENT_OFFSET === 0,
        tidePref: window.LAST_TIDE_PREF,
        station: stationKey
        });

        // keep the svg stretching edge-to-edge
        const svg = document.getElementById('tide-svg');
        if (svg) svg.setAttribute('preserveAspectRatio', 'none');

        // chips tied to tides
        TideMobile.setTidePrefChip(window.LAST_TIDE_PREF);
        TideMobile.setMoonPhaseChip(CURRENT_OFFSET);
    }

    // ---- HUD (chips left + dial)

    faceNum.textContent  = Number.isFinite(faceFt) ? String(faceFt) : 'â€“';

    requestAnimationFrame(() => {
        if (faceNum.textContent === 'â€“') {
        faceUnit.textContent = '';
        } else {
        faceUnit.textContent = 'ft';
        const bb = faceNum.getBBox();
        faceUnit.setAttribute('x', bb.x + bb.width + 6);
        faceUnit.setAttribute('y', bb.y + bb.height / 2);
        }
    });

    placeChevron('hcWindArrow',  p.wind_dir,  70);
    placeChevron('hcSwellArrow', p.swell_dir, 80);

    const col = String(p.colour||'').toLowerCase();
    card.style.borderColor = col==='green' ? '#1f7a3d'
                        :  col==='amber' ? '#7a6b1f'
                        :  col==='red'   ? '#7a1f2a'
                        :  '#2a2f36';

    // Make it participate in layout, then trigger the slide-up transition
    showCardClean();
    card.setAttribute('aria-hidden','false');
    // Force a reflow so the class change transitions (Safari/iOS quirk)
    // eslint-disable-next-line no-unused-expressions
    card.offsetHeight; 
    card.classList.add('is-open');

    // After layout settles, autosize the chips to avoid unnecessary ellipses
    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
        window.autoSizeChips?.(card);
        });
    });
    }
    function showCard(el){
    if (!el) return;
    el.style.display = 'block';
    el.setAttribute('aria-hidden','false');
    void el.offsetHeight;             // force reflow so transition fires
    el.classList.add('is-open');
    }

    function hideCard(el){
    if (!el) return;
    el.classList.remove('is-open');
    const done = () => {
        el.style.display = 'none';
        el.setAttribute('aria-hidden','true');
        el.removeEventListener('transitionend', done);
    };
    el.addEventListener('transitionend', done, { once:true });
    // fallback timeout in case transition doesn't fire
    setTimeout(done, 260);
    }



    function debugCard(){
    const c = document.getElementById('hoverCard');
    const cs = getComputedStyle(c);
    const r = c.getBoundingClientRect();
    console.log('[hoverCard]',
        {display: cs.display, position: cs.position, zIndex: cs.zIndex,
        transform: cs.transform, bottom: cs.bottom, left: cs.left, right: cs.right,
        rect: {x:r.x, y:r.y, w:r.width, h:r.height}});
    }





    function renderTideForPort(portName) {
        if (!portName || !window.TideMobile) return;
        try {
            window.TideMobile.renderForPort(portName, CURRENT_OFFSET);
        } catch (e) {
            console.warn('[mobile] tide render failed for', portName, e);
        }
    }


    // === Dropdown population ===================================

/** Build a short label for long place names without hardcoding each country. */
function makeShortLabel(name){
  const orig = (name || '').trim();
  if (!orig) return '';

  // 0) Exact/specific exceptions first
  const specials = [
    [/^\s*United\s+Kingdom\s*$/i, 'UK'],
    [/^\s*United\s+States(\s+of\s+America)?\s*$/i, 'USA'],
    [/^\s*United\s+Arab\s+Emirates\s*$/i, 'UAE'],


    // Ireland-specific area overrides
    [/^\s*County\s+Clare\s*$/i, 'Clare'],
    [/^\s*County\s+Sligo\s*$/i, 'Sligo'],
    [/^\s*Dingle\s+Peninsula\s*$/i, 'Dingle'],


    [/^\s*(?:The\s+)?Netherlands\s*$/i, 'ND'],

    [/^\s*The\s+(North|South|East|West)\s*$/i, (_, dir) => dir], // "The North" -> "North"
  ];
  for (const [re, out] of specials){
    const m = orig.match(re);
    if (m) return (typeof out === 'function') ? out(...m) : out;
  }

  let s = orig;

  // 1) Compound cardinals at the start â†’ â€œNW/NE/SE/SW â€¦â€
  //    Handles "Northwest", "North-West", "North West", etc.
  s = s.replace(/^\s*(North|South|East|West)[-\s]*(East|West)\b/i,
    (_, a, b) => (a[0] + b[0]).toUpperCase() + s.slice(RegExp.lastMatch.length));

  // 2) Generic token replacements (order matters)
  s = (' ' + s + ' ')
    .replace(/\bDemocratic Republic of\b/gi, 'DR of')
    .replace(/\bRepublic of\b/gi, 'Rep. of')
    .replace(/\bIslands?\b/gi, 'Is.')
    .replace(/\b and \b/gi, ' & ')
    .replace(/^\s*The\s+/i, '') // drop leading "The "
    .trim();

  // 3) Standalone cardinal words INSIDE longer names â†’ initials
  //    e.g., "North Yorkshire Coast" -> "N Yorkshire Coast"
  //    (do NOT abbreviate if the whole name is just "North")
  if (/\s/.test(s)) {
    s = s
      .replace(/\bNorthern\b/gi, 'N')
      .replace(/\bSouthern\b/gi, 'S')
      .replace(/\bEastern\b/gi,  'E')
      .replace(/\bWestern\b/gi,  'W')
      .replace(/\b(North|South|East|West)\b/gi, (m) => m[0].toUpperCase());
  }

  // 4) If still long, compress leading words (keep last word readable)
  if (s.length > 14) {
    const parts = s.split(/\s+/);
    if (parts.length >= 2) {
      const last = parts.pop();
      const firsts = parts.map(w => (w.length > 3 ? (w[0] + '.') : w)); // â€œN.â€ â€œGer.â€
      s = [...firsts, last].join(' ');
    }
  }

  // 5) Avoid single-letter outcomes; promote to full cardinal if that happened
  if (/^[NSEW]$/.test(s)) {
    // Use the original to expand correctly
    const map = { N:'North', S:'South', E:'East', W:'West' };
    return map[s] || s;
  }

  // 6) Last-ditch clamp if still very long
  if (s.length > 16) {
    const parts = s.split(/\s+/);
    const last = parts.pop();
    const shortLast = last.length > 6 ? last.slice(0, 6) + 'â€¦' : last;
    s = [...parts, shortLast].join(' ');
  }

  return s;
}
/** Replace the option text in a select with full or short labels. */
function setSelectLabelMode(select, mode){
  if (!select) return;
  for (const opt of select.options) {
    const full  = opt.getAttribute('data-full');
    const short = opt.getAttribute('data-short');
    if (!full || !short) continue;
    opt.textContent = (mode === 'full') ? full : short;
  }
}

/** Attach behaviour: short while closed; full when opening; back to short after. */
function attachAbbrevBehaviour(select){
  if (!select) return;

  // Before the native menu opens
  const toFull = () => setSelectLabelMode(select, 'full');
  select.addEventListener('mousedown', toFull, { passive: true });
  select.addEventListener('pointerdown', toFull, { passive: true });
  select.addEventListener('focus', toFull, { passive: true });

  // After selection / close, switch back to short
  const toShort = () => setSelectLabelMode(select, 'short');
  select.addEventListener('change', toShort);
  select.addEventListener('blur', toShort);
}

/** Populate helpers (rewrite yours to stash full+short on each option) */
function populateCountries() {
  const bc = (window.BOUNDARIES && window.BOUNDARIES.by_country) || {};
  const list = Object.values(bc).sort((a,b)=> (a.country_name||'').localeCompare(b.country_name||''));

  const frag = document.createDocumentFragment();
  const opt0 = document.createElement('option');
  opt0.value = '';
  opt0.textContent = 'Countryâ€¦';
  opt0.setAttribute('data-full',  'Countryâ€¦');
  opt0.setAttribute('data-short', 'Countryâ€¦');
  frag.appendChild(opt0);

  for (const r of list) {
    const code = String(r.country_code || '').toUpperCase();
    const full = r.country_name || code || '';
    const short = makeShortLabel(full);

    const opt = document.createElement('option');
    opt.value = code;
    opt.textContent = short;                // show short by default (closed state)
    opt.setAttribute('data-full',  full);   // keep full for the open menu
    opt.setAttribute('data-short', short);
    frag.appendChild(opt);
  }

  elCountry.innerHTML = '';
  elCountry.appendChild(frag);
  elCountry.disabled = list.length === 0;

  // Ensure behaviour is attached
  attachAbbrevBehaviour(elCountry);
  // Make sure we start in "short" mode
  setSelectLabelMode(elCountry, 'short');
}

function populateAreas(cc) {
  const ba = (window.BOUNDARIES && window.BOUNDARIES.by_area) || {};
  const rows = Object.values(ba).filter(r => String(r.country_code||'').toUpperCase() === cc);
  rows.sort((a,b) => (a.area||'').localeCompare(b.area||''));

  const frag = document.createDocumentFragment();
  const opt0 = document.createElement('option');
  opt0.value = '';
  opt0.textContent = 'All Areas';
  opt0.setAttribute('data-full',  'All Areas');
  opt0.setAttribute('data-short', 'All Areas');
  frag.appendChild(opt0);

  for (const r of rows) {
    const full  = r.area || '';
    const short = makeShortLabel(full);
    const opt = document.createElement('option');
    opt.value = r.area || '';
    opt.textContent = short;
    opt.setAttribute('data-full',  full);
    opt.setAttribute('data-short', short);
    frag.appendChild(opt);
  }

  elArea.innerHTML = '';
  elArea.appendChild(frag);
  elArea.disabled = false;

  attachAbbrevBehaviour(elArea);
  setSelectLabelMode(elArea, 'short');
}




// ===================== DISPLAY LABELS SAFETY (removable) =====================
// Goal: keep data canonical (full names) while rendering short labels in <select>.
// - When READING a select, return its canonical full name (from data-full).
// - When SETTING a select from events, match by data-full (not the short text).

function canonicalSelectValue(sel){
  const opt = sel?.selectedOptions?.[0];
  if (!opt) return 'ALL';
  return opt.getAttribute('data-full') || opt.value || 'ALL';
}

function setSelectByFull(select, full){
  if (!select) return;
  for (const opt of select.options){
    const canon = opt.getAttribute('data-full') || opt.value;
    if (canon === full){
      select.value = opt.value;          // select via its actual option value
      // keep short labels for the closed state
      if (typeof setSelectLabelMode === 'function') setSelectLabelMode(select, 'short');
      return;
    }
  }
}
// ============================================================================ 







    function currentPayload() {
        const cc      = (elCountry.value || '').toUpperCase();
        const areaVal = elArea.value;
        // Use null to mean â€œAllâ€ so the map can widen the bbox properly
        const area = areaVal ? areaVal : null;

        const pl = { country: cc || null, area, cont: null };
        console.debug('[mobile] navGo payload:', pl);
        return pl;
    }

  // Wait for BOUNDARIES to exist, then populate dropdowns
  async function waitForBoundaries(maxMs = 3000, stepMs = 100) {
    const t0 = performance.now();
    while (performance.now() - t0 < maxMs) {
      const bc = (window.BOUNDARIES && window.BOUNDARIES.by_country) || {};
      if (Object.keys(bc).length) return true;
      await new Promise(r => setTimeout(r, stepMs));
    }
    return false;
  }

  waitForBoundaries().then(() => {
    try { populateCountries(); }
    catch (e) { console.warn('BOUNDARIES not available', e); }
  });

})(); // end IIFE
</script>

<script>
  // iOS: don't restore old scroll positions
  if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
  }

  // Make sure the drawer is hidden at boot
  (function ensureDrawerHidden(){
    var hc = document.getElementById('hoverCard');
    if (hc) hc.style.display = 'none';
  })();

  // Always start at the very top (covers normal load, BFCache restore, and visibility changes)
  function jumpToTopSoon() {
    // two ticks: after layout & after any late style/script changes
    requestAnimationFrame(() => {
      window.scrollTo(0, 0);
      setTimeout(() => window.scrollTo(0, 0), 0);
    });
  }
  window.addEventListener('load', jumpToTopSoon, { once:true });

    // Existing behaviour
  window.addEventListener('pageshow', (e) => {
    if (e.persisted) jumpToTopSoon();
    // ðŸ§­ keep dropdowns in sync if user returns via back/forward cache
    setUIFromRegion?.();
  });

  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
      jumpToTopSoon();
      // ðŸ§­ also resync dropdowns when tab becomes visible again
      setUIFromRegion?.();
    }
  });

function showCardClean(){
  const card = document.getElementById('hoverCard');
  if (!card) return;

  // scrub stale inline styles from previous attempts
  card.style.cssText = '';  // clears old inline bottom/transform/etc.
  card.setAttribute('aria-hidden','false');
  card.scrollTop = 0;

  // show + animate via class only
  card.style.display = 'block';
  void card.offsetHeight;   // kick transition
  card.classList.add('is-open');
}

function hideHoverCard(){
  const card = document.getElementById('hoverCard');
  if (!card) return;
  card.classList.remove('is-open');
  const done = () => { card.style.display = 'none'; card.removeEventListener('transitionend', done); };
  card.addEventListener('transitionend', done, { once:true });
  setTimeout(done, 240); // safety
}

</script>
<script>
(function(){
  // Update --header-h so the map can fill the remaining viewport height
  function setHeaderHeightVar(){
    const hdr = document.querySelector('.mbar');
    const h = hdr ? hdr.getBoundingClientRect().height : 56;
    document.documentElement.style.setProperty('--header-h', `${Math.round(h)}px`);
  }

  // on load + when header changes size (wraps, fonts, orientation)
  window.addEventListener('load', setHeaderHeightVar, { once:true });
  window.addEventListener('resize', setHeaderHeightVar);
  // React to content/layout changes in the header
  const ro = new ResizeObserver(setHeaderHeightVar);
  const hdr = document.querySelector('.mbar');
  if (hdr) ro.observe(hdr);
})();
</script>
<script>
(function(){
  const header = document.querySelector('.mbar');
  if (!header) return;
  const apply = () =>
    document.documentElement.style.setProperty('--mbar-h', header.offsetHeight + 'px');
  // set once and keep it fresh on resize/zoom/address-bar moves
  apply();
  new ResizeObserver(apply).observe(header);
  window.addEventListener('resize', apply);
})();
</script>
<!-- Wave Selector (own sheet) -->
<div id="wsCard" aria-hidden="true" style="display:none">
  <div id="wave-selector" class="ws-two-col">
    <div id="ws-left" class="ws-left"></div>  <!-- column 1: controls (sliders etc.) -->

    <!-- column 2: donut + legend (legend div stays outside the SVG) -->
    <div id="donut-col">
      <div id="sunburst-mount"></div>
      <div id="sunburst-legend"></div>
    </div>

    <!-- Set chip sits under the LEFT column -->
    <div id="ws-set-slot"></div>
  </div>
</div>
<div id="hc-root" style="position:fixed;inset:0;pointer-events:none;z-index:9999"></div>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<!-- === Initialise the Sunburst Prototype (robust loader) === -->
<!-- === Prepare Sunburst init (call only when drawer opens) === -->
<script type="module">
  let LATEST_SPOT_ROWS = null;

  // We now rely solely on the global loaded by the classic script tag.
  // No import() here to avoid double-evaluating the bundle.
  let fn = window.renderSunburstPrototype || window.PrototypeSunburst?.render || null;

  const safeSizeDonut = () => {
    if (typeof window.sizeDonut === 'function') {
      try { window.sizeDonut(); } catch (e) { console.warn('[sunburst] sizeDonut failed', e); }
    }
  };
  const safeNarrowMode = () => {
    if (typeof window.applySunburstNarrowMode === 'function') {
      try { window.applySunburstNarrowMode(); } catch (e) { console.warn('[sunburst] narrowMode failed', e); }
    }
  };

  // === GLOBAL REGION STATE (single source of truth) ==========================
  // Build area -> country_code lookup globally
  window.AREA_TO_CC = (() => {
    const out = {};
    const ba = (window.BOUNDARIES && window.BOUNDARIES.by_area) || {};
    Object.values(ba).forEach(r => {
      const area = String(r.area || '');
      const cc   = String(r.country_code || '').toUpperCase();
      if (area) out[area] = cc;
    });
    return out;
  })();  // âœ… closes function and immediately invokes it

  // Build country_code -> country_name lookup globally
  window.CC_TO_NAME = (() => {
    const out = {};
    const bc = (window.BOUNDARIES && window.BOUNDARIES.by_country) || {};
    Object.values(bc).forEach(r => {
      const cc   = String(r.country_code || '').toUpperCase();
      const name = String(r.country_name || '');
      if (cc && name) out[cc] = name;
    });
    return out;
  })();  // âœ… closes function and invokes

  // Build name -> code lookup globally
  window.NAME_TO_CC = (() => {
    const m = {};
    for (const [cc, nm] of Object.entries(window.CC_TO_NAME || {})) {
      if (nm) m[String(nm).trim().toLowerCase()] = cc;
    }
    m.uk = 'GB';
    m.gb = 'GB';
    return m;
  })();  // âœ… closes and invokes



  // Canonical helper: derive user-facing labels for the current REGION
  function getRegionDisplayLabels(source) {
    const reg = source || window.REGION || { country: 'ALL', area: 'ALL' };
    const codeU = String(reg.country || 'ALL').toUpperCase();

    // Start from your master mapping: GB -> "United Kingdom", SCT -> "Scotland", CYM -> "Wales", etc.
    const baseName = (window.CC_TO_NAME && window.CC_TO_NAME[codeU]) || codeU;

    // Then pass through your existing normaliser, which also knows about any
    // â€œmacro groupingsâ€ and short labels for tight layouts.
    const displayCountry =
      (typeof window.normaliseCountry === 'function')
        ? window.normaliseCountry(baseName)
        : baseName;

    const areaLabel = reg.area || 'ALL';

    return { countryLabel: displayCountry, areaLabel };
  }


  // Resolve any area-like input (label or code) into { areaCode, areaLabel }
  function resolveAreaFromAny(areaLike, countryLike) {
    const raw = String(areaLike || 'ALL').trim();
    if (!raw || raw === 'ALL') {
      return { areaCode: 'ALL', area: 'ALL' };
    }

    const cc = (window.resolveCC
      ? window.resolveCC(countryLike)
      : String(countryLike || 'ALL').toUpperCase()
    );

    const byArea = (window.BOUNDARIES && window.BOUNDARIES.by_area) || {};

    // 1) If raw matches an area_code key directly (e.g. "GB-01" / "gb-01")
    const key = raw.toLowerCase();
    const viaKey = byArea[key];
    if (viaKey && (!cc || cc === 'ALL' || String(viaKey.country_code || '').toUpperCase() === cc)) {
      return {
        areaCode: viaKey.area_code || raw.toUpperCase(),
        area: viaKey.area || raw,
      };
    }

    // 2) Otherwise, search by area LABEL within the country
    const rawLc = raw.toLowerCase();
    for (const r of Object.values(byArea)) {
      const label = String(r.area || '').trim();
      if (!label) continue;

      const labelLc = label.toLowerCase();
      const rCode   = String(r.country_code || '').toUpperCase();

      if (labelLc === rawLc && (!cc || cc === 'ALL' || rCode === cc)) {
        return {
          areaCode: r.area_code || raw.toUpperCase(),
          area: label,
        };
      }
    }

    // 3) Fallback (unknown area): keep whatever we got
    return {
      areaCode: raw.toUpperCase(),
      area: raw,
    };
  }


  /**
   * setRegion: updates global state, syncs dropdowns, notifies listeners.
   * - REGION.country  = COUNTRY CODE (e.g. "GB", "FR", "PT")
   * - REGION.area     = canonical AREA NAME (e.g. "Cornwall")
   * - REGION.areaCode = canonical AREA CODE (e.g. "GB-01")
   */
  function setRegion(next = {}) {
    const prev = window.REGION || { country: 'ALL', area: 'ALL', areaCode: 'ALL' };
    const from = next.from || 'code';

    // 1) Canonical COUNTRY CODE in window.REGION
    const cc = (window.resolveCC
      ? window.resolveCC(next.country ?? prev.country ?? 'ALL')
      : String(next.country ?? prev.country ?? 'ALL').toUpperCase()
    );

    // 2) Resolve area (label or code) into a canonical pair
    const areaLike = next.area ?? prev.area ?? prev.areaCode ?? 'ALL';
    const resolved = resolveAreaFromAny(areaLike, cc);
    const areaCode = resolved.areaCode || 'ALL';
    const areaLabel = resolved.area || 'ALL';

    // 3) Store canonical REGION (code + label + code)
    window.REGION = {
      country: cc,
      area: areaLabel,
      areaCode: areaCode,
    };

    const codeU = String(cc || 'ALL').toUpperCase();
    const displayCountry =
      codeU === 'ALL'
        ? 'ALL'
        : (window.CC_TO_NAME && window.CC_TO_NAME[codeU]) || codeU;

    console.debug('[setRegion]', { from, REGION: window.REGION });

    // 4) Sync the mobile dropdowns (but donâ€™t re-fire their change handlers)
    try {
      if (typeof window.syncSelects === 'function') {
        // syncSelects currently expects "display country name" + "area LABEL"
        window.syncSelects(displayCountry, areaLabel);
      }
    } catch (err) {
      console.warn('[setRegion] syncSelects failed', err);
    }

    // 5) Drive the map, unless the MAP itself initiated this
    if (from !== 'map') {
      try {
        if (typeof sendToMap === 'function') {
          console.debug('[setRegionâ†’map]', { codeU, areaLabel });
          // NOTE: for now we keep sending the LABEL to the map to avoid breaking it
          sendToMap(codeU, areaLabel);
        } else if (typeof iframe !== 'undefined' && iframe && iframe.contentWindow) {
          const payload = {
            country: codeU === 'ALL' ? null : codeU,
            area: areaLabel === 'ALL' ? null : areaLabel,
            cont: null,
          };
          iframe.contentWindow.postMessage({ type: 'navGo', payload }, '*');
        }
      } catch (err) {
        console.warn('[setRegion] map nav failed', err);
      }
    }

    // 6) Refresh donut data *unless* the sunburst is already applying it
    if (from !== 'sunburst' && from !== 'sunburst-applied') {
      try {
        if (typeof window.fetchSpotsForCurrentDay === 'function') {
          window.fetchSpotsForCurrentDay();
        }
      } catch (err) {
        console.warn('[setRegion] fetchSpotsForCurrentDay failed', err);
      }
    }

    // 7) Any other UI bits (titles, chips, etc.)
    try {
      if (typeof window.setUIFromRegion === 'function') {
        window.setUIFromRegion();
      }
    } catch (err) {
      console.warn('[setRegion] setUIFromRegion failed', err);
    }

    // 8) Finally, notify the bus so any *other* listeners can react
    try {
      if (window.bus && typeof bus.emit === 'function') {
        const reg = window.REGION || { country: 'ALL', area: 'ALL', areaCode: 'ALL' };

        bus.emit('regionChange', {
          country:     displayCountry,  // pretty name
          area:        reg.area,        // label
          countryCode: reg.country,     // canonical country code
          areaCode:    reg.areaCode,    // canonical area code
          from,
        });
      }
    } catch (err) {
      console.warn('[setRegion] bus emit failed', err);
    }
  }
  window.setRegion = setRegion;


  // Map CURRENT_OFFSET (0/1/â€¦) -> file index (1/2/â€¦)
  function dayFileIndexFromOffset(off) {
    const o = Number(off) || 0;       // 0, 1, 2 ...
    // clamp to 0..2 just in case
    return Math.max(0, Math.min(2, o));
  }

  // Fetch rows for current day and re-render

  function forceDonutSubtitleLabel() {
    try {
      const root = document.getElementById('sunburst-mount');
      if (!root) return;

      const reg = window.REGION || { country: 'ALL', area: 'ALL' };

      // Country code â†’ human name (fallback to code)
      const bc = (window.BOUNDARIES && window.BOUNDARIES.by_country) || {};
      const cc = String(reg.country || 'ALL').toUpperCase();
      const humanCountry =
        cc === 'ALL' ? 'NE Atlantic' :
        (Object.values(bc).find(r => String(r.country_code).toUpperCase() === cc)?.country_name || cc);

      const place = (reg.area && reg.area !== 'ALL') ? reg.area : humanCountry;
      const text  = `Spots Working â€¢ ${place}`;

      // Try common selectors firstâ€¦
      let node =
        root.querySelector('.donut-subtitle, .sb-center-subtitle, text.sb-subtitle');




  // Single bootstrap for fetch wiring
  (function () {
    if (window.__sunburstFetchWired) return;
    window.__sunburstFetchWired = true;

    const run = () => {
      try { window.fetchSpotsForCurrentDay && window.fetchSpotsForCurrentDay(); }
      catch (e) { console.error('[sunburst] initial run failed', e); }
    };

    // (Re)run whenever these fire
    bus.on('dayChange', run);
    bus.on('regionApplied', run);

    // Also run once when DOM is ready (covers initial load)
    if (document.readyState !== 'loading') run();
    else document.addEventListener('DOMContentLoaded', run);
  })();

  // --- Force the donut's centre subtitle to match the current REGION ---
      // â€¦fallback: search any <text> that currently contains â€œSpots Workingâ€
      if (!node) {
        const texts = root.querySelectorAll('text');
        for (const t of texts) {
          if (/Spots\s+Working/i.test(t.textContent || '')) { node = t; break; }
        }
      }

      if (node) node.textContent = text;
    } catch (_) { /* no-op */ }
  }
  // expose so non-module listeners can call it
  window.forceDonutSubtitleLabel = forceDonutSubtitleLabel;
  window.__DONUT_BOOTED__ = window.__DONUT_BOOTED__ || false;
  // Expose callable used by the drawer controller
  window.renderSunburstInWsCard = () => {
    fn = fn || window.renderSunburstPrototype || window.PrototypeSunburst?.render || null;
    if (typeof fn !== 'function') {
      console.error('âŒ No init function found for sunburst.');
      return;
    }

    // Mount only once
    if (!window.__DONUT_BOOTED__) {
      // (keep your existing REGION seeding and filtered rows logic)
      const rows = Array.isArray(LATEST_SPOT_ROWS)
        ? (typeof window.canonicalFilterRowsByRegionImpl === 'function'
            ? window.canonicalFilterRowsByRegionImpl(LATEST_SPOT_ROWS)
            : LATEST_SPOT_ROWS)
        : undefined;

      const opts = { onReady: () => safeSizeDonut(), data: rows };
      try { fn('sunburst-mount', opts); } catch { fn('sunburst-mount'); }
      window.__DONUT_BOOTED__ = true;
      requestAnimationFrame(() => { safeSizeDonut(); safeNarrowMode(); /* subtitle logic stays */ });
      console.log('âœ… Sunburst initialised (single mount)');
      return;
    }

    // Already mounted â†’ just size/label; let fetchâ†’setData handle data
    requestAnimationFrame(() => { safeSizeDonut(); safeNarrowMode(); });
  };
  // --- Donut subtitle: force top-level label ------------------------------
  // --- Donut subtitle: force top-level label ------------------------------
  (function(){
    // Find the subtitle node inside the donut (works across bundle versions)
    function getSubtitleNode(){
      const root = document.getElementById('sunburst-mount');
      if (!root) return null;
      return (
        root.querySelector('.donut-subtitle, .sb-center-subtitle, text.sb-subtitle') ||
        Array.from(root.querySelectorAll('text')).find(t => /Spots\s+Working/i.test(t.textContent||''))
      );
    }

    // If the label is the "overview" one (starts with "Spots Working"), strip the suffix
    function enforceTopLevelSubtitle(){
      const n = getSubtitleNode();
      if (!n) return;
      const txt = (n.textContent || '').trim();
      // Only touch the **overview** label (drill-down labels donâ€™t start like this)
      if (/^Spots\s+Working\b/i.test(txt)) {
        if (txt !== 'Spots Working') n.textContent = 'Spots Working';
      }
    }

    // Keep a mutation observer alive so late bundle updates canâ€™t revert it
    let mo = null;
    function watchSubtitle(){
      const n = getSubtitleNode();
      if (!n) return;
      if (mo) { try{ mo.disconnect(); } catch(_){} mo = null; }
      mo = new MutationObserver(enforceTopLevelSubtitle);
      mo.observe(n, { childList: true, characterData: true, subtree: true });
      enforceTopLevelSubtitle(); // enforce immediately once found
    }

    // 1) After every donut render, (re)attach the watcher
    const _render = window.renderSunburstInWsCard;
    window.renderSunburstInWsCard = function(){
      _render && _render();
      // two RAFs gives the bundle time to paint, then we pin the label
      requestAnimationFrame(() => requestAnimationFrame(watchSubtitle));
    };

    // 2) Also re-enforce on region changes (covers cases where render isnâ€™t called)
    bus.on('regionChange', () => {
      requestAnimationFrame(() => requestAnimationFrame(enforceTopLevelSubtitle));
    });
  })();
    
  
</script>

<!-- Fallback global for the sunburst renderer (in case ESM import fails) -->
<script src="./js/prototype_sunburst.bundle.js" defer></script>

<script>
window.__lastRegionSig = window.__lastRegionSig || null;
function regionSig(c, a) { return (String(c) + '|' + String(a)).toUpperCase(); }
</script>


<script>
(() => {
  const _impl = window.fetchSpotsForCurrentDay;
  if (typeof _impl !== 'function') return;

  let inFlight = null;
  let queued = false;

  async function runOnce() {
    if (inFlight) { queued = true; return inFlight; }
    inFlight = (async () => {
      try { await _impl(); }
      finally {
        const again = queued;
        queued = false;
        inFlight = null;
        if (again) runOnce();
      }
    })();
    return inFlight;
  }

  window.fetchSpotsForCurrentDay = runOnce;
})();
</script>

<script>
// --- 0) Ensure REGION exists
window.REGION = window.REGION || { country: 'ALL', area: 'ALL' };

// --- 1) Region signature to avoid re-entrancy on bus
window.__lastRegionSig = window.__lastRegionSig || null;
function regionSig(c, a) { return (String(c) + '|' + String(a)).toUpperCase(); }

// --- 2) Programmatic-select update helper (no 'change' loop)
window.__squelchSelect = false;
function setSelectSilently(sel, value) {
  if (!sel) return;
  if (sel.value === value) return;
  window.__squelchSelect = true;
  sel.value = value;                 // do NOT dispatch a 'change'
  requestAnimationFrame(() => {      // release flag next tick
    window.__squelchSelect = false;
  });
}

// --- 3) Intercept dropdown 'change' when we are setting them programmatically
['country', 'area'].forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  // capture-phase handler so we stop before your app's listener runs
  el.addEventListener('change', (ev) => {
    if (window.__squelchSelect) {
      ev.stopImmediatePropagation(); // prevent loops
      // do NOT emit bus events when programmatic
      return;
    }
  }, true);
});


</script>

<script>
// --- tiny helper to locate selects even if IDs changed ---
function findCountrySelect() {
  return (
    document.getElementById('mob-country') ||
    document.getElementById('country') ||
    document.querySelector('select[name="country"]') ||
    document.querySelector('#mobile select[id*="country" i]') ||
    document.querySelector('select[id*="country" i]')
  );
}
function findAreaSelect() {
  return (
    document.getElementById('mob-area') ||
    document.getElementById('area') ||
    document.querySelector('select[name="area"]') ||
    document.querySelector('#mobile select[id*="area" i]') ||
    document.querySelector('select[id*="area" i]')
  );
}

// guard flag so programmatic changes don't trigger your handlers
window.__settingDropdowns = false;

// Use CODES for country select; LABEL for area select
window.syncSelects = window.syncSelects || function syncSelects(displayCountryName, areaLabel) {
  try {
    const selC = document.getElementById('mob-country'); // country select uses CODES
    const selA = document.getElementById('mob-area');    // area select uses LABELS

    // âœ… correct variable names in the guard
    if (!selC && !selA) return;

    // Country: resolve whatever we got (name/code) to a CODE (e.g. 'GB', 'SCT', 'ALL')
    const code = (window.resolveCC ? window.resolveCC(displayCountryName) : String(displayCountryName || 'ALL')).trim();

    if (selC) {
      const has = Array.from(selC.options).some(o => String(o.value) === code);
      if (has && selC.value !== code) {
        window.__settingDropdowns = true;
        selC.value = code;
        window.__settingDropdowns = false;
      }
    }

    if (selA) {
      const want = String(areaLabel || 'ALL').trim();
      const has = Array.from(selA.options).some(o => String(o.value) === want);
      if (has && selA.value !== want) {
        window.__settingDropdowns = true;
        selA.value = want;
        window.__settingDropdowns = false;
      }
    }

    // Optional debug
    // console.log('[syncSelects]', {displayCountryName, code, areaLabel, mobCountry: selC?.value, mobArea: selA?.value});
  } catch (e) {
    console.warn('[syncSelects] failed', e);
  }
};
</script>
<script>
window.forceSyncSelects = function(countryNameOrCode, areaLabel) {
  try {
    window.__settingDropdowns = true;
    window.syncSelects(countryNameOrCode, areaLabel);
  } finally {
    window.__settingDropdowns = false;
  }
};
</script>
<script>
  // Call a function once the dropdowns exist AND have options
  window.ensureMobDropdownsReady = function ensureMobDropdownsReady(cb, tries = 0) {
    try {
      const c = document.getElementById('mob-country');
      const a = document.getElementById('mob-area');
      const ok = !!(c && a && c.options && a.options && c.options.length && a.options.length);
      if (ok) return void cb();
      if (tries > 60) return; // ~3s max if called every 50ms
      setTimeout(() => ensureMobDropdownsReady(cb, tries + 1), 50);
    } catch { /* noop */ }
  };

// A safer sync that picks by code OR name (whichever your <option> uses)
  window.syncSelectsSafe = function syncSelectsSafe(displayCountryName, areaLabel) {
    try {
      const cSel = document.getElementById('mob-country');
      const aSel = document.getElementById('mob-area');
      if (!cSel && !aSel) return;

      // Normalise: 'United Kingdom' â†’ 'GB'
      const code = window.resolveCC
        ? window.resolveCC(displayCountryName)
        : String(displayCountryName || 'ALL');

      // Country select uses CODES
      if (cSel) {
        const opts = Array.from(cSel.options);
        const pick =
          opts.find(o => o.value === code) ||
          opts.find(o => o.value === displayCountryName) ||
          opts.find(o => o.textContent.trim() === displayCountryName);

        if (pick && cSel.value !== pick.value) {
          // âœ… mark this as a programmatic change so listeners can ignore it
          window.__settingDropdowns = true;
          cSel.value = pick.value;
          window.__settingDropdowns = false;
        }
      }

      // Area select uses LABELS
      if (aSel) {
        const want = String(areaLabel || 'ALL').trim();
        const aOpt = Array.from(aSel.options).find(
          o => o.value === want || o.textContent.trim() === want
        );

        if (aOpt && aSel.value !== aOpt.value) {
          // âœ… same guard here
          window.__settingDropdowns = true;
          aSel.value = aOpt.value;
          window.__settingDropdowns = false;
        }
      }

      console.log('[syncSelectsSafe]', {
        displayCountryName,
        resolvedCode: code,
        countrySelectValue: cSel?.value,
        areaSelectValue: aSel?.value
      });
    } catch (e) {
      console.warn('[syncSelectsSafe] failed', e);
      // make sure the flag is never left stuck "on"
      window.__settingDropdowns = false;
    }
  };
</script>
<script>
  window.addEventListener('load', function () {
    try {
      if (!window.bus || typeof window.bus.on !== 'function') {
        console.warn('[regionChangeâ†’map] bus not ready on load');
        return;
      }

      window.bus.on('regionChange', function (ev) {
        const d = ev && ev.detail ? ev.detail : {};

        // Only react to sunburst-origin changes
        if (d.from !== 'sunburst-applied') return;

        // Use canonical codes if present
        const cc        = (d.countryCode || d.country || 'ALL').toUpperCase();
        const areaLabel = d.area || 'ALL';

        const payload = {
          country: cc === 'ALL'       ? null : cc,
          area:    areaLabel === 'ALL' ? null : areaLabel,
          cont:    null,
        };

        try {
          console.debug('[regionChangeâ†’map via bus]', payload);

          // Prefer the helper from bus.js
          if (typeof window.bus.postToMap === 'function') {
            window.bus.postToMap('navGo', payload);
          } else {
            document
              .getElementById('mob-map')
              ?.contentWindow
              ?.postMessage({ type: 'navGo', payload }, '*');
          }
        } catch (e) {
          console.warn('[regionChangeâ†’map via bus] failed inside handler', e);
        }
      });

      console.debug('[regionChangeâ†’map] listener attached');
    } catch (e) {
      console.warn('[regionChangeâ†’map] setup failed', e);
    }
  });
</script>
</body>
</html>