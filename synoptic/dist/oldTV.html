<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Surf Forecast TV</title>
  <style>
body {
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

#tv-container {
  position: relative;
  width: 55vw;
  height: 98vh;
}

/* === MAP: Must be above video but under overlay/buttons === */
#tv-map {
  position: absolute;
  top: 15.35%;
  left: 10%;
  width: 73.2%;
  height: 70%;
  border: none;
  z-index: 1;  /* ‚úÖ Correct layering below video and overlay */
  transform: scale(0.69);
  transform-origin: top left;
  pointer-events: auto;
}

/* === VIDEO: Fades out and disables pointer events === */
#tv-video {
  position: absolute;
  top: 15%;
  left: 140px;
  width: 70%;
  height: 60%;
  object-fit: cover;
  z-index: 2;
  transition: opacity 2s ease;
  pointer-events: auto;
}

#tv-video.fade-out {
  opacity: 0;
}

/* === SPOT ON Banner === */
#spot-on-banner {
  position: absolute;
  top: 35%;
  left: 42%;
  transform: translate(-50%, -50%);
  font-size: 5vw;
  font-family: 'Impact', 'Arial Black', sans-serif;
  color: white;
  text-shadow:
    0 0 12px red,
    0 0 20px white;
  z-index: 4;
  opacity: 0;
  transition: opacity 2s ease;
}

#spot-on-banner.fade-in { opacity: 1; }
#spot-on-banner.fade-out { opacity: 0; }

/* === OVERLAY: Transparent PNG frame, lets events through === */
#tv-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 6;
}

/* === DATE DISPLAY === */
#tv-date {
  position: absolute;
  bottom: 26.5%;
  right: 49%;
  color: red;
  font-family: monospace;
  font-size: 1.5vw;
  text-shadow:
    0 0 8px red,
    2px 2px 4px black;
  z-index: 8;
}

#dials-container {
  position: absolute;
  top: 10%;
  left: 10%;
  z-index: 99999;
  display: flex;
  gap: 10px;
  background: rgba(0, 0, 0, 0.6);
  padding: 10px;
  border-radius: 8px;
}

/* === ZOOM BUTTONS: Circular, clickable, non-blocking === */
#tv-zoom-buttons {
  position: absolute;
  bottom: 21.5%;
  right: 73.25%;
  z-index: 7;
  display: flex;
  gap: 0.8vw;
  pointer-events: none; /* Container doesn't block the map */
}

#tv-zoom-buttons button {
  pointer-events: auto; /* Buttons themselves are clickable */
  width: 2vw;
  height: 2vw;
  border-radius: 50%;
  background: linear-gradient(to bottom right, #ddd, #666);
  border: 2px solid #444;
  box-shadow:
    inset -2px -2px 4px rgba(0,0,0,0.4),
    inset 2px 2px 4px rgba(255,255,255,0.3),
    0 0 3px rgba(0,0,0,0.5);
  font-weight: bold;
  font-size: 1vw;
  font-family: monospace;
  color: black;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

#tv-zoom-buttons button:hover {
  background: linear-gradient(to bottom right, #eee, #777);
  transform: scale(1.05);
}

#tv-zoom-buttons button:active {
  box-shadow: inset 2px 2px 6px rgba(0,0,0,0.5);
  transform: scale(0.95);
}

/* === DAY BUTTONS: Circular layout, styled === */
#tv-day-buttons {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 7; /* Same as zoom buttons */
  pointer-events: none;
}

.tv-day-button {
  pointer-events: auto;
  position: absolute;
  width: 2vw;
  height: 2vw;
  border-radius: 50%;
  background: linear-gradient(to bottom right, #ddd, #666);
  border: 2px solid #444;
  box-shadow:
    inset -2px -2px 4px rgba(0,0,0,0.4),
    inset 2px 2px 4px rgba(255,255,255,0.3),
    0 0 3px rgba(0,0,0,0.5);
  font-weight: bold;
  font-size: 1vw;
  font-family: monospace;
  color: black;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.tv-day-button:hover {
  background: linear-gradient(to bottom right, #eee, #777);
  transform: scale(1.05);
}

.tv-day-button:active {
  box-shadow: inset 2px 2px 6px rgba(0,0,0,0.5);
  transform: scale(0.95);
}


  </style>
</head>
<body>
    <div id="tv-container">

    <video id="tv-video" autoplay muted playsinline>
        <source src="media/static.mp4" type="video/mp4" />
        Your browser does not support the video tag.
    </video>

    <iframe
        id="tv-map"
        src="map_day0.html"
        style="width: 100%; height: 100%; border: none; pointer-events: auto;"
        allowfullscreen
        allow="fullscreen; geolocation">
    </iframe>

    <!-- üîΩ Insert this block here -->
    <div id="tv-zoom-buttons">
      <button onclick="sendZoom('in')">Ôºã</button>
      <button onclick="sendZoom('out')">Ôºç</button>
      <button onclick="sendZoom('reset')">‚≠Ø</button>
    </div>

    <div id="tv-day-buttons">
    <button class="tv-day-button" style="top: 69.35%; left: 13%;" onclick="switchDay(0)">0</button>
    <button class="tv-day-button" style="top: 69.35%; left: 18%;" onclick="switchDay(1)">1</button>
    <button class="tv-day-button" style="top: 69.35%; left: 23.25%;" onclick="switchDay(2)">2</button>
    </div>


    <div id="spot-on-banner">Spot On</div>
    <img id="tv-overlay" src="media/TV.png" alt="TV Frame">
    <div id="tv-date">August 7th</div>


    <div id="dials-container">
    <canvas id="windDial" width="120" height="120"></canvas>
    <canvas id="swellDial" width="120" height="120"></canvas>
    <canvas id="periodDial" width="120" height="120"></canvas>
    <canvas id="windDirDial" width="120" height="120"></canvas>
    <canvas id="swellDirDial" width="120" height="120"></canvas>
    </div>


    </div>

  <script>
    const regionData = JSON.parse(document.getElementById('region-daily-data').textContent);
    console.log("Loaded region averages:", regionData);
  </script>


  <script id="region-daily-data" type="application/json">
  {
  "Cornwall": {
    "2025-08-07": {
      "wind_speed": 19.7,
      "wind_dir": 208,
      "swell_height": 1.1,
      "swell_dir": 254,
      "swell_period": 5.3
    },
    "2025-08-08": {
      "wind_speed": 17.6,
      "wind_dir": 300,
      "swell_height": 1.2,
      "swell_dir": 274,
      "swell_period": 6.6
    },
    "2025-08-09": {
      "wind_speed": 15.1,
      "wind_dir": 262,
      "swell_height": 1.1,
      "swell_dir": 279,
      "swell_period": 7.7
    }
  }
}
  </script>

  <script>
    window.onload = function() {
      const video = document.getElementById('tv-video');
      const banner = document.getElementById('spot-on-banner');

      // Step 1: Fade in the text shortly after page load
      setTimeout(() => {
        banner.classList.add('fade-in');
      }, 500);  // Half a second after load

      // Step 2: Start fade-out of both banner and video after 5s
      setTimeout(() => {
        video.classList.add('fade-out');
        banner.classList.remove('fade-in');
        banner.classList.add('fade-out');
      }, 5000);

      // Step 3: Disable pointer events on video once it's invisible
      setTimeout(() => {
        video.style.pointerEvents = 'none';
      }, 7000);
    };
  </script>
  
  <script>
    function sendZoom(direction) {
        console.log("sendZoom called with:", direction);
        const iframe = document.getElementById('tv-map');
        iframe.contentWindow.postMessage({ zoom: direction }, '*');
    }
  </script>

  <script>
    const dateDisplay = document.getElementById('tv-date');
    const iframe = document.getElementById('tv-map');
    const today = new Date();
    const options = { month: 'long', day: 'numeric' };

    function formatFriendly(d) {
    const day = d.getDate();
    const month = d.toLocaleString('en-GB', { month: 'long' });  // ‚Üê this line is the fix
    const suffix = (day >= 11 && day <= 13) ? 'th' :
        {1: 'st', 2: 'nd', 3: 'rd'}[day % 10] || 'th';
    return `${day}${suffix} ${month}`;
    }

    function switchDay(dayOffset) {
      const targetDate = new Date(today);
      targetDate.setDate(today.getDate() + dayOffset);
      dateDisplay.textContent = formatFriendly(targetDate);
      iframe.src = `map_day${dayOffset}.html`;
    }

    // Initialise with Today‚Äôs map
    switchDay(0);
  </script>

    <script>
    function drawDial(canvasId, label, value, maxValue, unit = "") {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;
        const ctx = canvas.getContext("2d");
        const radius = canvas.width / 2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Background circle
        ctx.beginPath();
        ctx.arc(radius, radius, radius - 5, 0, 2 * Math.PI);
        ctx.strokeStyle = "#444";
        ctx.lineWidth = 8;
        ctx.stroke();

        // Foreground arc
        const angle = (value / maxValue) * Math.PI * 2;
        ctx.beginPath();
        ctx.arc(radius, radius, radius - 5, -Math.PI / 2, -Math.PI / 2 + angle);
        ctx.strokeStyle = "#00ffcc";
        ctx.lineWidth = 8;
        ctx.stroke();

        // Text label
        ctx.font = "14px monospace";
        ctx.fillStyle = "#eee";
        ctx.textAlign = "center";
        ctx.fillText(`${label}: ${value} ${unit}`, radius, radius + 5);
    }
    </script>






    <script>
    function drawDirectionDial(canvasId, label, angleDeg) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const radius = canvas.width / 2;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Background circle
        ctx.beginPath();
        ctx.arc(radius, radius, radius - 5, 0, 2 * Math.PI);
        ctx.strokeStyle = "#ccc";
        ctx.lineWidth = 6;
        ctx.stroke();

        // Direction arrow
        const angleRad = (angleDeg - 90) * Math.PI / 180; // rotate so 0¬∞ is up
        const arrowLength = radius - 15;
        const x = radius + arrowLength * Math.cos(angleRad);
        const y = radius + arrowLength * Math.sin(angleRad);

        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.lineTo(x, y);
        ctx.strokeStyle = "#ffcc00";
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.stroke();

        // Text label
        ctx.font = "14px sans-serif";
        ctx.fillStyle = "#eee";
        ctx.textAlign = "center";
        ctx.fillText(`${label}: ${angleDeg}¬∞`, radius, radius + 40);
    }

    function updateDialsForDay(dateStr) {
        const dataBlock = document.getElementById("region-daily-data");
        if (!dataBlock) {
        console.error("‚ùå region-daily-data not found");
        return;
        }

        const regionData = JSON.parse(dataBlock.textContent);
        const cornwallData = regionData["Cornwall"]?.[dateStr];
        if (!cornwallData) {
        console.warn("No data for", dateStr);
        return;
        }

        console.log("üåç Dial data for", dateStr, cornwallData);

        drawDial("windDial", "Wind", cornwallData.wind_speed, 30, "m/s");
        drawDial("swellDial", "Swell", cornwallData.swell_height, 5, "m");
        drawDial("periodDial", "Period", cornwallData.swell_period, 15, "s");
        drawDirectionDial("windDirDial", "Wind Dir", cornwallData.wind_dir);
        drawDirectionDial("swellDirDial", "Swell Dir", cornwallData.swell_dir);


    }

    document.addEventListener("DOMContentLoaded", () => {
        const today = new Date().toISOString().split("T")[0];
        updateDialsForDay(today);
    });
    </script>



</body>
</html>